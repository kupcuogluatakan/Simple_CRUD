@using ODMSCommon.Resources
@using ODMSCommon.Security
@model ODMSModel.VehicleBodywork.VehicleBodyworkViewModel
@{
    ViewBag.Title = ViewBag.Title = ODMSCommon.Resources.MessageResource.VehicleBodywork_PageTitle_Update;
    Layout = "~/Views/Shared/Popup_Layout.cshtml";
}

<script src="~/Scripts/jquery.maskedinput.js"></script>
<script src="~/Scripts/odms.objectsearch.js"></script>
 
@using (Html.BeginForm("VehicleBodyworkUpdate", "VehicleBodywork",FormMethod.Post, new { id = "updateForm" }))
{  
    <div class="labelDiv">@Html.LabelFor(v => v.VehicleId)</div>
    <div class="shortTxtDivObjectSearch">@Html.Partial("~/Views/ObjectSearch/ObjectSearch.cshtml",
    new ODMSModel.ObjectSearch.ObjectSearchModel
    {
        ObjectSearchType = CommonValues.ObjectSearchType.Vehicle,
        WindowTitle = ODMSCommon.Resources.MessageResource.ObjectSearch_WindowTitle_Vehicle,
        ReferenceObjectId = "VehicleId",
        ClearCallBackFunction = null,
        SelectCallBackFunction = null,
        Required = true,
        ReferenceObjectValue = Model == null ? null : Model.VehicleId,
        ParentWindowId = "modelWindow",
        FilterId = "BodyworkDetailRequired"
    })</div>
    <div class="clearDiv">&nbsp;</div>
    <div class="labelDiv">@Html.LabelFor(v => v.BodyworkCode)</div>
    <div class="shortTxtDiv">@Html.Kendo().ComboBoxFor(v => v.BodyworkCode).DataTextField("Text").DataValueField("Value").BindTo(ViewBag.BodyworkList as List<SelectListItem>).Placeholder(CommonUtility.GetResourceValue("Global_Display_Choose"))  @Html.ValidationMessageFor(v => v.BodyworkCode)</div> 
    <div class="clearDiv">&nbsp;</div>
    <div class="labelDiv">@Html.LabelFor(v => v.CountryName)</div>
    <div class="shortTxtDiv">@Html.Kendo().ComboBoxFor(v => v.CountryId).DataTextField("Text").DataValueField("Value").BindTo(ViewBag.CountryList as List<SelectListItem>).Placeholder(CommonUtility.GetResourceValue("Global_Display_Choose"))
        @Html.ValidationMessageFor(c => c.CountryId)
    </div>
    <div class="labelDiv">@Html.LabelFor(v => v.CityName)</div>
    <div class="shortTxtDiv">
        @Html.Kendo().ComboBoxFor(c => c.CityId).DataValueField("Value").DataTextField("Text").Placeholder(CommonUtility.GetResourceValue("Global_Display_Choose")).DataSource(source => source.Read(read => read.Action("ListCities", "VehicleBodyWork").Data("GetCountryId")).ServerFiltering(true)).Enable(false).AutoBind(false).CascadeFrom("CountryId") @Html.ValidationMessageFor(v => v.CityId)
    </div>
    <div class="clearDiv">&nbsp;</div>
    <div class="labelDiv">@Html.LabelFor(v => v.WorkOrderName)</div>
    <div class="shortTxtDiv">@Html.Kendo().ComboBoxFor(c => c.WorkOrderId).DataValueField("Value").DataTextField("Text").Placeholder(CommonUtility.GetResourceValue("Global_Display_Choose")).DataSource(source => source.Read(read => read.Action("ListWorkOrders", "VehicleBodyWork").Data("GetVehicleId")).ServerFiltering(true)).Enable(false).AutoBind(false).CascadeFrom("VehicleId") @Html.ValidationMessageFor(v => v.WorkOrderId)
    </div>
    <div class="labelDiv">@Html.LabelFor(v => v.DealerName)</div>
    <div class="shortTxtDiv">@Html.Kendo().ComboBoxFor(v => v.DealerId).DataTextField("Text").DataValueField("Value").BindTo(ViewBag.DealerList as List<SelectListItem>).Placeholder(CommonUtility.GetResourceValue("Global_Display_Choose")).Enable(UserManager.UserInfo.GetUserDealerId() == 0)
    </div> 
    
    <div class="clearDiv">&nbsp;</div>
    
    <div class="labelDiv">@Html.LabelFor(v => v.Manufacturer)</div>
    <div class="shortTxtDiv">@Html.TextBoxFor(v => v.Manufacturer)  @Html.ValidationMessageFor(v => v.Manufacturer) </div>   
    <div class="clearDiv">&nbsp;</div>

    @ODMSHelpers.Button("Update", CommonUtility.GetResourceValue("Global_Display_Update"), CommonValues.PermissionCodes.VehicleBodywork.VehicleBodyworkUpdate, "VehicleBodyworkUpdate","UpdateVehicleBodywork();", false)
    
    @Html.HiddenFor(v => v.VehicleBodyworkId)
    @Html.HiddenFor(v => v.DealerId)
}
<script src="~/Scripts/custom.js"></script>
<script id="update-confirmation" type="text/x-kendo-template">
        <p class="update-message">@MessageResource.VehicleBodywork_Warning_BodyworkExist</p>
        <p style="text-align:right">
        <button class="update-confirm k-button">@MessageResource.Global_Display_Yes</button>
        <button class="update-cancel k-button">@MessageResource.Global_Display_No</button></p>
    </script>
<script type="text/javascript">
    function GetCountryId() {
        return {
            countryId: $('#CountryId').val()
        };
    }
    function GetVehicleId() {
        return {
            vehicleId: $('#VehicleId').val(),
            dealerId: $('#DealerId').val(),
        };
    }
    $(document).ready(function () {
        $('form').each(function () {
            var validator = $(this).data('validator');
            if (validator && validator.settings) {
                validator.settings.ignore = "";
            }
        });
    });

    function UpdateConfirm(updateFunction) {
        var confirm = false;
        var kendoWindow = $("<div />").kendoWindow({
            title: "@MessageResource.Global_Display_Warning",
            resizable: false,
            modal: true
        });

        kendoWindow.data("kendoWindow")
            .content($("#update-confirmation").html())
            .center().open();

        kendoWindow
            .find(".update-confirm,.update-cancel")
            .click(function() {
                if ($(this).hasClass("update-confirm")) {
                    confirm = true;
                    if (updateFunction)
                        updateFunction();
                }
                kendoWindow.data("kendoWindow").close();
            })
            .end();
        return confirm;
    }

    function UpdateVehicleBodywork() {
        UpdateConfirm(function() {
            mvc.build('@Url.Action("VehicleBodyworkUpdate")', "", "", $('form').eq(0).serialize(), false, "json");
            mvc.post(null, function (result) {
                if (result.Status == 0)
                    SetErrorMessage(result.Message);
                else {
                    SetSuccessMessage(result.Message);
                    $("#DealerId").data("kendoComboBox").value(@UserManager.UserInfo.GetUserDealerId());
                }
            }, null);
        });
    }
</script>
