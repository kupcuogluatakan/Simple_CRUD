@using ODMSCommon.Resources

@model Int32
@{
    ViewBag.Title = @MessageResource.PDIGOSApproveGroupDealers_PageTitle_Index;
    Layout = null;
}
 
@Html.AntiForgeryToken()
<script>
    $(function () {
        RegisterEventHandlers();
    });
    
    function RegisterEventHandlers() {

        $("body").delegate("#btnAdd", "click", AddPDIGOSApproveGroupDealersClickHandler);
        $("body").delegate("#btnRemove", "click", RemovePDIGOSApproveGroupDealersClickHandler);
        $("#btnSave").unbind("click",SavePDIGOSApproveGroupDealersClickHandler);//Grid üzerindeki sadece son değişikliği yapması sağlanıyor
        $("#btnSave").bind("click",SavePDIGOSApproveGroupDealersClickHandler);
        $("body").delegate("#btnAddAll", "click", AddAllPDIGOSApproveGroupDealersClickHandler);
        $("body").delegate("#btnRemoveAll", "click", RemoveAllPDIGOSApproveGroupDealersClickHandler);
    }
    
    // Used in kendo listview read action
    function GetSelectedIdGroup() {
        return {
            idGroup : @Model
        };
    }
    
    // Called when kendo combobox changed event is fired
    function SelectedRoleChanged() {
        var includedDealerlist = $("#lstPDIGOSApproveGroupDealersIncluded").data("kendoListView");
        var notIncludedDealerlist = $("#lstPDIGOSApproveGroupDealersNotIncluded").data("kendoListView");

        includedDealerlist.dataSource.read();
        notIncludedDealerlist.dataSource.read();
    }
    
    function AddPDIGOSApproveGroupDealersClickHandler() {
        $(".k-state-selected", "#lstPDIGOSApproveGroupDealersNotIncluded").each(function (i, e) {
            $("#lstPDIGOSApproveGroupDealersIncluded").append($(e).clone()).html();
            $(e).remove();
        });
    }

    function AddAllPDIGOSApproveGroupDealersClickHandler() {
        $(".ListItem", "#lstPDIGOSApproveGroupDealersNotIncluded").each(function (i, e) {
            $("#lstPDIGOSApproveGroupDealersIncluded").append($(e).clone()).html();
            $(e).remove();
        });
    }
    
    function RemovePDIGOSApproveGroupDealersClickHandler() {
        $(".k-state-selected", "#lstPDIGOSApproveGroupDealersIncluded").each(function (i, e) {
            $("#lstPDIGOSApproveGroupDealersNotIncluded").append($(e).clone()).html();
            $(e).remove();
        });
    }

    function RemoveAllPDIGOSApproveGroupDealersClickHandler() {
        $(".ListItem", "#lstPDIGOSApproveGroupDealersIncluded").each(function (i, e) {
            $("#lstPDIGOSApproveGroupDealersNotIncluded").append($(e).clone()).html();
            $(e).remove();
        });
    }
    
    // IE'nin HTML 5 desteklemeyen versiyonlarinda jquery'nin data fonksiyonu calismayabilir. 
    // test etmemiz lazim
    function SavePDIGOSApproveGroupDealersClickHandler() {
        var idGroup = @Model;
        if (idGroup == "") // If no role is selected just return.
            return;
        
        var selectedDealerIds = [];
        $("#lstPDIGOSApproveGroupDealersIncluded").children().each(function (i, e) {
            var selectedIdRoleType = $("span", e).data("iddealer");//don't change idroletype ! - Orhan
            selectedDealerIds[i] = selectedIdRoleType;
        });
        var token = $('input[name="__RequestVerificationToken"]').val();
        
        $.ajax({
            type: "POST",
            url: "@Url.Action("SavePDIGOSApproveGroupDealers", "PDIGOSApproveGroupDealers")",
            data: { id: idGroup, IdDealerList : selectedDealerIds ,"__RequestVerificationToken": token },
            traditional: true,
            success: function (result) {
                if (result.Status == 0)
                    SetErrorMessage(result.Message);
                else
                    SetSuccessMessage(result.Message);
            },error:function(e){},
            dataType: "json"
        });
    }
    
</script>
<script type="text/x-kendo-tmpl" id="PDIGOSApproveGroupDealersItemTemplate">
    <div class="ListItem">
        <table>
            <tr>
                <td style="width:400px"><span data-idDealer=#:IdDealer#>#:DealerName# - #:IdDealer#</span></td>
@*                <td style="width:60px"><a href="/Permission/PermissionDetails/#:PermissionId#">(@MessageResource.Global_Display_Details)</a></td>*@
            </tr>
        </table>
    </div>
</script>


<div style="height:300px; overflow:auto; margin-left:30px;">
    <div> 
        <h4>
            @MessageResource.PDIGOSApproveGroupDealers_Display_DealersNotInclude
        </h4>

        <h4 style="margin-left:400px; margin-top:-30px; margin-bottom:0px;">
            @MessageResource.PDIGOSApproveGroupDealers_Display_DealersInclude
        </h4>
    </div> 
    
    <div>      
        @(Html.Kendo().ListView<ODMSModel.PDIGOSApproveGroupDealers.PDIGOSApproveGroupDealersListModel>()
                .Name("lstPDIGOSApproveGroupDealersIncluded")
                .Selectable(v => v.Mode(ListViewSelectionMode.Multiple))
                .ClientTemplateId("PDIGOSApproveGroupDealersItemTemplate")
                .TagName("div")
                .DataSource(ds => ds.Read(read =>
                    read.Action("ListPDIGOSApproveGroupDealers", "PDIGOSApproveGroupDealers").Data("GetSelectedIdGroup")))
                .HtmlAttributes(new {@style = "position: absolute; float: left; width: 305px; height: 200px; margin-top: 20px; margin-left: 420px; overflow:auto;"})
                )
    </div>
     
    @ODMSHelpers.LinkButton("btnAdd", "&rsaquo;", "", "arrow-btn", "","", "position: absolute; margin-left: 340px; margin-top: 60px; width: 40px; height: 25px; ")
    @ODMSHelpers.LinkButton("btnRemove", "&lsaquo;", "", "arrow-btn", "","", "position: absolute; margin-left: 340px; margin-top: 90px; width: 40px; height: 25px;")
    @ODMSHelpers.LinkButton("btnAddAll", "&raquo;", "", "arrow-btn", "","", "position: absolute; margin-left: 340px; margin-top: 120px; width: 40px; height: 25px;")
    @ODMSHelpers.LinkButton("btnRemoveAll", "&laquo;", "", "arrow-btn", "","", "position: absolute; margin-left: 340px; margin-top: 150px; width: 40px; height: 25px;")

    <div>
        @(Html.Kendo().ListView<ODMSModel.PDIGOSApproveGroupDealers.PDIGOSApproveGroupDealersListModel>()
                .Name("lstPDIGOSApproveGroupDealersNotIncluded")
                .Selectable(v => v.Mode(ListViewSelectionMode.Multiple))
                .ClientTemplateId("PDIGOSApproveGroupDealersItemTemplate")
                .TagName("div")
                .DataSource(ds => ds.Read(read =>
                    read.Action("ListPDIGOSApproveGroupDealersNotInclude", "PDIGOSApproveGroupDealers").Data("GetSelectedIdGroup")))
                .HtmlAttributes(new {@style = "width: 305px; height: 200px;  margin-top: 20px; margin-left: 0px;overflow:auto;"})
                )          
    </div>

    <div style="position: absolute; height: 35px; width:850px">
    @ODMSHelpers.LinkButton("btnSave", @MessageResource.Global_Display_Save, "", "Button", "","", "float: left; margin-top: 5px; width: 55px; height: 25px;")
    </div>

</div>


