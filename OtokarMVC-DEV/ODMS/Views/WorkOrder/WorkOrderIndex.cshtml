@model WorkOrderListModel
@using ODMSCommon.Resources
@using ODMSCommon.Security
@using ODMSModel.WorkOrder


@{
    ViewBag.Title = MessageResource.WorkOrder_PageTitle_Index;
}
@*search start*@
<div id="showSearch">@MessageResource.Global_Display_Search_Criteria</div>
<div id="searchDiv">
    <div id="searchFields">
        <div class="labelDiv">@Html.LabelFor(v => v.DealerName)</div>
        <div class="shortTxtDiv">@Html.Kendo().ComboBoxFor(v => v.DealerId).DataTextField("Text").DataValueField("Value").BindTo(ViewBag.DealerList as List<SelectListItem>).Placeholder(ODMSCommon.Resources.MessageResource.Global_Display_Choose).Enable(UserManager.UserInfo.IsDealer == false)</div>
        <div class="labelDiv">@Html.LabelFor(v => v.WorkOrderStatusId)</div>
        <div class="shortTxtDiv">@Html.Kendo().ComboBoxFor(v => v.WorkOrderStatusId).DataTextField("Text").DataValueField("Value").BindTo(ViewBag.WorkOrderStatusList as List<SelectListItem>).Placeholder(ODMSCommon.Resources.MessageResource.Global_Display_Choose).Value("1")</div>
        <div class="labelDiv">@MessageResource.WorkOrder_Number</div>
        <div class="shortTxtDiv">@Html.TextBoxFor(c => c.WorkOrderId, new { @Value = "", @type = "number", @class = "proposalNumber", @min = "0" }) </div>
        <div class="clearDiv">&nbsp;</div>
        <div class="labelDiv">@Html.LabelFor(v => v.CustomerName)</div>
        <div class="shortTxtDiv">@Html.TextBoxFor(c => c.CustomerName) </div>
        <div class="labelDiv">@Html.LabelFor(v => v.VehiclePlate)</div>
        <div class="shortTxtDiv">@Html.TextBoxFor(c => c.VehiclePlate, new { @onkeyup = "InputToUpperWithoutWhiteSpace(this);" })</div>
        <div class="clearDiv">&nbsp;</div>
        <div class="labelDiv">@Html.LabelFor(v => v.VinNo)</div>
        <div class="shortTxtDiv">@Html.TextBoxFor(c => c.VinNo) <i class="glyphicon glyphicon-info-sign" title="@MessageResource.Global_Display_Multiple_Choose"></i></div>
        <div class="labelDiv">@Html.LabelFor(v => v.VehicleType)</div>
        <div class="shortTxtDiv">@Html.Kendo().ComboBoxFor(v => v.VehicleType).DataTextField("Text").DataValueField("Value").BindTo(ViewBag.VehicleTypeList as List<SelectListItem>).Placeholder(ODMSCommon.Resources.MessageResource.Global_Display_Choose)</div>
        <div class="clearDiv">&nbsp;</div>
        <div class="labelDiv">@MessageResource.WorkOrder_Display_WorkOrderStartDate</div>
        <div class="shortTxtDiv">@Html.Kendo().DatePicker().Name("StartDate").Events(c => c.Open("OpenStartDate")).Format("dd/MM/yyyy").ParseFormats(new[] { "dd.MM.yyyy" }) </div>
        <div class="labelDiv">@MessageResource.WorkOrder_Display_WorkOrderEndDate</div>
        <div class="shortTxtDiv">@Html.Kendo().DatePicker().Name("EndDate").Max(DateTime.Now).Events(c => c.Open("OpenEndDate")).Format("dd/MM/yyyy").ParseFormats(new[] { "dd.MM.yyyy" }) </div>
        <div class="clearDiv">&nbsp;</div>
    </div>
</div>
@*serach end*@
@ODMSHelpers.LinkButton("btnSearch", CommonUtility.GetResourceValue("Global_Display_Search"), "", "", "", CommonValues.PermissionCodes.WorkOrder.WorkOrderIndex)
@ODMSHelpers.LinkButton("btnCreate", CommonUtility.GetResourceValue("Global_Display_New"), "Create", "modalClick createNew", CommonUtility.GetResourceValue("WorkOrder_PageTitle_Create"), CommonValues.PermissionCodes.WorkOrder.WorkOrderCreate)

@if (ODMSHelpers.UserHasPermission(CommonValues.PermissionCodes.WorkOrder.WorkOrderExcelExport))
{
    @Html.Partial("_ExcelExport",new ODMS.Model.ExportModel())
}


    @*grid start*@
    <div class="kendoGridDiv" id="grd">
        @(Html.Kendo().Grid<WorkOrderListModel>()
          .Name("grid")

          .Columns(columns =>
          {
              columns.Bound(p => p.WorkOrderId).ClientTemplate("<center><a class='' id='#=WorkOrderId#' href='" + Url.Action("WorkOrderCardIndex", "WorkOrderCard") + "/#=WorkOrderId#'>#=WorkOrderId#</a></center>").Title(CommonUtility.GetResourceValue("WorkOrder_Display_WorkOrder")).Width(60).Sortable(true).Visible(ODMSHelpers.UserHasPermission(CommonValues.PermissionCodes.WorkOrder.WorkOrderIndex));
              columns.Bound(p => p.WorkOrderId).ClientTemplate("<center><a class='details modalClick' id='#=WorkOrderId#' frameTitle='" + CommonUtility.GetResourceValue("WorkOrder_PageTitle_Details") + "' href='/WorkOrder/WorkOrderDetails/#=WorkOrderId#'><img class=iconLink src='" + @Url.Content("~/Images/view.png") + "'></a></center>").Title(CommonUtility.GetResourceValue("Global_Display_View")).Width(50).Sortable(false).Visible(ODMSHelpers.UserHasPermission(CommonValues.PermissionCodes.WorkOrder.WorkOrderDetails));
              columns.Bound(p => p.WorkOrderDate).Width(100).Sortable(true).Format("{0:dd/MM/yyyy}");
              columns.Bound(p => p.CustomerName).Width(200).Sortable(true);
              columns.Bound(p => p.VehiclePlate).Width(100).Sortable(true);
              columns.Bound(p => p.VinNo).Width(150).Sortable(true);
              columns.Bound(p => p.EngineNo).Width(160).Sortable(true);
              columns.Bound(p => p.VehicleModel).Width(100).Sortable(true);
              columns.Bound(p => p.VehicleType).Width(150).Sortable(true);
              columns.Bound(p => p.VehicleCode).Width(100).Sortable(true);
              columns.Bound(p => p.WarrantyStartDate).Width(100).Sortable(true).Format("{0:dd/MM/yyyy}"); ;
              columns.Bound(p => p.WarrantyEndDate).Width(100).Sortable(true).Format("{0:dd/MM/yyyy}"); ;
              columns.Bound(p => p.WarrantyEndKilometer).Width(100).Sortable(true);
              columns.Bound(p => p.WorkOrderStatus).Width(100).Sortable(true);
              columns.Bound(p => p.DealerName).Width(150).Sortable(false).Visible(UserManager.UserInfo.IsDealer == false);
          })
          .Pageable()
          .Sortable()
          .Scrollable()
          .DataSource(dataSource => dataSource
                                        .Ajax()
                                        .PageSize(10)
                                        .ServerOperation(true)
                                        .Read(read => read.Action("ListWorkOrders", "WorkOrder", Model).Data("GetParameters"))
                                        .Model(model => model.Field(o => o.WorkOrderId).DefaultValue(-1)))

        )
    </div>
    @*grid end*@

    @*modelWindow start*@
    <div id="modelWindowDiv">
        @(Html.Kendo().Window()
        .Name("modelWindow")
    .Title("Customer")
     .Draggable()
    .Resizable()
    .Width(1400)
    .Height(570)
    .Visible(false)
    .Modal(true)
    .Iframe(true)
    .Events(ev => ev.Close(@"function(e){
         var grid = $('#grid').data('kendoGrid');
        grid.dataSource.read();
    }"))
        )
    </div>
    @*modelWindow end*@


    @*scripts start*@
    @section Scripts{
        <script type="text/javascript">
            function GetParameters() {
                return {
                    CustomerName: $('#CustomerName').val(),
                    VehiclePlate: $('#VehiclePlate').val(),
                    DealerId: $('#DealerId').val(),
                    WorkOrderStatusId: $('#WorkOrderStatusId').val(),
                    VinNo: $('#VinNo').val(),
                    VehicleType: $('#VehicleType').val(),
                    StartDate: $('#StartDate').val(),
                    EndDate: $('#EndDate').val(),
                    WorkOrderId: $('#WorkOrderId').val(),
                    ReportType:48,
                    Columns: "WorkOrderId,WorkOrderDate,CustomerName,VehiclePlate,VinNo,EngineNo,VehicleModel,VehicleType,VehicleCode,WarrantyStartDate,WarrantyEndDate,WarrantyEndKilometer,WorkOrderStatus,DealerNameWorkOrderId,WorkOrderDate,CustomerName,VehiclePlate,VinNo,EngineNo,VehicleModel,VehicleType,VehicleCode,WarrantyStartDate,WarrantyEndDate,WarrantyEndKilometer,WorkOrderStatus,DealerName"
                    
                };
            }

            $(document).ready(init);




            function init() {

                PrepareDatePickers();

                $("body").delegate("#btnSearch", "click", function (e) {
                    var grid = $('#grid').data('kendoGrid');
                    grid.dataSource.page(1);

                });
                $("body").delegate("#showSearch", "click", function (e) {
                    var IsVisible = Boolean($(this).hasClass("searchVisible"));

                    if (!IsVisible) {
                        $(this).html('@MessageResource.Global_Display_Hide_Search_Criteria');
                        $(this).addClass("searchVisible");
                        $("#searchDiv").show("slow");
                    } else {
                        $(this).html("@MessageResource.Global_Display_Search_Criteria");
                        $(this).removeClass("searchVisible");
                        $("#searchDiv").hide("slow");
                    }
                });
                $("body").delegate(".modalClick", "click", function (e) {
                    $('#modelWindow').html('');
                    e.preventDefault();

                    var link;
                    var clickedId = $(this).attr("id");
                    var frameTitle = $(this).attr("frameTitle");
                    if ($(this).hasClass("details") == true) {
                        link = "@Url.Action("WorkOrderDetails", "WorkOrder", new { id = -1 })";
                        link = link.replace("-1", clickedId);
                    } @*else if ($(this).hasClass("edit")) {
                    link = "@Url.Action("WorkOrderUpdate", "WorkOrder", new {id = -1})";
                    link = link.replace("-1", clickedId);
                }*@ else if ($(this).hasClass("createNew")) {
                        link = "@Url.Action("WorkOrderCreate", "WorkOrder")";
                    }
                    $("#modelWindow_wnd_title").html(frameTitle);

                    var windowWidget = $("#modelWindow").data("kendoWindow");
                    var closeOrigin = windowWidget.close;

                    windowWidget.refresh({
                        url: link
                    }).center();
                    windowWidget.center();
                    windowWidget.open();
                    //$('.k-overlay').unbind('click');
                    //$('.k-overlay').click(function() {
                    //    var popup = $("#modelWindow").data("kendoWindow");
                    //    if (popup)
                    //        popup.close();
                    //    $('#modelWindow').html('');
                    //});
                });
            }

            @* function DeleteWorkOrder(id) {
            DeleteConfirm(function () {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("WorkOrderDelete","WorkOrder")",
                    data: { id:id },
                    traditional: true,
                    success: function (result) {
                        if (result.Status == 0)
                            SetErrorMessage(result.Message);
                        else {
                            var grid = $('#grid').data('kendoGrid');
                            grid.dataSource.read();
                            SetSuccessMessage(result.Message);
                        }
                    },
                    dataType: "json"
                });
            });
        }*@

        </script>
        <script src="~/Scripts/custom.js"></script>
    }
    @*scripts end*@

        <style>
            .proposalNumber {
                width: 200px !important;
                border: 1px solid #c6c5c5 !important;
                padding: 2px 0 !important;
                outline: transparent none !important;
                border-radius: 4px !important;
            }
        </style>