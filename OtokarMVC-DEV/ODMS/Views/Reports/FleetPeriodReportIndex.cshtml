@using ODMSCommon.Resources
@using ODMSModel.Reports

@model FleetPeriodReport

@{
    ViewBag.Title = MessageResource.FleetPeriodReport_Display_Title;
}

<div id="searchDiv">
    <div id="searchFields">

        <div class="labelDiv">@Html.LabelFor(v => v.Period)</div>
        <div class="shortTxtDiv">@Html.TextBoxFor(c => c.Period)</div>

        <div class="clearDiv">&nbsp;</div>

        <div class="labelDiv">@Html.LabelFor(v => v.FleetCode)</div>
        <div class="shortTxtDiv">@Html.TextBoxFor(c => c.FleetCode)</div>

        <div class="labelDiv">@Html.LabelFor(v => v.FleetName)</div>
        <div class="shortTxtDiv">@Html.TextBoxFor(c => c.FleetName)</div>
        <div class="clearDiv">&nbsp;</div>

        <div class="labelDiv">@Html.LabelFor(v => v.WorkOrderCustomerName)</div>
        <div class="shortTxtDiv">@Html.TextBoxFor(c => c.WorkOrderCustomerName)</div>
        <div class="labelDiv">@Html.LabelFor(v => v.WorkOrderCustomerVehicleVinNo)</div>
        <div class="shortTxtDiv">@Html.TextBoxFor(c => c.WorkOrderCustomerVehicleVinNo)</div>
        <div class="clearDiv">&nbsp;</div>

        <div class="labelDiv">@Html.LabelFor(v => v.WorkOrderNo)</div>
        <div class="shortTxtDiv">@Html.TextBoxFor(c => c.WorkOrderNo)</div>

        <div class="clearDiv">&nbsp;</div>


        <div class="labelDiv">@Html.LabelFor(v => v.StartDate)</div>
        <div class="shortTxtDiv">@Html.Kendo().DatePickerFor(v => v.StartDate).Value(new DateTime(DateTime.Now.Year, 1, 1).Date).Format("dd/MM/yyyy").ParseFormats(new[] { "dd.MM.yyyy" }).HtmlAttributes(new { type = "text", onkeypress = "return false;" })</div>

        <div class="labelDiv">@Html.LabelFor(v => v.FinishDate)</div>
        <div class="shortTxtDiv">@Html.Kendo().DatePickerFor(v => v.FinishDate).Value(new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day).Date).Format("dd/MM/yyyy").ParseFormats(new[] { "dd.MM.yyyy" }).HtmlAttributes(new { type = "text", onkeypress = "return false;" })</div>
        <div class="clearDiv">&nbsp;</div>




    </div>
    <div class="clearDiv">&nbsp;</div>
</div>


@ODMSHelpers.LinkButton("btnSearch", MessageResource.Global_Display_Search, "", "", "", CommonValues.PermissionCodes.Reports.FleetPeriodReportIndex)
@if (ODMSHelpers.UserHasPermission(CommonValues.PermissionCodes.Reports.FleetPeriodReportExcelExport))
{
    @Html.Partial("_ExcelExport", new ODMS.Model.ExportModel())
}

<div class="kendoGridDiv" id="grd">
    @(Html.Kendo().Grid<FleetPeriodReport>()
          .Name("gridReport")
          .Columns(columns =>
          {
              columns.Bound(p => p.Period).ClientTemplate(String.Format("<a class='k-link' target='_blank' href='{0}'>#=Period#</a>", Url.Action("ClaimRecallPeriodIndex", "ClaimRecallPeriod"))).HtmlAttributes(new { style = "text-align:center" }).Sortable(false).Width(80);
              columns.Bound(p => p.FleetCode).Sortable(false).Width(125);
              columns.Bound(p => p.FleetName).Sortable(false).Width(150);
              columns.Bound(p => p.StartDate).Format("{0:dd/MM/yyyy H:mm}").Sortable(false).Width(120);
              columns.Bound(p => p.FinishDate).Format("{0:dd/MM/yyyy H:mm}").Sortable(false).Width(120);

              columns.Bound(p => p.WorkOrderOpenDate).Format("{0:dd/MM/yyyy H:mm}").Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderVehicleLeaveDate).Format("{0:dd/MM/yyyy H:mm}").Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCloseDate).Format("{0:dd/MM/yyyy H:mm}").Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderNo).ClientTemplate(String.Format("<a class='k-link' target='_blank' href='{0}/#=WorkOrderNo#'>#=WorkOrderNo#</a>", Url.Action("WorkOrderCardIndex", "WorkOrderCard"))).HtmlAttributes(new { style = "text-align:center" }).Sortable(false).Width(80);
              columns.Bound(p => p.WorkOrderStatus).Sortable(false).Width(100);
              columns.Bound(p => p.WorkOrderDealerRegion).Sortable(false).Width(100);
              columns.Bound(p => p.WorkOrderDealerCode).Sortable(false).Width(100);
              columns.Bound(p => p.WorkOrderDealer).Sortable(false).Width(200);

              columns.Bound(p => p.WorkOrderCustomerType).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCustomerId).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCustomerName).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCustomerIdentity).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCustomerTaxNo).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCustomerAddress).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCustomerMobile).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCustomerTelephone).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCustomerWithHolding).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCustomerVatExclude).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCustomerVehiclePlate).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCustomerVehicleModel).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCustomerVehicleVinNo).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCustomerVehicleKm).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderCustomerRequest).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderDetailId).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderIndicatorType).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderIndicatorCode).Sortable(false).Width(120);
              columns.Bound(p => p.WorkOrderIndicatorDescription).Sortable(false).Width(120);

              columns.Bound(p => p.PartCode).Sortable(false).Width(120);
              columns.Bound(p => p.PartName).Sortable(false).Width(120);
              columns.Bound(p => p.PartQuantity).Sortable(false).Width(120);
              columns.Bound(p => p.PartUnitPrice).Sortable(false).Width(120);
              columns.Bound(p => p.OtokarPartDiscountRate).Sortable(false).Width(120);
              columns.Bound(p => p.OtokarPartDiscountPrice).Sortable(false).Width(120);
              columns.Bound(p => p.DealerPartDiscountRate).Sortable(false).Width(120);
              columns.Bound(p => p.DealerPartDiscountPrice).Sortable(false).Width(120);
              columns.Bound(p => p.PartDiscountPrice).Sortable(false).Width(120);
              columns.Bound(p => p.PartDiscountedPrice).Sortable(false).Width(120);

              columns.Bound(p => p.LabourCode).Sortable(false).Width(120);
              columns.Bound(p => p.LabourName).Sortable(false).Width(120);
              columns.Bound(p => p.LabourQuantity).Sortable(false).Width(120);
              columns.Bound(p => p.LabourDuration).Sortable(false).Width(120);
              columns.Bound(p => p.LabourUnitPrice).Sortable(false).Width(120);
              columns.Bound(p => p.OtokarLabourDiscountRate).Sortable(false).Width(120);
              columns.Bound(p => p.OtokarLabourDiscountPrice).Sortable(false).Width(120);
              columns.Bound(p => p.DealerLabourDiscountRate).Sortable(false).Width(120);
              columns.Bound(p => p.DealerLabourDiscountPrice).Sortable(false).Width(120);
              columns.Bound(p => p.LabourDiscountPrice).Sortable(false).Width(120);
              columns.Bound(p => p.LabourDiscountedPrice).Sortable(false).Width(120);

              columns.Bound(p => p.PartPrice).Sortable(false).Width(120);
              columns.Bound(p => p.LabourPrice).Sortable(false).Width(120);

              columns.Bound(p => p.CurrencyCode).Sortable(false).Width(120);

          })
          .Pageable()
          .Sortable()
          .Scrollable()
          .DataSource(dataSource => dataSource
                                        .Ajax()
                                        .PageSize(10)
                                        .ServerOperation(true)
                                        .Events(e => e.RequestStart("onDataBinding"))
                                        .Read(read => read.Action("ListFleetPeriodReport", "Reports", Model).Data("GetParameters"))
                                        .Model(model => model.Field(o => o.WorkOrderNo).DefaultValue(-1)))

    )
</div>

@Html.Partial("~/Views/Reports/_ResponseTimeForGrid.cshtml")

<script type="text/javascript">

    $(document).ready(init);

    function onDataBinding(e) {
        @*if (($("#StartDate").val() == "" || $("#EndDate").val() == "")) {
            SetErrorMessage('@MessageResource.WorkOrderDetail_Validation_Required');
            e.preventDefault();
            return;
        }
        SetSuccessMessage('@MessageResource.Filtration_Success_Message');*@
    }

    function GetParameters() {
        return {
            Period: $('#Period').val(),
            WorkOrderOpenDate: $('#StartDate').val(),
            WorkOrderCloseDate: $('#EndDate').val(),
            FleetCode: $('#FleetCode').val(),
            FleetName: $('#FleetName').val(),
            WorkOrderCustomerName: $('#WorkOrderCustomerName').val(),
            WorkOrderCustomerVehicleVinNo: $('#WorkOrderCustomerVehicleVinNo').val(),
            WorkOrderNo: $('#WorkOrderNo').val(),
            ReportType: 56,
            Columns: "Period,FleetCode,FleetName,StartDate,FinishDate,WorkOrderOpenDate,WorkOrderVehicleLeaveDate,WorkOrderCloseDate,WorkOrderNo,WorkOrderStatus,WorkOrderDealerRegion,WorkOrderDealerCode,WorkOrderDealer,WorkOrderCustomerType,WorkOrderCustomerId,WorkOrderCustomerName,WorkOrderCustomerIdentity,WorkOrderCustomerTaxNo,WorkOrderCustomerAddress,WorkOrderCustomerMobile,WorkOrderCustomerTelephone,WorkOrderCustomerWithHolding,WorkOrderCustomerVatExclude,WorkOrderCustomerVehiclePlate,WorkOrderCustomerVehicleModel,WorkOrderCustomerVehicleVinNo,WorkOrderCustomerVehicleKm,WorkOrderCustomerRequest,WorkOrderDetailId,WorkOrderIndicatorType,WorkOrderIndicatorCode,WorkOrderIndicatorDescription,PartCode,PartName,PartQuantity,PartUnitPrice,OtokarPartDiscountRate,OtokarPartDiscountPrice,DealerPartDiscountRate,DealerPartDiscountPrice,PartDiscountPrice,PartDiscountedPrice,LabourCode,LabourName,LabourQuantity,LabourDuration,LabourUnitPrice,OtokarLabourDiscountRate,OtokarLabourDiscountPrice,DealerLabourDiscountRate,DealerLabourDiscountPrice,LabourDiscountPrice,LabourDiscountedPrice,PartPrice,LabourPrice,CurrencyCode"
        };
    }

    function init() {

        $("#searchDiv").show("slow");

        $("body").delegate("#btnReset", "click", function (e) {
            //$("#StatusIdList").data('kendoMultiSelect').value('');
            $("#Period").data('Period').value('');
            $("#FleetCode").data('FleetCode').value('');
            $("#FleetName").data('FleetName').value('');
            $("#StartDate").data('StartDate').value('');
            $("#EndDate").data('EndDate').value('');

        });
        $("body").delegate("#btnSearch", "click", function (e) {
            var grid = $('#gridReport').data('kendoGrid');
            grid.dataSource.page(1);
        });
    }



</script>