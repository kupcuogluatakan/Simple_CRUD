@using ODMSCommon.Resources
@model ODMSModel.AnnouncementDealer.AnnouncementDealerModel

@{
    ViewBag.Title = MessageResource.AnnouncementDealers_PageTitle_Index;
    Layout = null;
}
  
@if (ViewBag.AnnouncementId > 0)
{
    <script type="text/x-kendo-tmpl" id="DealerItemTemplate">
    <div class="ListItemText" style="padding:3px 0 0 5px; cursor:default">
        <span data-dealerid=#:Value#>#:Text#</span>
    </div>
</script>
    @Html.AntiForgeryToken()
      <script type="text/javascript">
        $(document).ready(function() {
           // $('#roles-wrapper').hide();
            $('#btnAdd2').click(AddDealerHandler);
            $('#btnAddAll2').click(AddDealerAllHandler);
            $('#btnRemove2').click(RemoveDealerHandler);
            $('#btnRemoveAll2').click(RemoveDealerAllHandler);
            $('#btnSave2').click(SaveDealersHandler);
        });

        function SelectedVehicleModelChanged() {
            var notIncludedDealerlist = $("#lstDealersNotIncludedInAnnouncement").data("kendoListView");
            notIncludedDealerlist.dataSource.read();
            var IncludedDealerlist = $("#lstDealersIncludedInAnnouncement").data("kendoListView");
            IncludedDealerlist.dataSource.read();
        }

        function GetData() {
            return {
                announcementId: @ViewBag.AnnouncementId,
                customerGroupId:$("#CustomerGroupId").val(),
                vehicleModelId:$("#VehicleModelId").val()
            };
        }

        function AddDealerHandler() {
            $(".k-state-selected", "#lstDealersNotIncludedInAnnouncement").each(function(i, e) {
                $("#lstDealersIncludedInAnnouncement").append($(e).clone()).html();
                $(e).remove();
            });
        }
        function AddDealerAllHandler() {
            $(".ListItemText", "#lstDealersNotIncludedInAnnouncement").each(function(i, e) {
                $("#lstDealersIncludedInAnnouncement").append($(e).clone()).html();
                $(e).remove();
            });
        }

        function RemoveDealerHandler() {
            $(".k-state-selected", "#lstDealersIncludedInAnnouncement").each(function(i, e) {
                $("#lstDealersNotIncludedInAnnouncement").append($(e).clone()).html();
                $(e).remove();
            });
        }
        function RemoveDealerAllHandler() {
            $(".ListItemText", "#lstDealersIncludedInAnnouncement").each(function(i, e) {
                $("#lstDealersNotIncludedInAnnouncement").append($(e).clone()).html();
                $(e).remove();
            });
        }

        function SaveDealersHandler() {
            var includedDealerIds = [];
            $("#lstDealersIncludedInAnnouncement").children().each(function(i, e) {
                var dealerId = $("span", e).data("dealerid");
                includedDealerIds[i] = dealerId;
            });
            var token = $('input[name="__RequestVerificationToken"]').val();
            $.ajax({
                type: "POST",
                url: "@Url.Action("Save", "AnnouncementDealer")",
                data: { AnnouncementId: @ViewBag.AnnouncementId, DealerList: includedDealerIds , "__RequestVerificationToken": token  },
                traditional: true,
                success: function(result) {
                    if (result.Result == false)
                        SetErrorMessage(result.Message);
                    else {
                        SetSuccessMessage(result.Message);
                        var grid = $('#AnnouncementGrid').data('kendoGrid');
                        grid.dataSource.read();
                    }
                       
                },
                dataType: "json"
            });


        }
    </script>

    <div>
        <div class="labelDiv">
            @Html.Label(MessageResource.VehicleModel_Display_Name)
        </div> 
        <div class="shortTxtDiv">
            @(Html.Kendo().ComboBox()
                  .Name("VehicleModelId")
                  .Placeholder(MessageResource.Global_Display_Select)
                  .BindTo(ViewBag.VehicleModelList as List<SelectListItem>)
                  .DataTextField("Text")
                  .DataValueField("Value")
                  .Events(e => e.Change("SelectedVehicleModelChanged"))

                  )
        </div>
        <div class="clearfix"></div>
        <div class="labelDiv">
            @Html.Label(MessageResource.Dealer_Display_CustomerGroup)
        </div> 
        <div class="shortTxtDiv">
            @(Html.Kendo().ComboBox()
                  .Name("CustomerGroupId")
                  .Placeholder(MessageResource.Global_Display_Select)
                  .BindTo(ViewBag.CustomerGroupList as List<SelectListItem>)
                  .DataTextField("Text")
                  .DataValueField("Value")
                  .Events(e => e.Change("SelectedVehicleModelChanged"))

                  )
        </div>
        <div class="clearfix"></div>
    </div>
    <div id="roles-wrapper" style="width: 700px; margin-left: 30px;">
        <div style="float: left; width: 280px;">
            <h4>
                @MessageResource.AnnouncemetDealer_Display_DealersExcluded
            </h4>
            @(Html.Kendo().ListView<SelectListItem>()
                  .Name("lstDealersNotIncludedInAnnouncement")
                  .Selectable(v => v.Mode(ListViewSelectionMode.Multiple))
                  .ClientTemplateId("DealerItemTemplate")
                  .TagName("div")
                  .DataSource(ds => ds.Read(read =>
                      read.Action("ListDealersExcluded", "AnnouncementDealer").Data("GetData")))
                  .HtmlAttributes(new { @style = "height:200px; overflow-y:auto;" })
                  )
        </div>
        <div style="float: left; width: 140px; margin-top: 40px;">
            <div style="text-align: center; margin-top: 10px;">
                @ODMSHelpers.LinkButton("btnAdd2", "&rsaquo;", "", "arrow-btn", "", "")
            </div>
            <div style="text-align: center; margin-top: 10px;">
                @ODMSHelpers.LinkButton("btnRemove2", "&lsaquo;", "", "arrow-btn", "", "")
            </div>
            <div style="text-align: center; margin-top: 10px;">
                @ODMSHelpers.LinkButton("btnAddAll2", "&raquo;", "", "arrow-btn", "", "")
            </div>
            <div style="text-align: center; margin-top: 10px;">
                @ODMSHelpers.LinkButton("btnRemoveAll2", "&laquo;", "", "arrow-btn", "", "")
            </div>
        </div>
    
        <div style="float: left; width: 280px">
            <h4>
                @MessageResource.AnnouncementDealer_Display_DealersIncluded
            </h4>
            @(Html.Kendo().ListView<SelectListItem>()
                  .Name("lstDealersIncludedInAnnouncement")
                  .Selectable(v => v.Mode(ListViewSelectionMode.Multiple))
                  .ClientTemplateId("DealerItemTemplate")
                  .TagName("div")
                  .HtmlAttributes(new { @style = "height:200px; overflow-y:auto;" })
                  .DataSource(ds => ds.Read(read =>
                      read.Action("ListDealersIncluded", "AnnouncementDealer", new { announcementId = ViewBag.AnnouncementId }))))
        </div>

        <div class="clearfix" style="margin-bottom: 15px;"></div>
            @if (ViewBag.MasterIsActive == 0)
    {
        @ODMSHelpers.LinkButton("btnSave2", MessageResource.Global_Display_Save, "", "", "", "")
    }
    </div>






  

}