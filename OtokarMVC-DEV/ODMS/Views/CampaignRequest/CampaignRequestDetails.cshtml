@{
    ViewBag.Title = ViewBag.Title = ODMSCommon.Resources.MessageResource.CampaignRequest_PageTitle_Details;
}
@{
    Layout = "~/Views/Shared/Popup_Layout.cshtml";
}

@using ODMSCommon.Resources
@model ODMSModel.CampaignRequest.CampaignRequestViewModel


    <div style="width:100%;">
        <div style="width:50%;float:left;">

            <div class="labelDiv">@Html.LabelFor(v => v.IdDealer)</div>
            <div class="labelDiv">@Html.DisplayFor(v => v.DealerName)</div>
            <div class="clearDiv">&nbsp;</div>
            <div class="labelDiv">@Html.LabelFor(v => v.CampaignName)</div>
            <div class="shortTxtDiv">@Html.DisplayFor(v => v.CampaignName)</div>

            <div class="clearDiv">&nbsp;</div>
            <div class="labelDiv">@Html.LabelFor(v => v.Quantity)</div>
            <div class="shortTxtDiv">@Html.DisplayFor(v => v.Quantity) </div>
            <div class="clearDiv">&nbsp;</div>
            <div class="labelDiv">@Html.LabelFor(v => v.RequestNote)</div>
            <div class="shortTxtDiv">@Html.DisplayFor(v => v.RequestNote) </div>
            <div class="clearDiv">&nbsp;</div>
            <div class="labelDiv">@Html.LabelFor(v => v.PreferredOrderDate)</div>
            <div class="shortTxtDiv" id="date">@Html.DisplayFor(v => v.PreferredOrderDate) </div>
            <div class="clearDiv">&nbsp;</div>
            <div class="labelDiv">@Html.LabelFor(v => v.RequestStatus)</div>
            <div class="shortTxtDiv">@Html.DisplayFor(v => v.RequestStatusName) </div>

            @if (Model.RequestStatus == 3)
            {   
                <div class="clearDiv">&nbsp;</div>
                <div class="labelDiv">@MessageResource.CampaignRequest_Display_RejectionNote</div>
                <div class="shortTxtDiv">@Html.DisplayFor(v => v.RejectionNote) </div>
            }

            @if (Model.RequestStatus == 2)
            {
                <div class="clearDiv">&nbsp;</div>
                <div class="labelDiv">@Html.LabelFor(v => v.UpdateUserName)</div>
                <div class="shortTxtDiv">@Html.DisplayFor(v => v.UpdateUserName) </div>
            }


            <div class="clearDiv">&nbsp;</div>
            <div class="labelDiv">@Html.LabelFor(v => v.VerihcleModelCode)</div>
            <div class="shortTxtDiv">@Html.DisplayFor(v => v.VerihcleModelCode) </div>
            <div class="clearDiv">&nbsp;</div>

        </div>

        <div style="width:50%;float:left;" class="@(String.IsNullOrEmpty(Model.CampaignVinCodes)?"hide":"")">
            

            <div class="labelDiv campLabel vinSearches">@MessageResource.CampaignRequest_Display_VinNumbers</div>
            <div class="shortTxtDiv vinSearches">
                <input id="campVinSearch" type='text' class='k-input' onkeyup='searchVinNo(this.value);' placeholder='@MessageResource.CampaignRequest_Display_SearchVin' />


                <div class="campVin">

                </div>
                <div class="btn-group campTools">
                    <button class="orderVinBtn btn btn-primary" type="button" onclick="ReOrderVinList();">@MessageResource.CampaignRequest_Display_OrderVin</button>
                    <button class="clearVinBtn btn btn-danger" type="button" onclick="clearSelectedVins();">@MessageResource.CampaignRequest_Display_ClearVin</button>
                </div>

            </div>


            <div class="clearDiv">&nbsp;</div>
            
        </div>
    </div>

    <style>
        .clearVinBtn, .orderVinBtn {
            display: none;
            width: 100px;
        }

        .vinSearches {
            display: none;
        }

        .vinNumbers {
            border-bottom: 1px solid #dfd6d6;
            padding: 3px;
            margin: 3px;
        }

            .vinNumbers label {
                font-size: 11.9px !important;
                line-height: 12px !important;
                font-weight: bold;
                cursor: pointer;
            }

            .vinNumbers:hover {
                background-color: #eeebeb;
            }

        .vinNumbersHovered {
            background-color: #eeebeb;
        }

        .campVin {
            background-color: white;
            max-height: 150px !important;
            overflow-y: scroll !important;
            width: 200px;
            padding-top: 0px;
            text-align: center;
        }
    </style>

    <script>

        $(document).ready(documentInit());

        function documentInit() {


            $("#campVinSearch").bind('paste', function (event) {
                setTimeout(function () {
                    searchVinNo($("#campVinSearch").val());
                }, 250);
            });


            @*if (@Model.WodCampaignRequestId>0) //iş emrinden geliyorsa şasi seçmesin.
            {
                $(".vinSearches").show();
                $(".vinSearches:nth-child(2)").html('@Model.CampaignVinCodes');
            }
            else {*@
                LoadCampVins(@Model.CampaignCode);
            //}



        }


        function ReOrderVinList() {

            var vinNumberList = $(".vinNumbers").sort(function (a, b) {

                var sortA = parseInt($(a).attr("order"));
                var sortB = parseInt($(b).attr("order"));
                return (sortA < sortB) ? -1 : (sortA > sortB) ? 1 : 0;
            });

            $("#campVinSearch").val('');
            searchVinNo('');
            $(".campVin").html(vinNumberList);
            $(".campVin").scrollTop(0);
        }

        function LoadCampVins(CampCode)
        {

            $.post('@Url.Action("GetCampaignVinNumbers", "CampaignRequest")',
            {
                CampaignCode: CampCode

            }, function (data) {

                var html = "";

                if (data.Data.length>0) {
                    $(".vinSearches").show();
                }

                var selectedVins = '@Model.CampaignVinCodes';

                var isWorkOrderRelated = parseInt(@Model.WodCampaignRequestId) > 0;
                var isApproved = '@(Model.RequestStatus == (int)CommonValues.CampaignRequestStatus.Approved)';

                if (isWorkOrderRelated) {
                    html += "<div  class='vinNumbers vinNumbersHovered' vin='" + selectedVins + "' order='1'>";
                    html += "<b style='display:inline-block;width:18px;'></b>";
                    html += "<label>" + selectedVins + "</label>";
                    html += "</div>";
                }
                else {

                    $.each(data.Data, function () {

                        var dex = selectedVins.indexOf(this.VinNo);

                        var currentDexhtml = "";

                        currentDexhtml += "<div  class='vinNumbers " + (dex > -1 ? "vinNumbersHovered" : "") + "' vin='" + this.VinNo + "' order='" + (dex > -1 ? "1" : "2") + "'>";
                        currentDexhtml += "<label>";
                        currentDexhtml += this.VinNo;
                        currentDexhtml += "</label>";
                        currentDexhtml += "</div>";

                        //isApproved == "True" &&
                        if ( dex < 0) { // seçili değilse basma. sadece bu sayfa için istendi
                            currentDexhtml = "";
                        }

                        html += currentDexhtml;

                    });


                }


              


                $(".campVin").html(html);
                ReOrderVinList();


            });

        }

    function searchVinNo(searchKey) {

        searchKey = searchKey.toLocaleLowerCase();

        var vinNumbers = $(".vinNumbers");

        $.each(vinNumbers, function () {

            var currentElem = $(this);
            var currentVin = currentElem.attr("vin").toLocaleLowerCase();

            if (searchKey.indexOf(',') > -1) {
                var searchKeyArray = searchKey.split(',');

                var exitFlag = 0;
                $.each(searchKeyArray, function () {

                    if (currentVin.indexOf(this) > -1) {
                        currentElem.show();
                        exitFlag = 1;
                    }
                    else {
                        currentElem.hide();
                    }

                    if (exitFlag == 1) {
                        return false;
                    }

                });
            }
            else {
                if (currentVin.indexOf(searchKey) > -1) {
                    currentElem.show();
                }
                else {
                    currentElem.hide();
                }
            }

        });


        }

    </script>


<br />

<script type="text/javascript">
    $(document).ready(function () {
        $("#date").text($("#date").text().replace(".", "/").replace(".", "/"));
    });
</script>


<script>
    $(function () {
        adjustPage();
    });

    function adjustPage() {
        $("#popupContentWrapper").css("height", 440);
    }
</script>




