@model ODMSModel.ObjectSearch.FleetSearchViewModel

@{
    Layout = "~/Views/Shared/Popup_Layout.cshtml";
}

@helper DynamicBodySize()
{
@Html.Raw(string.Format("<style> #bodyContainer {{ height: {0}px; width: {1}px; }}</style>", "490", "1330"))
}

@DynamicBodySize()


<div id="bodyContainer">
<div id="searchCriterias">
<div class="labelDiv">@Html.LabelFor(v => v.FleetName)</div>
    <div class="shortTxtDiv">@Html.TextBoxFor(v => v.FleetName)</div>
    <div class="labelDiv">@Html.LabelFor(v => v.FleetCode)</div>
    <div class="shortTxtDiv">@Html.TextBoxFor(v => v.FleetCode)</div>
    <div class="clearfix"></div>
<div class="labelDiv">@Html.LabelFor(v => v.IsPartConstricted)</div>
<div class="shortTxtDiv"> @Html.Kendo().ComboBoxFor(v => v.IsPartConstricted).DataTextField("Text").DataValueField("Value").BindTo(ViewBag.YesNoList as List<SelectListItem>).Placeholder(CommonUtility.GetResourceValue("Global_Display_Choose"))</div>
<div class="clearfix"></div>
</div>
@ODMSHelpers.LinkButton("btnSearch", ODMSCommon.Resources.MessageResource.Global_Display_Search, "", "", "", CommonValues.PermissionCodes.FleetSearch.FleetSearchIndex)
@ODMSHelpers.LinkButton("btnClear", ODMSCommon.Resources.MessageResource.Global_Display_Clear, "", "", "", "")

<div class="kendoGridDivObjectSearch" id="grd">
@(Html.Kendo().Grid<ODMSModel.ObjectSearch.FleetSearchListModel>()
          .Name("grid")

          .Columns(columns =>
          {
              columns.Bound(v => v.FleetId).ClientTemplate("<center><a class='loadTab' onclick='selectFleet(#=FleetId#,\"#=FleetName#\")' id='#=FleetId#'><img class=iconLink src='" + Url.Content("~/Images/choose.ico") + "'/></a></center>").Title(ODMSCommon.Resources.MessageResource.Global_Display_Select).Width(50).Sortable(false);
              columns.Bound(v => v.FleetCode).Width(200).Sortable(true);
              columns.Bound(v => v.FleetName).Width(300).Sortable(true);
              columns.Bound(v => v.IsConstrictedName).Width(180).Sortable(true);
              columns.Bound(v => v.OtokarLabourDiscountRate).Width(180).Sortable(true);
              columns.Bound(v => v.OtokarPartDiscountRate).Width(180).Sortable(true);
              columns.Bound(v => v.DealerLabourDiscountRate).Width(180).Sortable(true);
              columns.Bound(v => v.DealerPartDiscountRate).Width(180).Sortable(true);
              columns.Bound(v => v.StartDateTime).Width(180).Format("{0:dd/MM/yyyy}").Sortable(true);
              columns.Bound(v => v.EndDateTime).Width(180).Format("{0:dd/MM/yyyy}").Sortable(true);
          })
          .Pageable()
          .Sortable()
          .Scrollable()
          .DataSource(dataSource => dataSource
                                        .Ajax()
                                        .PageSize(ODMSCommon.CommonValues.GridPageSize.Short)
                                        .ServerOperation(true)
                                        .Read(read => read.Action("SearchFleet", "ObjectSearch", Model).Data("FleetSearch"))
                                        .Model(model => model.Field(o => o.FleetId).DefaultValue(-1)))
          )
</div>
</div>

<script type="text/javascript">
    function FleetSearch() {
        return {
            FleetName: $('#FleetName').val(),
            FleetCode: $('#FleetCode').val(),
            IsPartConstricted: $('#IsPartConstricted').val()
        };
    }

    function selectFleet(fleetId,fleetName) {
        if (fleetName == null || fleetName == '')
            fleetName = "-";
        console.log(fleetId)

        if (window.parent != "undefined") {
            var currentWindowState = window.parent.getWindowState("@Model.ReferenceObjectId" + "SearchWindow", false);
                var parentSetterFunctionName = "setFoundValuesFor" + "@Model.ReferenceObjectId";
            window.parent[parentSetterFunctionName]("@Model.ReferenceObjectId", fleetId, fleetName, "@Model.SelectCallBackFunction", currentWindowState);
            }

        }

        $(document).ready(function () {
            $("#btnSearch").on("click", function (e) {
                var grid = $('#grid').data('kendoGrid');
                grid.dataSource.page(1);
            });

            $("#btnClear").on("click", function (e) {
                $('#searchCriterias').find('input:text').val('');
                var grid = $('#grid').data('kendoGrid');
                grid.dataSource.page(1);
            });
        });

</script>
<style>
    body
    {
        background-color: #EDF1F4 !important;
        overflow-x: hidden;
    }

    .kendoGridDivObjectSearch
    {
        width: 1300px;
        padding-bottom: 30px;
    }
</style>
