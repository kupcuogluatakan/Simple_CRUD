@using ODMSModel.PurchaseOrderDetail
@model ODMSModel.ObjectSearch.PurchaseOrderSearchViewModel

@{
    Layout = "~/Views/Shared/Popup_Layout.cshtml";
}

@helper DynamicBodySize()
{
@Html.Raw(string.Format("<style> #bodyContainer {{ height: {0}px; width: {1}px; }}</style>", "490", "1330"))
}

@DynamicBodySize()


<div id="bodyContainer">
<div id="searchCriterias">
    <div class="labelDiv">@Html.LabelFor(v => v.PoNumber)</div>
    <div class="shortTxtDiv">@Html.TextBoxFor(v => v.PoNumber)</div>
    <div class="labelDiv">@Html.LabelFor(v => v.IdStockType)</div>
    <div class="shortTxtDiv">@Html.Kendo().ComboBoxFor(v => v.IdStockType).DataTextField("Text").DataValueField("Value").BindTo(ViewBag.StockTypeList as List<SelectListItem>).Placeholder(CommonUtility.GetResourceValue("Global_Display_Choose"))</div>
    <div class="clearDiv"></div>
    <div class="labelDiv">@Html.LabelFor(v => v.DesiredShipDate)</div>
    <div class="shortTxtDiv">@Html.Kendo().DatePickerFor(c=>c.DesiredShipDate).Format("dd/MM/yyyy").ParseFormats(new []{"dd.MM.yyyy"}).HtmlAttributes(new { type = "text" })</div>
    <div class="labelDiv">@Html.LabelFor(v => v.PoType)</div>
    <div class="shortTxtDiv">@Html.Kendo().ComboBoxFor(v => v.PoType).DataTextField("Text").DataValueField("Value").BindTo(ViewBag.PoTypeList as List<SelectListItem>).Placeholder(CommonUtility.GetResourceValue("Global_Display_Choose"))</div>
    <div class="clearDiv"></div>
</div>
@ODMSHelpers.LinkButton("btnSearch", ODMSCommon.Resources.MessageResource.Global_Display_Search, "", "", "", "")
@ODMSHelpers.LinkButton("btnClear", ODMSCommon.Resources.MessageResource.Global_Display_Clear, "", "", "", "")

<div class="kendoGridDivObjectSearch" id="grd">
@(Html.Kendo().Grid<ODMSModel.ObjectSearch.PurchaseOrderSearchListModel>()
          .Name("grid")

          .Columns(columns =>
              {
                  columns.Bound(v => v.PoNumber).ClientTemplate("<center><a class='loadTab' onclick='selectFleet(#=PoNumber#)' id='#=PoNumber#'><img class=iconLink src='" + Url.Content("~/Images/choose.ico") + "'/></a></center>").Title(ODMSCommon.Resources.MessageResource.Global_Display_Select).Width(50).Sortable(false);
                  columns.Bound(c => c.PoTypeName).Sortable(true);
                  columns.Bound(c => c.Plate).Sortable(true);
                  columns.Bound(c => c.VinNo).Sortable(true);
                  columns.Bound(c => c.DesiredShipDate).Sortable(true);
                  columns.Bound(c => c.StatusName).Sortable(true);
              })
          .Pageable()
          .Sortable()
          .Scrollable()
          .ClientDetailTemplateId("template")
          .Events(events => events.DataBound("dataBound"))
          .DataSource(dataSource => dataSource
                                        .Ajax()
                                        .PageSize(ODMSCommon.CommonValues.GridPageSize.Short)
                                        .ServerOperation(true)
                                        .Read(read => read.Action("SearchPurchaseOrder", "ObjectSearch", Model).Data("PurchaseOrderSearch"))
                                        .Model(model => model.Field(o => o.PoNumber).DefaultValue(-1)))
          )
</div>
</div>
<script id="gridCheckBox" type="text/kendo-tmpl">
 <input type='checkbox' name='chkSelect' data-value='#=PurchaseOrderDetailSeqNo#' />

</script>   
<script id="template" type="text/kendo-tmpl">
    @(Html.Kendo().Grid<PurchaseOrderDetailListModel>()
          .Name("grid_#=PoNumber#")
          .Columns(columns =>
          {
              columns.Bound("").Width(100).ClientTemplate( "<input type='checkbox' name='chkSelect' /> ");
              columns.Bound(p => p.PurchaseOrderDetailSeqNo).Width(100).Sortable(true);
              columns.Bound(p => p.PartName).Width(100).Sortable(true);
              columns.Bound(p => p.PackageQuantity).Width(100).Sortable(true);
              columns.Bound(p => p.DesireQuantity).Width(100).Sortable(true);
              columns.Bound(p => p.OrderQuantity).Width(100).Sortable(true);
              columns.Bound(p => p.OrderPrice).Width(100).Sortable(true);
              columns.Bound(p => p.StatusName).Width(100).Sortable(true);
          })
          .DataSource(dataSource => dataSource
              .Ajax()
              .PageSize(10)
              .Read(read => read.Action("ListPurchaseOrderDetail", "ObjectSearch", new { PoNumber = "#=PoNumber#" }))
          )
          .Pageable()
          .Sortable()
          .ToClientTemplate())


</script>

<script type="text/javascript">
    function PurchaseOrderSearch() {
        return {
            PoNumber: $('#PoNumber').val(),
            IdStockType: $('#IdStockType').val(),
            PoType: $('#PoType').val(),
            DesiredShipDate: $('#DesiredShipDate').val()
        };
    }

    function dataBound() {
        this.expandRow(this.tbody.find("tr.k-master-row").first());
    }

    function selectFleet(fleetId) {


        //$('#grid').on('click', '.chkbx', function () {
        //    var checked = $(this).is(':checked');
        //    var grid = $('#grid').data().kendoGrid;
        //    var dataItem = grid.dataItem($(this).closest('tr'));
        //    dataItem.set('IsAdmin', checked);
        //})
        var items = new Array();
        var grid = $('#grid_' + fleetId).data().kendoGrid;
        $('#grid_' + fleetId + ' input[type=checkbox]').each(function (i, e) {
            if ($(e).is(':checked')==true){
                var dataItem = grid.dataItem($(e).closest('tr'));
                items.push(dataItem.PurchaseOrderDetailSeqNo);
            }
        });

        var serializedItems = JSON.stringify(items);
        if (window.parent != "undefined") {
            var currentWindowState = window.parent.getWindowState("@Model.ReferenceObjectId" + "SearchWindow", false);
                var parentSetterFunctionName = "setFoundValuesFor" + "@Model.ReferenceObjectId";
            window.parent[parentSetterFunctionName]("@Model.ReferenceObjectId", '' + serializedItems + '', fleetId,"@Model.SelectCallBackFunction", currentWindowState);
            }

        }

        $(document).ready(function () {
            $("#btnSearch").on("click", function (e) {
                var grid = $('#grid').data('kendoGrid');
                grid.dataSource.page(1);
            });

            $("#btnClear").on("click", function (e) {
                $('#searchCriterias').find('input:text').val('');
                var grid = $('#grid').data('kendoGrid');
                grid.dataSource.page(1);
            });
        });

</script>
<style>
    body
    {
        background-color: #EDF1F4 !important;
        overflow-x: hidden;
    }

    .kendoGridDivObjectSearch
    {
        width: 1300px;
        padding-bottom: 30px;
    }
</style>
