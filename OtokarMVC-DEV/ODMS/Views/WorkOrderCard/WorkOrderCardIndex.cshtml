@using System.Globalization
@using ODMSCommon.Resources
@using ODMSCommon.Security
@using ODMSModel.WorkOrderCard
@model WorkOrderCardModel
@{
    ViewBag.Title = MessageResource.WorkOrderCard_PageTitle_Index + " (" + Model.WorkOderId + ")";
    bool HasMaint = Model.DetailList.Any(c => c.IndicatorType == IndicatorType.PeriodicMaint || c.IndicatorType == IndicatorType.CouponMaint);
    var campaignCheckList = ViewBag.CampaignCheckList as List<CampaignCheckModel>;
    var campaignCheckMessage = string.Empty;
    ViewBag.IsVehicleLeft = Model.VehicleLeaveDate.HasValue;


}

<script src="~/Scripts/Tooltipster/jquery.tooltipster.min.js"></script>
<link href="~/Style/Tooltipster/tooltipster.css" rel="stylesheet" />
<link href="~/Style/Tooltipster/tooltipster-shadow.css" rel="stylesheet" />
<script src="~/Scripts/jQuery.print.js"></script>


<style type="text/css">
    #tblWorkOrderDetails {
        border-spacing: 0px;
        margin: 0;
    }

        #tblWorkOrderDetails thead.fixed {
            position: fixed;
            top: 0;
            background-color: #ffffff;
            z-index: 1000;
        }

    .seperator {
        border-bottom: 1px solid #cbcbcb;
        margin: 2px 0;
    }

    .table tbody tr.info > td {
        background-color: #D9EDF7;
        font-weight: bold;
    }

    button:focus {
        -moz-outline: 0 none !important;
        outline: 0 none !important;
    }

    a {
        cursor: default;
    }

    .fa-caret-right {
        margin-right: 4px;
    }

    .part-theme {
        background: white;
        border: 1px solid #c6c6c6;
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
        border-radius: 5px;
        color: #090909;
    }

        .part-theme .tooltipster-content {
            font-size: 12px;
            font-weight: 400;
            line-height: 14px;
            padding: 15px 18px;
        }

            .part-theme .tooltipster-content ul {
                margin: 0;
                padding: 0;
                list-style: none;
            }

                .part-theme .tooltipster-content ul li {
                    list-style: none;
                    padding: 0 0 5px;
                }

                    .part-theme .tooltipster-content ul li span.value {
                        padding-left: 10px;
                    }

    .k-widget.k-tooltip {
        background-color: white;
        color: #090909;
    }

    .tooltip-content {
        background-color: white;
        text-align: left;
        padding: 10px;
    }

        .tooltip-content .bold {
            padding-right: 12px;
        }

    .color-box-wrapper {
        display: inline-block;
        margin: 0 5px;
        text-align: center;
    }

    .color-box {
        border-radius: 15px;
        content: "";
        display: inline-block;
        height: 15px;
        width: 15px;
    }

    .menu {
        background-color: white;
    }

    ._blue {
        background-color: #D9EDF7;
    }

    .table > thead > tr > td._blue,
    .table > tbody > tr > td._blue,
    .table > tfoot > tr > td._blue,
    .table > thead > tr > th._blue,
    .table > tbody > tr > th._blue,
    .table > tfoot > tr > th._blue,
    .table > thead > tr._blue > td,
    .table > tbody > tr._blue > td,
    .table > tfoot > tr._blue > td,
    .table > thead > tr._blue > th,
    .table > tbody > tr._blue > th,
    .table > tfoot > tr._blue > th {
        background-color: #D9EDF7;
    }
</style>
@if (!ViewBag.HideElements)
{
    <div id="workOrderWrap" class="container" style="max-width: 100%;">
        @if (campaignCheckList != null && campaignCheckList.Count > 0)
        {
            <div class="panel panel-danger">
                <div class="panel-heading">
                    @MessageResource.WorkOrderCard_Display_CriticalCampaignMessage
                </div>
                <div class="panel-body">
                    <div class="well">
                        <strong>@MessageResource.WorkOrderCard_Display_MandatoryCampaignsMessage</strong>
                    </div>
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>@MessageResource.Campaign_Display_CampaignCode</th>
                                <th>@MessageResource.Campaign_Display_CampaignName</th>
                                <th>@MessageResource.WorkOrderCard_Display_HasStock</th>
                                <th>@MessageResource.WorkOrderCard_Display_TotalLabourDuration</th>
                                <th>@MessageResource.Global_Display_Add</th>

                            </tr>
                        </thead>
                        @foreach (var item in campaignCheckList)
                        {
                            <tr>
                                <td>@item.CampaignCode</td>
                                <td>@item.Description</td>
                                <td>
                                    @if (item.HasStock)
                                    {
                                        <strong style="color: #5cb85c"><i class="glyphicon glyphicon-ok"></i></strong>
                                    }
                                    else
                                    {
                                        <strong style="color: #d9534f"><i class="glyphicon glyphicon-remove"></i></strong>
                                    }
                                </td>
                                <td>@item.TotalLabourDuration</td>
                                <td>
                                    <a class="k-link" onclick="AddCampaign(this,'@item.CampaignCode')">
                                        <img src="@Url.Content("~/Images/add2.png")" />
                                    </a>
                                </td>

                            </tr>
                        }
                    </table>
                </div>
            </div>
            <div>
            </div>


        }



        <div class="panel-group" id="accordion" style="margin-bottom: 5px;">
            @if (Model.ApplicableFleetId.GetValueOrDefault(0) > 0)
            {
                @Html.Action("ApplicableFleet", new { id = Model.ApplicableFleetId })
            }
            <div class="panel panel-default ">
                <div class="panel-heading">
                    <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseVehicle">
                        <strong style="font-size: 16px;">
                            @MessageResource.Appointment_Display_Vehicle
                        </strong>
                    </a>
                </div>
                <div id="collapseVehicle" class="panel-body panel-collapse collapse" style="height: 0px">
                    <table class="table table-bordered table-zipped">
                        <tbody>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Appointment_Display_VehicleModel :</th>
                                <td class="col-md-3">@Model.Vehicle.VehicleModel</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Appointment_Display_VehicleType :</th>
                                <td class="col-md-3">@Model.Vehicle.VehicleType</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_VehicleDefinition :</th>
                                <td class="col-md-3">@Model.Vehicle.VehicleCode</td>
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_Plate:</th>
                                <td class="col-md-3 vtnr" style="border-top: 0 !important">
                                    <span id="VehiclePlate">@Model.Vehicle.Plate </span>
                                    <a id="btnUpDateVehiclePlate" class="k-link" onclick=" UpDateVehiclePlate(this) "><i class="glyphicon glyphicon-edit"></i></a>
                                </td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_VinNo :</th>
                                <td class="col-md-3">@Model.Vehicle.VinNo</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_EngineNo :</th>
                                <td class="col-md-3">@Model.Vehicle.EngineNo</td>
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_EngineType :</th>
                                <td class="col-md-3">
                                    @Model.Vehicle.EngineType

                                </td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyStartDate :</th>
                                <td class="col-md-3">
                                    @if (Model.Vehicle.WarrantyStartDate != default(DateTime))
                                    {
                                        @Model.Vehicle.WarrantyStartDate.GetValueOrDefault().ToString("dd/MM/yyyy").Replace(".", "/")
                                    }
                                    else
                                    {
                                        @Html.Raw("-")
                                    }
                                </td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyEndDate :</th>
                                <td class="col-md-3">
                                    @if (Model.Vehicle.WarrantyEndDate != default(DateTime))
                                    {
                                        @Model.Vehicle.WarrantyEndDate.GetValueOrDefault().ToString("dd/MM/yyyy").Replace(".", "/")
                                    }
                                    else
                                    {
                                        @Html.Raw("-")
                                    }

                                </td>
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_PaintWarrantyEndDate :</th>
                                <td class="col-md-3">
                                    @if (Model.Vehicle.PaintWarrantyEndDate.HasValue && Model.Vehicle.PaintWarrantyEndDate != default(DateTime))
                                    {
                                        @Model.Vehicle.PaintWarrantyEndDate.GetValueOrDefault().ToString("dd/MM/yyyy").Replace(".", "/")
                                    }
                                    else
                                    {
                                        @Html.Raw("-")
                                    }
                                </td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_CorrosionWarrantyEndDate :</th>
                                <td class="col-md-3">
                                    @if (Model.Vehicle.CorrosionWarrantyEndDate.HasValue && Model.Vehicle.CorrosionWarrantyEndDate != default(DateTime))
                                    {
                                        @Model.Vehicle.CorrosionWarrantyEndDate.GetValueOrDefault().ToString("dd/MM/yyyy").Replace(".", "/")
                                    }
                                    else
                                    {
                                        @Html.Raw("-")
                                    }
                                </td>
                                @if (Model.Vehicle.IsHourMaint)
                                {
                                    <td colspan="2" class="col-md-4 t-customhead" style="padding: 0 !important">
                                        <table class="col-md-12">
                                            <tr>
                                                <th class="col-md-3 teksatir t-customhead" style="border-top: 0 !important"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_VehicleKilometer :</th>
                                                <td class="col-md-3 vtnr" style="border-top: 0 !important">
                                                    <span id="VehicleKM">@Model.Vehicle.VehicleKilometer </span>
                                                    @if (!Model.VehicleLeaveDate.HasValue)
                                                    {
                                                        <a id="btnUpDateVehicleKM" class="k-link" onclick=" UpDateVehicleKMFromUpdateBtn(this) "><i class="glyphicon glyphicon-edit"></i></a>
                                                    }
                                                </td>
                                                <th class="col-md-3 teksatir t-customhead" style="border-top: 0 !important; border-left: 1px solid rgba(204, 204, 204, 1);"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_Hour :</th>
                                                <td class="col-md-3 vtnr" style="border-top: 0 !important">
                                                    <span id="VehicleHour">@Model.Vehicle.VehicleHour </span>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                }
                                else
                                {
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_VehicleKilometer :</th>
                                    <td class="col-md-3">
                                        <span id="VehicleKM">@Model.Vehicle.VehicleKilometer </span>
                                        @if (!Model.VehicleLeaveDate.HasValue)
                                        {
                                            <a id="btnUpDateVehicleKM" class="k-link" onclick=" UpDateVehicleKMFromUpdateBtn(this) "><i class="glyphicon glyphicon-edit"></i></a>
                                        }
                                    </td>
                                }
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_WarrantyStatus :</th>
                                <td class="col-md-3">
                                    @*@if (Model.Vehicle.WarrantyStartDate.HasValue)
                                        {

                                            if (Model.Vehicle.WarrantyEndDate > Model.WorkOrderDate)
                                            {
                                                <text>@MessageResource.WorkOrderCard_Display_VehicleWarranty</text>
                                            }
                                            else
                                            {
                                                <text>@MessageResource.WorkOrderCard_Display_VehicleOutOfWarranty</text>
                                            }

                                        }
                                        else
                                        {
                                            @Html.Raw("-")
                                        }*@
                                    @if (Model.Vehicle.WarrantyStatus)
                                    {
                                        <text>@MessageResource.WorkOrderCard_Display_VehicleWarranty</text>
                                    }
                                    else
                                    {
                                        <text>@MessageResource.WorkOrderCard_Display_VehicleOutOfWarranty</text>
                                    }
                                </td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.VehicleBodywork_Display_BodyworkName:</th>
                                <td id="VehicleLocation" class="col-md-7" colspan="4">
                                    @Model.Vehicle.BodyWorkName
                                    @if (Model.Vehicle.IsBodyWorkRequired)
                                    {
                                        <a class="k-link" id="btnBodyWorkProcess" onclick="BodyWorkProcess(this)">
                                            <i class="glyphicon glyphicon-edit"></i>
                                        </a>
                                    }

                                </td>
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead" colspan="6">
                                    <i class="fa fa-envelope-o" style="margin-bottom: 4px;"></i>
                                    @MessageResource.WorkOrderCard_Display_VehicleContactInfo
                                    <a class="k-link" onclick="OpenVehicleContactInfo(this)">
                                        <i class="glyphicon glyphicon-edit"></i>
                                    </a>
                                </th>
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead">
                                    <i class="fa fa-caret-right"></i>
                                    @MessageResource.WorkOrderCard_Display_VehicleLocation
                                </th>

                                <td id="VehicleLocation" class="col-md-3">@Model.Vehicle.Location</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_VehicleResponsible :</th>
                                <td id="VehicleResponsiblePerson" class="col-md-3">@Model.Vehicle.ResponsiblePerson</td>

                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_VehicleResponsiblePhone :</th>
                                <td id="VehicleResponsiblePersonPhone" class="col-md-3">@Model.Vehicle.ResponsiblePersonPhone</td>

                            </tr>


                        </tbody>
                    </table>

                </div>
            </div>

            <div class="panel panel-default ">
                <div class="panel-heading">

                    <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseCustomer">
                        <strong style="font-size: 16px;">
                            @MessageResource.Appointment_Display_Customer
                        </strong>
                    </a>

                </div>
                <div class="panel-body panel-collapse collapse" id="collapseCustomer" style="height: 0px">

                    <table class="table table-bordered table-zipped">
                        <tbody>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.CustomerAddress_Display_CustomerName :</th>
                                <td class="col-md-3">@Model.Customer.CustomerName</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Customer_Display_TCIdentityNo :</th>
                                <td class="col-md-3">@Model.Customer.TcIdentityNo</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.User_Display_Address :</th>
                                <td class="col-md-3">@Model.Customer.CustomerAddress</td>
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_ContactInfo :</th>
                                <td class="col-md-3"><span id="ContactInfo">@Model.ContactInfo</span> <a class="k-link" onclick="UpdateContactInfo(@Model.WorkOderId,this)"><i class="glyphicon glyphicon-edit"></i></a></td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Customer_Display_TaxOffice :</th>
                                <td class="col-md-3">@Model.Customer.TaxOffice</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Dealer_Display_TaxNo :</th>
                                <td class="col-md-3">@Model.Customer.TaxNo</td>
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrder_Display_ResponsibleConsultant :</th>
                                <td colspan="5" class="col-md-11">@Model.Customer.Staff </td>
                            </tr>

                        </tbody>
                    </table>

                </div>
            </div>

        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                @if (!Model.VehicleLeaveDate.HasValue)
                {
                    <button class="btn btn-info" onclick="AddWorkOrderDetail(this)">@MessageResource.WorkOrderCard_Display_AddDetail</button>

                    if (Model.HasCampaign && Model.Vehicle.IsCampaignApplicable)
                    {
                        @*<style>
                            .campBtn {
                                background-color: red !important;
                                color: white !important;
                                background-image: none !important;
                            }
                        </style>*@

                        <button class="btn btn-danger" onclick="AddCampaign(this)">@MessageResource.WorkOrder_Display_HasCampaignMessage</button>
                    }
                    if (!HasMaint && Model.Vehicle.WarrantyEndDate.GetValueOrDefault() != default(DateTime))
                    {
                        <button class="btn btn-info" onclick="AddMaintenance(0, this)">
                            @MessageResource.WorkOrderCard_Display_AddMeintenance
                        </button>
                    }

                }

                @if (Model.Vehicle.PdiCheck && !Model.Vehicle.IsPdiAccomplished && Model.Vehicle.IsPdiApplicable && !Model.VehicleLeaveDate.HasValue && Model.Vehicle.WorkOrderCount == 0)
                {
                    <button class="btn btn-info" onclick="AddPdiPackage(this)">@MessageResource.WorkOrderCard_Display_AddPdiPackage</button>
                }
                else if (Model.Vehicle.PdiCheck && Model.Vehicle.IsPdiAccomplished && Model.IsPdiOwner)
                {
                    <button class="btn btn-info" onclick="OpenPdiPackage(this)">
                        @MessageResource.WorkOrderCard_Display_PdiResultList
                    </button>
                }
                <button class="btn btn-info" id="btnVehicleHistory" onclick="OpenVehicleHistory(this)">@MessageResource.WorkOrderCard_Display_VehicleHistory</button>
                <a class="btn btn-info" href="@Url.Action("Print", new { id = Model.WorkOderId })" id="btnPrintWorkOrder">@MessageResource.WorkOrderCard_Display_Print</a>


                @if (HasMaint)
                {
                    <button class="btn btn-info" onclick="OpenPeriodicMaintControlList(this)">@MessageResource.PeriodicMaintControlList_PageTitle_Index</button>
                }
                @if (!Model.VehicleLeaveDate.HasValue && Model.Vehicle.IsHourMaint)
                {
                    <button class="btn btn-info" id="btnAddHourMaint" onclick="AddHourMaint(this)">@MessageResource.WorkOrderCard_Display_AddHourMaint</button>
                }
                <button class="btn btn-info" onclick="OpenVehicleNotes(this)">@MessageResource.WorkOrderCard_Display_VehicleNotes <span class="label label-danger">@Model.Vehicle.NoteCount</span></button>
                <a id="btnDisplayVehicleNotePopup" style="display:none;" class="k-link" onclick=" DisplayVehicleNotePopup(this) "><i class="glyphicon glyphicon-edit"></i></a>
                <button class="btn btn-info" onclick="OpenDealerNotes(this)">@MessageResource.WorkOrderCard_Display_DealerNotes <span class="label label-danger">@Model.Vehicle.DealerNoteCount</span></button>
                <button class="btn btn-info" onclick="OpenDocuments(this)">@MessageResource.WorkOrderCard_Display_Documents <span class="label label-danger">@Model.DocumentCount</span></button>
                @if (Model.Details.Any(c => c.InvoiceId.GetValueOrDefault(0) == 0) && Model.VehicleLeaveDate.HasValue)
                {
                    <button class="btn btn-info" onclick="OpenInvoiceWindow(this)">@MessageResource.WorkOrderInvoice_Dislay_FinishInvoice</button>
                }
                @if (!Model.VehicleLeaveDate.HasValue)
                {
                    <button class="btn btn-info" onclick="CheckVehicleLeave(this)">
                        @MessageResource.WorkOrderInvoice_Dislay_VehicleLeave
                    </button>
                }
                else
                {
                    <a class="btn btn-success" target="_blank" href="@Url.Action("GetWorkOrderVehicleLeave", new { id = Model.WorkOderId })">
                        @MessageResource.WorkOrderCard_Display_VehicleLeaveForm
                    </a>

                    if (!UserManager.UserInfo.IsDealer)
                    {
                        <button class="btn btn-danger" onclick="CancelVehicleLeave(this);">
                            @MessageResource.WorkOrder_Dislay_CancelVehicleLeave
                        </button>
                        <script>
                            function CancelVehicleLeave(obj) {

                                if ($(obj).hasClass("disabled")) return;
                                DisableClicks();
                                var title = $(obj).html();
                                $('#CancelVehicleLeaveWindow').kwnd('@Url.Action("CancelVehicleLeave", "WorkOrderCard", new { id = Model.WorkOderId })', '@Html.Raw(MessageResource.WorkOrder_Dislay_CancelVehicleLeave)',
                        {
                            iframe: false,
                            width: 800,
                            height: 400,
                            onClose: function() {
                                $("#CancelVehicleLeaveWindow").html('');
                                window.location.reload();
                            }
                        });
                                $('#CancelVehicleLeaveWindow').removeClass("hide");
                                OpenWindow($('#CancelVehicleLeaveWindow'));
                            }

                        </script>
                    }
                }
                @if (!Model.VehicleLeaveDate.HasValue && ODMSHelpers.UserHasPermission(CommonValues.PermissionCodes.WorkOrderCard.WorkOrderCardCancel))
                {
                    <button class="btn btn-danger pull-right" onclick="_CancelWorkOrder(@Model.WorkOderId,@Model.Vehicle.VehicleId,@Html.Raw("true"),this);">
                        <i class="glyphicon glyphicon-ban-circle"></i>@MessageResource.Global_Display_Cancel
                    </button>
                }

            </div>
        </div>

        <div id="work-order-grid" class="panel panel-default">
            <div class="panel-heading">
                <strong style="font-size: 16px;">
                    @String.Format(MessageResource.WorkOrderCard_Title_WorkOrderDetails, Model.WorkOderId) [@Model.DealerName]

                    <a class="btn" id="refresh-details-btn" onclick="RefreshDetails(this)"><i class="glyphicon glyphicon-refresh"></i></a><span class="ajax-loading hide"></span>
                    @if (Model.ProposalId != null)
                    {
                        @String.Format("Teklif No:{0} - Revizyon No:{1} Detayları", Model.ProposalId, Model.ProposalSeq)}
                </strong>

                <div style="display: inline-block" class="pull-right">
                    @if (Model.WorkOrderStatManualChangeAllow)
                    {
                        using (Html.BeginForm("SaveWorkOrderStat", "WorkOrderCard", FormMethod.Post))
                        {
                            @Html.HiddenFor(c => c.WorkOderId)
                            @Html.Kendo().DropDownListFor(c => c.WorkOrderStatId).AutoBind(true).DataValueField("Value").DataTextField("Text").BindTo(ViewBag.WorkOrderStatsList as List<SelectListItem>).Enable(Model.WorkOrderStatManualChangeAllow).HtmlAttributes(new { style = "width:200px" })
                            <button class="k-button btn-primary">
                                <i class="glyphicon glyphicon-check"></i><b>@MessageResource.Global_Display_Save</b>
                            </button>
                        }
                    }
                    else
                    {
                        @Html.Kendo().DropDownListFor(c => c.WorkOrderStatId).AutoBind(true).DataValueField("Value").DataTextField("Text").BindTo(ViewBag.WorkOrderStatsList as List<SelectListItem>).Enable(Model.WorkOrderStatManualChangeAllow).HtmlAttributes(new { style = "width:200px" })
                    }
                </div>
                <div class="clearfix"></div>

            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-lg-7">
                        @if (Model.FleetId.HasValue)
                        {
                            <div class="alert alert-info">

                                <strong>
                                    @Html.Raw(string.Format(MessageResource.WorkOrderCard_Display_FleetMessage, Model.Customer.CustomerName, Model.FleetName, Model.OtokarPartDiscountRate, Model.DealerPartDiscountRate, Model.OtokarLabourDiscountRate, Model.DealerLabourDiscountRate))
                                </strong>

                            </div>
                        }
                        <p>
                            <strong style="font-size: 14px;">@MessageResource.WorkOrder_Display_WorkOrderDate :</strong><em style="font-size: 13px; padding-left: 5px;">@Model.WorkOrderDate.ToString("dd MMMM yyyy HH:mm")</em> <span style="padding-left: 20px;">&nbsp;</span>
                            @if (Model.VehicleLeaveDate.HasValue)
                            {
                                <strong style="font-size: 14px;">@MessageResource.WorkOrderCard_Dislay_VehicleLeaveDate :</strong> <em style="font-size: 13px; padding-left: 5px;">@Model.VehicleLeaveDate.GetValueOrDefault().ToString("dd MMMM yyyy HH:mm") <span style="padding-left: 20px;"></span></em>
                            }
                        </p>
                        <p>
                            <strong style="font-size: 14px;">@MessageResource.Vehicle_Display_SpecialConditions : </strong><em style="font-size: 12px; padding-left: 5px;"><span style="">@Model.Vehicle.SpecialConditions</span></em> <span style="padding-left: 20px;">&nbsp;</span>

                        </p>
                        @if (UserManager.UserInfo.DealerID == 0)
                        {
                            <p>
                                <strong style="font-size: 14px;">@MessageResource.GRADGif_Display_Notes : </strong><em style="font-size: 12px; padding-left: 5px;"><span style="">@Model.Vehicle.Notes</span></em> <span style="padding-left: 20px;">&nbsp;</span>

                            </p>
                        }


                        <p>
                            <strong style="font-size: 14px;">@MessageResource.Appointment_Display_ComplaintDescription : </strong><em style="font-size: 12px; padding-left: 5px;"><span style="">@Model.CustomerNote</span></em> <span style="padding-left: 20px;">&nbsp;</span>

                            @if (!Model.VehicleLeaveDate.HasValue)
                            {
                                <button class="btn btn-warning" onclick="UpdateCustomerNote(@Model.WorkOderId,@Html.Raw("true"),this);">
                                    <i class="glyphicon glyphicon-edit"> </i> @MessageResource.Global_Display_Update
                                </button>
                            }

                        </p>
                        <div class="dropdown">
                            <a href="#" class="dropdown-toggle k-link" data-toggle="dropdown"><i class="glyphicon glyphicon-print"></i><span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li>
                                    <a class="k-link" onclick="PrintLabels(@Model.WorkOderId, true, this) ">
                                        @MessageResource.WorkOrderCard_Display_PrintLabels
                                    </a>
                                </li>
                                <li>
                                    <a class="k-link" onclick="PrintLabels(@Model.WorkOderId, false, this) ">
                                        @MessageResource.WorkOrderCard_Display_PrintUnprintedLabels
                                    </a>
                                </li>
                            </ul>
                            &nbsp; &nbsp; &nbsp; &nbsp;
                            <a class="k-link bold" onclick="OpenPickingCancellation(this);">@MessageResource.WorkOrderCard_Display_PickingCancellation</a>

                        </div>
                    </div>
                    <div class="col-lg-4 text-right">
                        <table class="table table-condensed text-left table-bordered">
                            <tr>
                                <th style="padding-right: 8px;">
                                    @MessageResource.WorkOrderCard_Display_AppointmentNo :
                                </th>
                                <td>
                                    @(Model.AppointmentId > 0 ? Html.Raw(Model.AppointmentId) : Html.Raw("-"))
                                </td>
                            </tr>
                            <tr>
                                <th style="padding-right: 8px;">
                                    @MessageResource.Appointment_Display_AppointmentDate :
                                </th>
                                <td>
                                    @(Model.AppointmentDate.GetValueOrDefault() == new DateTime(1900, 1, 1, 0, 0, 0) ? Html.Raw("-") : Html.Raw(Model.AppointmentDate))
                                </td>
                            </tr>
                            <tr>
                                <th style="padding-right: 8px;">
                                    @MessageResource.Appointment_Display_AppointmentType :
                                </th>
                                <td>
                                    @Model.AppointmentType
                                </td>
                            </tr>
                            <tr>
                                <th style="padding-right: 8px;">
                                    @MessageResource.WorkOrder_Display_ResponsibleConsultant :
                                </th>
                                <td>
                                    @Model.Customer.Staff
                                </td>
                            </tr>
                        </table>
                        @*<div class="color-box-wrapper">
                                <div class="color-box alert-danger"></div>
                                <div class="bold">@MessageResource.WorkOrderCard_PartQuantityStatus_NotEnoughStock</div>
                            </div>
                            <div class="color-box-wrapper">
                                <div class="color-box alert-warning"></div>
                                <div class="bold">@MessageResource.WorkOrderCard_PartQuantityStatus_WaitingForPicking</div>
                            </div>
                            <div class="color-box-wrapper">
                                <div class="color-box alert-success"></div>
                                <div class="bold">@MessageResource.WorkOrderCard_PartQuantityStatus_Picked</div>
                            </div>*@
                    </div>
                </div>
            </div>

            <div id="WorkOrderDetails">

                <table id="tblWorkOrderDetails" class="table table-striped table-bordered" style="width: 100%; margin: 10px auto 0;">
                    <thead>
                        <tr class="menu">
                            <th class="text-center">
                                @MessageResource.WorkOrderCard_Display_Indicator @MessageResource.Global_Display_Id / GIF NO
                            </th>
                            <th>@MessageResource.WorkOrderCard_Display_IndicatorStatus</th>
                            <th>@MessageResource.Work_Order_GuaranteeConfirmDesc</th>
                            <th>@MessageResource.WorkOrderCard_Display_Part</th>
                            <th>@MessageResource.WorkOrderCard_Display_Labour</th>
                            <th>@MessageResource.WorkOrderCard_Display_TechnicalDescription</th>
                            @if (Model.Details.Any(c => c.IsCampaign))
                            {
                                <th>
                                    @MessageResource.WorkOrderCard_Display_CampaingPartRequest
                                </th>
                            }
                            <th>@MessageResource.Global_Display_Cancel</th>
                            <th>@MessageResource.AppointmentIndicatorFailureCode_Display_Code</th>
                            <th>@MessageResource.WorkOrderCard_Display_Type</th>
                            <th>@MessageResource.WorkOrderCard_Display_PartLabourCode</th>
                            <th>@MessageResource.WorkOrderCard_Display_Description</th>
                            <th>@MessageResource.WorkOrderCard_Display_CountTime</th>
                            <th>@MessageResource.WorkOrderCard_Display_UnitPrice</th>
                            <th>@MessageResource.WorkOrderCard_Display_DiscountRatio</th>
                            <th>@MessageResource.WorkOrderCard_Display_TotalPrice</th>
                            <th>@MessageResource.WorkOrderCard_Display_WarrantyRatio</th>
                            <th>@MessageResource.GuaranteeRequestApprove_Display_WarrantyTotal</th>
                            <th class="teksatir" style="vertical-align: middle">
                                @if (!Model.VehicleLeaveDate.HasValue && Model.Details.Any(c => c.ReservedQuantity > 0) && !Model.IsCentralDealer)
                                {
                                    <a style="margin-left: 10px; color: #ff0000;" class="k-link picking blink_me" onclick="PickDetailParts(0, this) ">
                                        <i class="glyphicon glyphicon-plus-sign"></i>@MessageResource.WokrOrderCard_Display_Pick
                                    </a>
                                    <span class="ajax-loading hide"></span>
                                }
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (!Model.VehicleLeaveDate.HasValue)
                        {
                            foreach (var item in Model.DetailList.Where(c => c.InvoiceId.HasValue == false && !c.WarrantyStatus.In(1, 4, 5)))
                            {
                                <tr class="@(item.IsCanceled ? Html.Raw("danger") : Html.Raw("info")) text-center">
                                    <td>@item.WorkOrderDetailId / @item.GifNo </td>
                                    <td style="width: 60px">
                                        @if (item.GosApprovalNeed)
                                        {
                                            @item.WarrantyStatusDesc
                                            if (item.WarrantyStatus.In(3, 6))
                                            {
                                                <a class="k-link bstooltip" title="@item.GuaranteeConfirmDesc">
                                                    <i class="glyphicon glyphicon-info-sign"></i>
                                                </a>
                                            }
                                        }
                                        @if (item.InvoiceId.HasValue)
                                        {
                                            <span style="display: inline-block" class="bold text-success">@MessageResource.WorkOrderCard_Display_Invoiced</span>
                                        }
                                        else if (item.InvoiceId == null && item.IsBillable && item.InvoiceCancel)
                                        {
                                            <span style="display: inline-block" class="bold text-success">@MessageResource.WorkOrderCard_Not_Invoice</span>
                                        }
                                    </td>
                                    <td>
                                        <a class="k-link bstooltip" title="@item.GuaranteeConfirmDesc">
                                            <i class="glyphicon glyphicon-info-sign"></i>
                                        </a>
                                    </td>
                                    <!--Basılmamış etiketleri bas || Etiket bas-->
                                    <td class="text-center">
                                        @if (item.IndicatorType == IndicatorType.BreakDown && !item.WarrantyStatus.In(4, 5)
                                             && ODMSHelpers.UserHasPermission(CommonValues.PermissionCodes.WorkOrderCard.WorkOrderCardAddDetailItem))
                                        {
                                            <a class="k-link" onclick="AddPart(@item.WorkOrderDetailId, this); ">
                                                <img src="@Url.Content("~/Images/add2.png")" />
                                            </a>
                                        } &nbsp;
                                    </td>
                                    <td class="text-center">
                                        @if (item.IndicatorType == IndicatorType.BreakDown && !item.WarrantyStatus.In(4, 5)
                                             && ODMSHelpers.UserHasPermission(CommonValues.PermissionCodes.WorkOrderCard.WorkOrderCardAddDetailItem))
                                        {
                                            <a class="k-link" onclick="AddLabour(@item.WorkOrderDetailId, @Model.Vehicle.VehicleId, this); ">
                                                <img src="@Url.Content("~/Images/add2.png")" />
                                            </a>
                                        } &nbsp;
                                    </td>
                                    <td class="text-center">

                                        <a class="k-link bstooltip" title="@item.TechicalDescription" onclick="AddTechnicalDetail(@item.WorkOrderDetailId, this); ">
                                            <img src="@Url.Content("~/Images/edit.png")" />
                                        </a>

                                    </td>
                                    @if (Model.Details.Any(c => c.IsCampaign))
                                    {
                                        <td>
                                            @if (Model.Details.Any(c => c.IsCampaign && c.WorkOrderDetailId == item.WorkOrderDetailId && c.HasOtokarCampaignStock == false && c.CampaignRequestId == null))
                                                        {
                                                        

                                          if (item.IsCampaignCritical)
                                                {


                                                    <a class="k-link" onclick="CreateCampaignRequest(@item.WorkOrderDetailId, this) ">@MessageResource.CampaignRequest_PageTitle_Create </a>
                                            <span class="ajax-loading hide"></span>
                                                                    
                                        }

                                            }
                                            else if (Model.Details.Any(c => c.IsCampaign && c.WorkOrderDetailId == item.WorkOrderDetailId && c.HasOtokarCampaignStock == false && c.CampaignRequestId != null))
                                            {
                                                <a class="k-link" onclick="OpenCampaignRequestDetails(@item.WorkOrderDetailId, @Model.Details.FirstOrDefault(c => c.IsCampaign && c.WorkOrderDetailId == item.WorkOrderDetailId).CampaignRequestId, this) ">
                                                    <i class="glyphicon glyphicon-list"></i>
                                                </a>
                                            }

                                        </td>
                                    }
                                    <td class="text-center">

                                        @{
                                            var campaignRequestId = Model.Details.Any(c => c.IsCampaign && c.WorkOrderDetailId == item.WorkOrderDetailId && c.HasOtokarCampaignStock == false && c.CampaignRequestId != null) ?
                                                Model.Details.FirstOrDefault(c => c.IsCampaign && c.WorkOrderDetailId == item.WorkOrderDetailId).CampaignRequestId
                                                : 0;
                                        }
                                        @if (campaignRequestId == 0)
                                                {
                                            <a class="k-link" onclick="CancelWorkOrderDetail(@item.WorkOrderDetailId, @(!((int)item.IndicatorType).In((int)IndicatorType.BreakDown, (int)IndicatorType.Campaign) ? Html.Raw("true") : Html.Raw("false")), this) ">
                                                @MessageResource.Global_Display_Cancel
                                            </a>
                                        }
                                        else
                                        {
                                            <a class="k-link" onclick="CancelWorkOrderDetailWithCampaignRequest(@item.WorkOrderDetailId, @campaignRequestId, this) ">
                                                @MessageResource.Global_Display_Cancel
                                            </a>

                                        }
                                    </td>
                                    <td>
                                        <a class="bstooltip k-link" title="@item.FailureCodeDescription">@item.FailureCode</a>
                                        @if (item.AllowFailureCodeChange)
                                                {
                                            <span>&nbsp; - &nbsp;</span>

                                            <a class="k-link" onclick="UpdateFailureCode(@item.WorkOrderDetailId, '@item.FailureCode', this); "><i class="glyphicon glyphicon-edit"></i></a>
                                        }
                                    </td>
                                    <td>
                                        @item.ProcessType
                                        @if (Model.DetailList.FirstOrDefault(c => c.WorkOrderDetailId == item.WorkOrderDetailId).IsFromProposal == false)
                                        {
                                            <span>&nbsp; - &nbsp;</span>
                                            <a class="k-link" onclick="UpdateProcessType(@item.WorkOrderDetailId, this); "><i class="glyphicon glyphicon-edit"></i></a>
                                        }
                                    </td>
                                    <td>@item.Code</td>
                                    <td>@item.Description</td>
                                    <td>
                                        @if (Model.Details.Any(c => c.WorkOrderDetailId == item.WorkOrderDetailId && (c.Type == "PART" && c.ReservedQuantity + c.PickedQuantity - c.ReturnedQuantity != c.RequiredQuantity)) && !Model.IsCentralDealer)
                                        {
                                            <a class="k-link" href="javascript:void(0);" onclick="ReservDetailParts(@item.WorkOrderDetailId, this); "><i style="padding-right: 6px;" class="glyphicon glyphicon-repeat"></i>@MessageResource.WorkOrderCard_Display_Reserve</a>
                                        }
                                    </td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td class="text-center text-danger">
                                        @if (Model.VehicleLeaveDate.HasValue == false && item.GuarantyAuthorizationNeed && item.WarrantyStatus.In(0, 3) && Model.Details.Any(c => c.WorkOrderDetailId == item.WorkOrderDetailId && c.Type != "INDICATOR"))
                                        {
                                            <a class="k-link bstooltip" onclick="SendToWarrantyPreAppoval(@item.WorkOrderDetailId, this); " title="@MessageResource.WorkOrderCard_Message_WarrantyPreAppoval">

                                                <span class="blink_me" style="color: red">@MessageResource.WorkOrderCard_Display_SendToPreWarranty</span>
                                            </a>
                                            <span class="ajax-loading hide"></span>
                                        }
                                    </td>
                                    <td>&nbsp;</td>

                                    @if (!Model.IsCentralDealer)
                                                {
                                        <td class="teksatir">
                                            <a class="k-link picking" onclick="PickDetailParts(@item.WorkOrderDetailId, this) ">
                                                <i class="glyphicon glyphicon-plus-sign"></i>@MessageResource.WokrOrderCard_Display_Pick
                                            </a>
                                            <span class="ajax-loading hide"></span>
                                            <a> - </a>
                                            <a class="k-link picking" onclick="ReturnParts(@item.WorkOrderDetailId, this) ">
                                                <i class="glyphicon glyphicon-hand-left"></i>@MessageResource.Global_Display_Return
                                            </a>
                                            <span class="ajax-loading hide"></span>
                                        </td>
                                    }
                                </tr>
                                foreach (var detail in Model.Details.Where(c => c.WorkOrderDetailId == item.WorkOrderDetailId && c.Type != "INDICATOR"))
                                {
                                    <tr>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                        <td class="text-center @GetDismentledPartTdClass(detail,Model.DetailList.Where(x=>x.WorkOrderDetailId == detail.WorkOrderDetailId).FirstOrDefault().ProcessTypeCode) ">
                                            @if (detail.Type == "PART")
                                                {
                                                <a class="k-link bstooltip" title="@MessageResource.WorkOrderCard_Display_DismentledPart" onclick="OpenPartRemovalWindow(@item.WorkOrderDetailId, @detail.Id, this); "><i class="glyphicon glyphicon-edit"></i></a>
                                            }

                                        </td>


                                        @if (detail.Type == "LABOUR")
                                                {
                                            <td title="@GetLabourTdTitle(detail)" class="bstooltip text-center @GetLabourTdClass(detail.LabourWorkStatusId, detail.IsExternalLabour)">


                                                @if (!detail.IsExternalLabour)
                                                {
                                                    <a class="k-link btn-sm" onclick="OpenAssaignTechicianWindow(@item.WorkOrderDetailId, @detail.Id, this); ">@MessageResource.LabourTechnician_PageTitle_Index</a>


                                                }
                                                @if (detail.LabourWorkStatusId == 4)
                                                {
                                                    <button class="btn btn-danger" onclick="CancelLabourTecnician(@item.WorkOrderDetailId,@detail.Id,this);">
                                                        <i class="glyphicon glyphicon-ban-circle"></i>@MessageResource.Global_Display_Cancel
                                                    </button>
                                                }
                                            </td>
                                        }
                                        else
                                        {
                                            <td class="text-center">&nbsp;</td>
                                        }
                                        <td class="text-center">&nbsp;</td>
                                        @if (Model.Details.Any(c => c.IsCampaign))
                                        {
                                            <td>&nbsp;</td>
                                        }
                                        <td>
                                            @if (!detail.IsCampaign && detail.MaintenanceId == 0 && item.IndicatorType != IndicatorType.Pdi
                                                && ODMSHelpers.UserHasPermission(CommonValues.PermissionCodes.WorkOrderCard.WorkOrderCardDeleteDetailItem))
                                                {
                                                <a class="k-link" title="@MessageResource.Global_Display_Delete" onclick="DeleteItem(@item.WorkOrderDetailId, @detail.Id, '@detail.Type', this); "><i class="glyphicon glyphicon-trash"></i></a>
                                            }
                                            else if (detail.MaintenanceId > 0 && !detail.IsMust)
                                            {
                                                <a class="k-link" title="@MessageResource.Global_Display_Delete" onclick="RemoveMaintItem(@detail.MaintenanceId,@item.WorkOrderDetailId, @detail.Id, '@detail.Type', this); "><i class="glyphicon glyphicon-trash"></i></a>
                                            }
                                        </td>

                                        <td>&nbsp;</td>
                                        <td>
                                            @(detail.Type == "LABOUR" ? detail.IsExternalLabour ? MessageResource.WorkOrderCard_Display_ExternalLabour : MessageResource.WorkOrderCard_Display_Labour : MessageResource.WorkOrderCard_Display_Part)
                                        </td>
                                        <td class="@Html.Raw(detail.Type == "LABOUR" ? "labourCode" : "partCode")">@detail.Code</td>
                                        <td>
                                            @if (detail.Type == "PART")
                                                {
                                                    @detail.Name
                                                    <a class="k-link bstooltip" title="@detail.StockType">
                                                    <i class="glyphicon glyphicon-info-sign"></i>
                                                </a>
                                            }
                                            else
                                            {
                                                @detail.Name
                                            }

                                        </td>
                                        <td class="@(detail.Type == "PART" ? GetPartTdClass(detail.RequiredQuantity, detail.ReservedQuantity, detail.PickedQuantity, detail.ReturnedQuantity) : @Html.Raw(""))">
                                            @if (detail.Type == "PART")
                                                {
                                                    @detail.RequiredQuantity
                                            }
                                            else
                                            {
                                                <span>@Convert.ToInt32(detail.Quantity) / @detail.Duration</span>
                                            }
                                            @if (!detail.IsCampaign && item.IndicatorType != IndicatorType.Pdi)
                                                {
                                                    if (item.DetailType != DetailType.Meintenance)
                                                    {
                                                        @Html.Raw("&nbsp; - &nbsp;")
                                                        <a class="k-link" onclick="AddDetailQuantity(@detail.WorkOrderDetailId, @detail.Id, '@detail.Type', this); ">@MessageResource.Global_Display_Add</a>
                                                }
                                                else
                                                {
                                                    @Html.Raw("&nbsp; - &nbsp;")
                                                    <a class="k-link" onclick="EditMaintenanceQuantity(@detail.WorkOrderDetailId, @detail.Id, '@detail.Type', @detail.MaintenanceId, this); "><i class="glyphicon glyphicon-edit"></i></a>
                                                }
                                            }

                                            @if (detail.Type == "PART")
                                                {
                                                <a class="part-tooltip" title="@(GetPartToolTipHtml(detail.RequiredQuantity, detail.ReservedQuantity, detail.PickedQuantity, detail.ReturnedQuantity))">
                                                    <i class="glyphicon glyphicon-info-sign"></i>
                                                </a>
                                            }

                                        </td>
                                        <td>
                                            @detail.Price.RoundUp(2)
                                            @if (!detail.IsCampaign)
                                                {
                                                    @Html.Raw("&nbsp; - &nbsp;")
                                                    <a class="k-link" onclick="ChangePriceList(@detail.WorkOrderDetailId, @detail.Id, '@detail.Type', this); "><i class="glyphicon glyphicon-edit"></i></a>
                                                if (!Model.VehicleLeaveDate.HasValue && detail.Type == "LABOUR" && item.ProcessTypeCode == "PT_M")
                                                {
                                                    <a class="k-link" onclick="AddLabourPrice(@detail.WorkOrderDetailId, @detail.Id, '@detail.Type', this); "><i class="glyphicon glyphicon-plus-sign"></i></a>
                                                }
                                            }
                                            <a class="part-tooltip" title="@(GetPriceToolTipHtml(detail))">
                                                <i class="glyphicon glyphicon-info-sign"></i>
                                            </a>
                                        </td>
                                        @if (detail.Type == "PART" && !detail.IsCampaign)
                                                {
                                            <td title="@GetDiscountTdTitle(detail.DiscountPrice, detail.DealerPrice, detail.ProfitMarginRatio)" class="@GetDiscountTdClass(detail.DiscountPrice, detail.DealerPrice, detail.ProfitMarginRatio) bstooltip">
                                                @detail.DiscountRatio
                                                @if (!detail.IsCampaign && detail.WarrantyRatio.GetValueOrDefault(0) == 0)
                                                {
                                                    @Html.Raw("&nbsp; - &nbsp;")
                                                    <a class="k-link" onclick="AddDetailDiscount(@detail.WorkOrderDetailId, @detail.Id, '@detail.Type', this); ">@MessageResource.Global_Display_Add</a>
                                                }
                                            </td>
                                        }
                                        else
                                        {
                                            <td>
                                                @detail.DiscountRatio
                                                @if (!detail.IsCampaign && detail.WarrantyRatio.GetValueOrDefault(0) == 0)
                                                {
                                                    @Html.Raw("&nbsp; - &nbsp;")
                                                    <a class="k-link" onclick="AddDetailDiscount(@detail.WorkOrderDetailId, @detail.Id, '@detail.Type', this); ">@MessageResource.Global_Display_Add</a>
                                                }
                                            </td>
                                        }
                                        <td>@detail.TotalPrice.RoundUp(2)</td>
                                        <td>@detail.WarrantyRatio</td>
                                        <td>
                                            @detail.WarrantyTotal

                                        </td>
                                        <td>&nbsp;</td>

                                    </tr>
                                }
                            }
                        }
                        @Html.Partial("_WorkOrderInvoicedDetails", Model)


                    </tbody>

                </table>





                <div class="panel-footer">
                    <div class="panel panel-default ">
                        <div class="panel-heading">
                            <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseCustomerTotal">


                                <strong style="font-size: 16px;">
                                    @MessageResource.WorkOrderCard_Display_TotalCustomer
                                </strong>
                            </a>

                        </div>
                        <div class="panel-body panel-collapse collapse" id="collapseCustomerTotal" style="height: 0px">



                            <table class="table table-bordered table-zipped">
                                <tbody>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalPartPrice : </th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalCustomerPrice : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalLabourPrice :</th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalCustomerPrice : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_CustomerTotalPrice :</th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.TotalCustomerPrice).RoundUp(2)</td>
                                    </tr>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_DiscountPartPrice :</th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalDiscount : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_DiscountLabourPrice :</th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalDiscount : 0).RoundUp(2) </td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_DiscountTotalPrice :</th>
                                        <td class="col-md-2" colspan="3">@Model.Details.Sum(c => c.TotalDiscount).RoundUp(2)</td>
                                    </tr>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Discounted_Total_SparePart_Price</th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? (c.TotalPrice) : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Discounted_Total_Labour_Price :</th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? (c.TotalPrice) : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Discounted_Total_Customer_Price :</th>
                                        <td class="col-md-2" colspan="3">@Model.Details.Sum(c => c.TotalPrice).RoundUp(2)</td>
                                    </tr>

                                </tbody>
                            </table>

                        </div>
                    </div>

                    <div class="panel panel-default ">
                        <div class="panel-heading">
                            <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseWarrantyTotal">


                                <strong style="font-size: 16px;">
                                    @MessageResource.WorkOrderCard_Display_TotalWarranty
                                </strong>
                            </a>

                        </div>
                        <div class="panel-body panel-collapse collapse" id="collapseWarrantyTotal" style="height: 0px">

                            <table class="table table-bordered table-zipped">
                                <tbody>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalPartPrice :  </th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalWarrantyPriceWithoutDeduction : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalLabourPrice : </th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalWarrantyPriceWithoutDeduction : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyTotalPrice :</th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.TotalWarrantyPriceWithoutDeduction).RoundUp(2)</td>
                                    </tr>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Deduction_Total_SparePart_Price :  </th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalWarrantyDeductionPrice : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Deduction_Total_Labour_Price :  </th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalWarrantyDeductionPrice : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Deduction_Total_Guarantee_Price :</th>
                                        <td class="col-md-2 ">@Model.Details.Sum(c => c.TotalWarrantyDeductionPrice).RoundUp(2)</td>

                                    </tr>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyPartGeneralPrice :  </th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalWarrantyPrice : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyLabourGeneralPrice :  </th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalWarrantyPrice : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyGeneralPrice :</th>
                                        <td class="col-md-2 ">@Model.Details.Sum(c => c.TotalWarrantyPrice).RoundUp(2)</td>

                                    </tr>
                                </tbody>
                            </table>

                        </div>
                    </div>

                    <div class="panel panel-default ">
                        <div class="panel-heading">
                            <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseWOTotal">


                                <strong style="font-size: 16px;">
                                    @MessageResource.WorkOrderCard_Display_WOTotal
                                </strong>
                            </a>

                        </div>
                        <div class="panel-body panel-collapse collapse" id="collapseWOTotal" style="height: 0px">

                            <table class="table table-bordered table-zipped">
                                <tbody>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> @MessageResource.WorkOrderCard_Display_TotalPart : </th>
                                        <td class="col-md-3">@Model.Details.Where(c => c.Type == "PART").Sum(c => c.RequiredQuantity) </td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_TotalLabour :</th>
                                        <td class="col-md-7" colspan="3">@Model.Details.Where(c => c.Type == "LABOUR").Count()</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Deduction_And_Discount_Before_Price : </th>
                                        <td class="col-md-7" colspan="3">@Model.Details.Sum(c => (c.TotalCustomerPrice + c.TotalWarrantyPriceWithoutDeduction)).RoundUp(2)</td>
                                    </tr>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> @MessageResource.PDIInvoiceList_Display_TotalPartPrice : </th>
                                        <th class="col-md-3">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalPrice + c.TotalWarrantyPrice : 0).RoundUp(2)</th>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalLabourPrice : </th>
                                        <td class="col-md-3" colspan="3">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalPrice + c.TotalWarrantyPrice : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WOTotal : </th>
                                        <td class="col-md-3" colspan="3">@Model.Details.Sum(c => c.TotalPrice + c.TotalWarrantyPrice).RoundUp(2)</td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                    </div>


                    @*<div class="row">
                            <div class="col-md-4">
                                <div class="col-sm-4 bold" style="width: 9%">@MessageResource.WorkOrderCard_Display_TotalPart : </div>
                                <div class="col-sm-8" style="width: 9%">@Model.Details.Count(c => c.Type == "PART")</div>
                            </div>
                            <div class="col-md-4">
                                <div class="col-sm-4 bold" style="width: 9%">@MessageResource.WorkOrderCard_Display_TotalLabour :</div>
                                <div class="col-sm-8" style="width: 9%">@Model.Details.Count(c => c.Type == "LABOUR")</div>
                            </div>


                        </div>
                        <div class="clearfix"></div>
                        <div class="row">

                            <div class="col-sm-2 bold" style="width: 9%">@MessageResource.WorkOrderCard_Display_TotalPartPrice :</div>
                            <div class="col-sm-1" style="width: 9%">

                                @Model.Details.Sum(c => c.Type == "PART" && Model.DetailList.Any(k=> c.WorkOrderDetailId == k.WorkOrderDetailId  && k.ProcessTypeCode=="PT_M") ? c.Price*c.RequiredQuantity*((100 - c.DiscountRatio)/100) : 0).RoundUp(2)
                            </div>
                            <div class="col-sm-2 bold" style="width: 9%">@MessageResource.WorkOrderCard_Display_TotalLabourPrice :</div>
                            <div class="col-sm-1" style="width: 9%">@Model.Details.Sum(c => c.Type == "LABOUR" && Model.DetailList.Any(k => c.WorkOrderDetailId == k.WorkOrderDetailId && k.ProcessTypeCode == "PT_M") ? c.Price*c.Quantity*(c.Duration/100)*((100 - c.DiscountRatio)/100) : 0).RoundUp(2)</div>
                            <div class="col-sm-2 bold" style="width: 9%">@MessageResource.WorkOrderCard_Display_NondiscountedPrice :</div>
                            <div class="col-sm-1" style="width: 9%">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.Price*c.Quantity*(c.Duration/100) : (c.Type == "PART" ? c.Price*c.RequiredQuantity : 0)).RoundUp(2)</div>

                            <div class="clearfix"></div>
                        </div>
                        <div class="clearfix"></div>*@
                </div>
            </div>


        </div>

    </div>
    @*PopUp Windows*@


    <div id="CampaignRequestDetailsWindow"></div>


    @(Html.Kendo().Window()
                .Name("VehicleCampaignWindow")
                .Modal(true).Width(400).Height(200)
                .Visible(false)
                .Title(string.Format("{0}", MessageResource.CampaignWarning))
    )




    @(Html.Kendo().Window()
                .Name("VehicleKMWindow")
                .Modal(true).Width(400).Height(200)
                .Visible(false)
                .Events(evt => evt.Close(@"function(e){ if ('" + Html.Raw(Model.Vehicle.IsBodyWorkRequired.ToString()) + "' == 'True' && '" + String.IsNullOrEmpty(Model.Vehicle.BodyWorkName).ToString() + "' == 'True') {"
                          + "  DisableClicks();"
                          + "  $('#btnBodyWorkProcess').removeClass('disabled');"
                           + " var obj2 = document.getElementById('btnBodyWorkProcess');"
                           + "BodyWorkProcess(obj2);"
                        + "}  else if(parseInt($('#VehicleKM').text())>0) {"
                           + " EnableClicks();"
                        + "} }"))
                //.Animation(a=>a.Open(effect=>effect.SlideIn(SlideDirection.Right)).Close(effect=>effect.Fade(FadeDirection.Out)))
                .Title(string.Format("{0} [{1}]", MessageResource.Vehicle_Display_VehicleKilometer, MessageResource.Global_Display_Update)))
    @(Html.Kendo().Window()
                .Name("ContactInfoWindow")
                .Modal(true).Width(800).Height(340)
                .Events(evt => evt.Close("function(e){$('#ContactInfoWindow').html('');}"))
                .Visible(false)
                .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_PageTitle_Index, MessageResource.WorkOrderCard_Display_ContactInfo)))


    @(Html.Kendo().Window()
                .Name("VehiclePlateWindow")
                .Modal(true).Width(400).Height(200)
                .Visible(false)
                .Events(evt => evt.Close(@"function(e){ if ('" + Html.Raw(Model.Vehicle.IsBodyWorkRequired.ToString()) + "' == 'True' && '" + String.IsNullOrEmpty(Model.Vehicle.BodyWorkName).ToString() + "' == 'True') {"
                          + "  DisableClicks();"
                          + "  $('#btnBodyWorkProcess').removeClass('disabled');"
                           + " var obj2 = document.getElementById('btnBodyWorkProcess');"
                           + "BodyWorkProcess(obj2);"
                        + "}  else if(parseInt($('#VehiclePlate').text())>0) {"
                           + " EnableClicks();  "
                        + "} } "))
                //.Animation(a=>a.Open(effect=>effect.SlideIn(SlideDirection.Right)).Close(effect=>effect.Fade(FadeDirection.Out)))
                .Title(string.Format("{0} [{1}]", MessageResource.Vehicle_Display_VehiclePlate, MessageResource.Global_Display_Update)))


    @(Html.Kendo().Window()
                .Name("ContactInfoWindow")
                .Modal(true).Width(800).Height(340)
                .Events(evt => evt.Close("function(e){$('#ContactInfoWindow').html('');}"))
                .Visible(false)
                .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_PageTitle_Index, MessageResource.WorkOrderCard_Display_ContactInfo)))






    @(Html.Kendo().Window()
                .Name("AddWorkOrderDetailWindow")
                .Modal(true).Width(600).Height(380)
                .Visible(false)
                .Iframe(true)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#AddWorkOrderDetailWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.WorkOrderCard_Display_AddDetail)))

    @(Html.Kendo().Window()
                .Name("AddWorkOrderLabourWindow")
                .Modal(true).Width(950).Height(350)
                .Visible(false)
                .Iframe(true)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#AddWorkOrderLabourWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1} {2}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.WorkOrderCard_Display_Labour, MessageResource.Global_Display_Add)))

    @(Html.Kendo().Window()
                .Name("AddWorkOrderPartWindow")
                .Modal(true).Width(650).Height(300)
                .Visible(false)
                .Iframe(true)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#AddWorkOrderPartWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1} {2}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.WorkOrderCard_Display_Part, MessageResource.Global_Display_Add)))
    @(Html.Kendo().Window()
                .Name("AddWorkOrderMaintWindow")
                .Modal(true).Width(500).Height(200)
                .Visible(false)
                .Iframe(true)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){window.location.reload();}"))
                // .Events(evt => evt.Close("function(e){ $('#AddWorkOrderMaintWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1} {2}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.WorkOrderCard_Display_PeriodicMeintenance, MessageResource.Global_Display_Add)))
    @(Html.Kendo().Window()
                .Name("CancelWorkOrderDetailWindow")
                .Modal(true).Width(500).Height(200)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#CancelWorkOrderDetailWindow').html(''); RefreshDetails(); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.Global_Display_Cancel)))
    @(Html.Kendo().Window()
                .Name("CancelWorkOrderWindow")
                .Modal(true).Width(500).Height(200)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#CancelWorkOrderWindow').html(''); RefreshDetails(); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1}]", MessageResource.Global_Display_Warning, MessageResource.Global_Display_Cancel)))
    @(Html.Kendo().Window()
                .Name("UpdateCustomerNoteWindow")
                .Modal(true).Width(500).Height(200)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#UpdateCustomerNoteWindow').html(''); RefreshDetails(); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1}]", MessageResource.Global_Display_Warning, MessageResource.Global_Display_Update)))

    @(Html.Kendo().Window()
                .Name("AddDetailDiscountWindow")
                .Modal(true).Width(500).Height(350)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#AddDetailDiscountWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1} {2}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.WorkOrderCard_Display_Discount, MessageResource.Global_Display_Add)))
    @(Html.Kendo().Window()
                .Name("AddDetailQuantityWindow")
                .Modal(true).Width(500).Height(250)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#AddDetailQuantityWindow').html(''); RefreshDetails(); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1} {2}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.WorkOrderCard_Display_CountTime, MessageResource.Global_Display_Add)))
    @(Html.Kendo().Window()
                .Name("EditMeintenanceQuantityWindow")
                .Modal(true).Width(500).Height(300)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#EditMeintenanceQuantityWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1} {2}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.WorkOrderCard_Display_PeriodicMeintenance, MessageResource.Global_Display_Edit)))
    @(Html.Kendo().Window()
                .Name("AddCampaignWindow")
                .Modal(true).Width(800).Height(550)
                .Visible(false)
                .Iframe(true)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#AddCampaignWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.WorkOrderCard_Display_AddCampaign)))

    @(Html.Kendo().Window()
                .Name("VehicleNotesWindow")
                .Modal(true).Width(820).Height(350)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                //.Events(evt => evt.Close("function(e){location.reload();}"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0}", MessageResource.WorkOrderCard_Display_VehicleNotes)))
    @(Html.Kendo().Window()
                .Name("DealerNotesWindow")
                .Modal(true).Width(820).Height(350)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                //.Events(evt => evt.Close("function(e){location.reload();}"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0}", MessageResource.WorkOrderCard_Display_DealerNotes)))

    @(Html.Kendo().Window()
                .Name("DocumentsWindow")
                .Modal(true).Width(1200).Height(410)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#DocumentsWindow').html(''); $('.ajax-loading').addClass('hide'); }").Open("function(e){ $('.ajax-loading').addClass('hide'); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_PageTitle_Index, MessageResource.WorkOrderCard_Display_Documents)))

    @(Html.Kendo().Window()
                .Name("WarrantyWindow")
                .Modal(true).Width(800).Height(350)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#WarrantyWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_PageTitle_Index, MessageResource.WorkOrderCard_Display_SendToWarranty)))

    @(Html.Kendo().Window()
                .Name("ChangePriceListWindow")
                .Modal(true).Width(500).Height(350)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#ChangePriceListWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.WorkOrderCard_Display_ChangePriceList)))

    @(Html.Kendo().Window()
                .Name("AddLabourPriceWindow")
                .Modal(true).Width(500).Height(150)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#AddLabourPriceWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.WorkOrderCard_Change_Labour_Price)))

    @(Html.Kendo().Window()
                .Name("AddLabourPriceWindow")
                .Modal(true).Width(500).Height(150)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#AddLabourPriceWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.WorkOrderCard_Change_Labour_Price)))

    @(Html.Kendo().Window()
                .Name("ReservDetailPartsWindow")
                .Modal(true).Width(500).Height(350)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#ReservDetailPartsWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.WorkOrderCard_Display_ReservParts)))

    @(Html.Kendo().Window()
                .Name("ReturnPartsWindow")
                .Modal(true).Width(800).Height(450)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#ReturnPartsWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.WorkOrderCard_Title_ReturnParts)))

    @(Html.Kendo().Window()
                .Name("TechnicalDescriptionWindow")
                .Modal(true).Width(600).Height(380)
                .Events(evt => evt.Close("function(e){$('#TechnicalDescriptionWindow').html('');}"))
                .Visible(false)
                .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.WorkOrderCard_Display_TechnicalDescription)))

    @(Html.Kendo().Window()
                .Name("InvoiceWindow")
                .Iframe(true)
                .Modal(true).Width(1200).Height(650)
                .Events(evt => evt.Close("function(e){$('#InvoiceWindow').html(''); window.location.reload();}"))
                .Visible(false)
                .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_PageTitle_Index, MessageResource.WorkOrderInvoice_Dislay_FinishInvoice)))

    @(Html.Kendo().Window()
                .Name("VehicleBodyWorkWindow")
                .Modal(true).Width(950).Height(350)
                .Iframe(true)
                .Events(e => e.Close("function(e){ window.location.reload();}"))
                .Visible(false)
                //.Animation(a=>a.Open(effect=>effect.SlideIn(SlideDirection.Right)).Close(effect=>effect.Fade(FadeDirection.Out)))
                .Title(MessageResource.VehicleBodywork_PageTitle_Update))


    @(Html.Kendo().Window()
                .Name("UpdateFailureCodeWindow")
                .Modal(true).Width(500).Height(200)
                .Visible(false)
                .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                .Events(evt => evt.Close("function(e){ $('#UpdateFailureCodeWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                .Title(string.Format("{0} [{1} {2}]", MessageResource.WorkOrderCard_Display_WorkOrderDetails, MessageResource.AppointmentIndicatorFailureCode_Display_Code, MessageResource.Global_Display_Update)))
    <div id="AssignTechnicianWindow" class="hide"></div>
    <div id="UpdateProcessType" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="PartRemovalWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="AddPdiPackageWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="PdiPackageResultsWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="VehicleInfoWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="SendToWarrantyWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="PrintBarcodeWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="VehicleHistoryWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="VehicleContactInfoWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="PeriodicMaintControlListWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="AddHourMaintWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="PickingCancellationWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="CancelVehicleLeaveWindow" style="background-color: #EDF1F4 !important" class="hide"></div>

    @*End of PopUp Windows*@

    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/Scripts/custom.js"></script>
    <script src="~/Scripts/jqueryFileDowload.js"></script>
    <script src="~/Scripts/odms.objectsearch.js"></script>
    <script>

                                                function stickIt() {

                                                    var orgElementPos = $('.original').offset();
                                                    var orgElementTop = orgElementPos.top;
                                                    $("#tblWorkOrderDetails tbody tr:last-child td").each(function(i, e) {
                                                        var th = $(".cloned th").eq(i);
                                                        th.width($(e).width() + 1);
                                                    });

                                                    if ($(window).scrollTop() >= (orgElementTop)) {

                                                        var orgElement = $('.original');
                                                        var coordsOrgElement = orgElement.offset();
                                                        var leftOrgElement = coordsOrgElement.left;
                                                        var widthOrgElement = orgElement.width();

                                                        $('.cloned').css('left', leftOrgElement + 'px').css('top', 0).css('width', widthOrgElement + 'px').show();
                                                        $('.original').css('visibility', 'hidden');
                                                    } else {
                                                        // not scrolled past the menu; only show the original menu.
                                                        $('.cloned').hide();
                                                        $('.original').css('visibility', 'visible');
                                                    }
                                                }

                                                $(function() {
                                                    $('.menu').addClass('original').clone().insertAfter('.menu').addClass('cloned').css('position', 'fixed').css('top', '0').css('margin-top', '0').css('z-index', '500').removeClass('original').hide();

                                                    stickIt();
                                                    $(window).scroll(function() {
                                                        var windowTop = $(window).scrollTop();

                                                        if (windowTop > $('.original').offset().top) {
                                                            stickIt();
                                                        } else {
                                                            $('.cloned').hide();
                                                            $('.original').css('visibility', 'visible');
                                                        }
                                                    });
                                                    $(window).resize(stickIt);
                                                });

                                                $(document).ready(function() {

                                                    //var tableOffset = $("#tblWorkOrderDetails").offset().top;
                                                    //var $header = $("#tblWorkOrderDetails > thead").clone();
                                                    //var $fixedHeader = $("#header-fixed").append($header);
                                                    //$fixedHeader.width($("#tblWorkOrderDetails").width());


                                                    //$(window).bind("scroll", function() {
                                                    //    var offset = $(this).scrollTop();

                                                    //    if (offset >= tableOffset && $fixedHeader.is(":hidden")) {
                                                    //        $fixedHeader.show();
                                                    //    }
                                                    //    else if (offset < tableOffset) {
                                                    //        $fixedHeader.hide();
                                                    //    }
                                                    //});

                                                    $('.panel-collapse').collapse({
                                                        toggle: false
                                                    });

                                                    $(document).on("click", "#GetWorkOrderVehicleLeave", function() {
                                                        $.fileDownload($(this).prop('href'), {

                                                        });
                                                        return false;
                                                    });

                                                    if ('@TempData["kmUpdate"]' == "1") {
                                                        ShowCampaignModal();
                                                    }
                                                   

                                                    var kmOpened = 0
                                                    if ('@Model.Vehicle.VehicleKilometer.HasValue' == 'False') {
                                                        if ($('#btnUpDateVehicleKM').length > 0) {

                                                            ShowCampaignModal();
                                                            
                                                            DisableClicks();

                                                            $('#btnUpDateVehicleKM').removeClass("disabled");

                                                            UpDateVehicleKM();
                                                            
                                                        }
                                                    }

                                                    if ('@Model.Vehicle.Plate' == '' ) {
                                                        if($('#btnUpDateVehiclePlate').length>0){
                                                            DisableClicks();

                                                            $('#btnUpDateVehiclePlate').removeClass("disabled");
                                                            $('#btnUpDateVehiclePlate').trigger('click');
                                                        }
                                                    }

                                                    if(@Model.Vehicle.PopupNoteCount > 0){
                                                        if($('#btnDisplayVehicleNotePopup').length>0){
                                                            //DisableClicks();

                                                            $('#btnDisplayVehicleNotePopup').removeClass("disabled");
                                                            $('#btnDisplayVehicleNotePopup').trigger('click');

                                                        }
                                                    }

                                                    else if ('@Model.Vehicle.IsBodyWorkRequired.ToString()' == 'True' && '@String.IsNullOrEmpty(Model.Vehicle.BodyWorkName).ToString()' == 'True') {
                                                        //AlertErrorMessage('@MessageResource.WorkOrderCard_Message_VehicleBodyWorkRequired');
                                                        DisableClicks();
                                                        $("#btnBodyWorkProcess").removeClass("disabled");
                                                        var obj2 = document.getElementById('btnBodyWorkProcess');

                                                        BodyWorkProcess(obj2);

                                                    }

                                                });

                                                //EMRE

                                                function showCModal()
                                                {
                                                    var windowObj = $("#VehicleCampaignWindow");
                                                    windowObj.css(
                                                        {
                                                            "padding": "40px",
                                                            "text-align": "center",
                                                            "background-color": "#d43f3a"
                                                        });


                                                        windowObj.html("<h3 style='color:white;'>Bu iş emrinde uygulanması gereken <span style='text-decoration:underline'>kampanyalar</span> bulunmaktadır!</h3>");


                                                    var windowWidget = windowObj.data("kendoWindow").center();
                                                    
                                                    windowWidget.open();


                                                        @*var dt = new Date();

                                                        $.cookie("wookie", '@Model.WorkOderId',
                                                            {
                                                                expires: dt.setDate(dt.getDate() + 20),
                                                                path: "/"
                                                            });*@

                                                  }


                                                function ShowCampaignModal() {

                                                    var HasCampaign = "@(Model.HasCampaign)";
                                                    var IsCampaignApplicable = "@(Model.Vehicle.IsCampaignApplicable)";

                                                    if (HasCampaign == "True" && IsCampaignApplicable == "True")
                                                    {
                                                        showCModal();
                                                        @*var wookie = $.cookie("wookie");

                                                        if (wookie != null && wookie != undefined) {

                                                             if (wookie  != '@Model.WorkOderId') {

                                                                 showCModal();

                                                            }
                                                        }
                                                        else {
                                                            showCModal();
                                                        }*@


                                                    }

                                                }



                                                @if (!UserManager.UserInfo.IsDealer)
                                                {
             <text>
                                                function CancelVehicleLeave(obj) {

                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    var title = $(obj).html();
                                                    $('#CancelVehicleLeaveWindow').kwnd('@Url.Action("CancelVehicleLeave", "WorkOrderCard", new { id = Model.WorkOderId })', '@Html.Raw(MessageResource.WorkOrder_Dislay_CancelVehicleLeave)',
                                                    {
                                                        iframe: false,
                                                        width: 800,
                                                        height: 400,
                                                        onClose: function() {
                                                            $("#CancelVehicleLeaveWindow").html('');
                                                            window.location.reload();
                                                        }
                                                    });
                                                    $('#CancelVehicleLeaveWindow').removeClass("hide");
                                                    OpenWindow($('#CancelVehicleLeaveWindow'));
                                                }
                                                </text>
                                                }


                                                function OpenPickingCancellation(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#PickingCancellationWindow').kwnd('@Url.Action("PickingCancellation", new { id = Model.WorkOderId })', '@Html.Raw(MessageResource.WorkOrderCard_Display_PickingCancellation)',
                                                                                        {
                                                                                            iframe: false,
                                                                                            width: 680,
                                                                                            height: 350,
                                                                                            onClose: function() {
                                                                                                $("#PickingCancellationWindow").html('');
                                                                                                RefreshDetails();
                                                                                            }
                                                                                        });
                                                    $('#PickingCancellationWindow').removeClass("hide");
                                                    OpenWindow($('#PickingCancellationWindow'));
                                                }


                                                function AddHourMaint(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#AddHourMaintWindow').kwnd('@Url.Action("AddHourMaint", new { id = Model.WorkOderId, vehicleId = Model.Vehicle.VehicleId })', '@Html.Raw(MessageResource.WorkOrderCard_Display_AddHourMaint)',
                                                                {
                                                                    iframe: false,
                                                                    width: 480,
                                                                    height: 200,
                                                                    onClose: function() {
                                                                        $("#AddHourMaintWindow").html('');
                                                                        RefreshDetails();
                                                                    }
                                                                });
                                                    $('#AddHourMaintWindow').removeClass("hide");
                                                    OpenWindow($('#AddHourMaintWindow'));
                                                }

                                                function UpDateVehicleKMFromUpdateBtn(obj) {
                                                    debugger;
                                                    var fromUpdateBtn = 1;
                                                    if ($(obj).hasClass("disabled")) return;
                                                    var km = parseInt($("#VehicleKM").text());
                                                    $('#VehicleKMWindow').html('');
                                                    var windowWidget = $("#VehicleKMWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("UpdateVehicleKM")/' + @Model.WorkOderId + "?km=" + $("#VehicleKM").text().replace("\/s", "")+'&isHourMaint=@Model.Vehicle.IsHourMaint'+'&hour='+ $("#VehicleHour").text().replace("\/s", "") + '&fromUpdateBtn=' + fromUpdateBtn
                                                    }).center();


                                                    windowWidget.open();

                                                    $('.k-overlay').unbind("click");
                                                    $('.k-overlay').click(function() {
                                                        if (windowWidget) {
                                                            windowWidget.close();
                                                            $('#VehicleKMWindow').html('');
                                                            if ('@Model.Vehicle.IsBodyWorkRequired.ToString()' == 'True' && '@String.IsNullOrEmpty(Model.Vehicle.BodyWorkName).ToString()' == 'True') {
                                                                DisableClicks();
                                                                $("#btnBodyWorkProcess").removeClass("disabled");
                                                                var obj2 = document.getElementById('btnBodyWorkProcess');

                                                                BodyWorkProcess(obj2);
                                                            } else if(parseInt($("#VehicleKM").text())>0) {
                                                                EnableClicks();
                                                            }

                                                        }
                                                    });

                                                }

                                                function UpDateVehicleKM() {
                                                    debugger;
                                                    var fromUpdateBtn = 0;
                                                    var km = parseInt($("#VehicleKM").text());
                                                    $('#VehicleKMWindow').html('');
                                                    var windowWidget = $("#VehicleKMWindow").data("kendoWindow");

                                                     //$("#VehicleCampaignWindow").data("kendoWindow").close();


                                                    windowWidget.refresh({
                                                        url: '@Url.Action("UpdateVehicleKM")/' + @Model.WorkOderId + "?km=" + $("#VehicleKM").text().replace("\/s", "") +'&isHourMaint=@Model.Vehicle.IsHourMaint'+'&hour='+ $("#VehicleHour").text().replace("\/s", "") + '&fromUpdateBtn=' + fromUpdateBtn
                                                    }).center();





                                                    windowWidget.open();

                                                    $('.k-overlay').unbind("click");
                                                    $('.k-overlay').click(function() {
                                                        if (windowWidget) {
                                                            windowWidget.close();
                                                            $('#VehicleKMWindow').html('');
                                                            if ('@Model.Vehicle.IsBodyWorkRequired.ToString()' == 'True' && '@String.IsNullOrEmpty(Model.Vehicle.BodyWorkName).ToString()' == 'True') {
                                                                DisableClicks();
                                                                $("#btnBodyWorkProcess").removeClass("disabled");
                                                                var obj2 = document.getElementById('btnBodyWorkProcess');

                                                                BodyWorkProcess(obj2);
                                                            } else if(parseInt($("#VehicleKM").text())>0) {
                                                                EnableClicks();
                                                            }

                                                        }
                                                    });

                                                }
                                                function UpDateVehiclePlate(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    var km = parseInt($("#VehiclePlate").text());
                                                    $('#VehiclePlateWindow').html('');
                                                    var windowWidget = $("#VehiclePlateWindow").data("kendoWindow");

                                                    windowWidget.refresh({
                                                        url: '@Url.Action("UpdateVehiclePlate")/' + @Model.WorkOderId + "?plate=" + $("#VehiclePlate").text().replace("\/s", "")}).center();
                                                    windowWidget.open();

                                                    $('.k-overlay').unbind("click");
                                                    $('.k-overlay').click(function() {
                                                        if (windowWidget) {
                                                            windowWidget.close();
                                                            $('#VehiclePlateWindow').html('');
                                                            if ('@Model.Vehicle.IsBodyWorkRequired.ToString()' == 'True' && '@String.IsNullOrEmpty(Model.Vehicle.BodyWorkName).ToString()' == 'True') {
                                                                DisableClicks();
                                                                $("#btnBodyWorkProcess").removeClass("disabled");
                                                                var obj2 = document.getElementById('btnBodyWorkProcess');

                                                                BodyWorkProcess(obj2);
                                                            } else if(parseInt($("#VehiclePlate").text())>0) {
                                                                EnableClicks();
                                                            }

                                                        }
                                                    });

                                                }


                                                function OpenInvoiceWindow(obj) {
                                                    //console.log(@Model.Customer.CustomerId);
                                                    if ($(obj).hasClass("disabled")) return;
                                                    $('#InvoiceWindow').html('');
                                                    var windowWidget = $("#InvoiceWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("WorkOrderInvoiceCreate", "WorkOrderInvoice", new { id = Model.WorkOderId, customerId = Model.Customer.CustomerId })'
                                                    }).center();


                                                    windowWidget.open();
                                                }

                                                function UpdateContactInfo(idWorkOrder, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    $('#ContactInfoWindow').html('');
                                                    var windowWidget = $("#ContactInfoWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("UpdateContactInfo")/' + @Model.WorkOderId
                                                        }).center();

                                                    windowWidget.open();
                                                }

                                                function AddTechnicalDetail(workOrderDetailId,needRefresh, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    $('#TechnicalDescriptionWindow').html('');
                                                    var windowWidget = $("#TechnicalDescriptionWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("AddTechnicalDetail")/' + @Model.WorkOderId + '?workOrderDetailId=' + workOrderDetailId
                                                    }).center();
                                                    windowWidget.bind("close", function() {
                                                        window.location.reload()
                                                    });
                                                    //windowWidget.center();

                                                    windowWidget.open();


                                                }


                                                function AddWorkOrderDetail(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#AddWorkOrderDetailWindow').html('');
                                                    var windowWidget = $("#AddWorkOrderDetailWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("AddWorkOrderDetail")/' + @Model.WorkOderId
                                                        }).center();

                                                    windowWidget.open();


                                                }

                                                function AddPart(workOrderDetailId, obj) {

                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#AddWorkOrderPartWindow').html('');
                                                    var windowWidget = $("#AddWorkOrderPartWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("AddWorkOrderPart")/' + @Model.WorkOderId + "?workOrderDetailId=" + workOrderDetailId
                                                    }).center();

                                                    windowWidget.open();
                                                }

                                                function AddLabour(workOrderDetailId, vehicleId, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#AddWorkOrderLabourWindow').html('');
                                                    var windowWidget = $("#AddWorkOrderLabourWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("AddWorkOrderLabour")/' + @Model.WorkOderId + "?workOrderDetailId=" + workOrderDetailId + '&vehicleId=' + vehicleId
                                                    }).center();

                                                    windowWidget.open();


                                                }

                                                function AddMaintenance(workOrderDetailId, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#AddWorkOrderMaintWindow').html('');
                                                    var windowWidget = $("#AddWorkOrderMaintWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("AddWorkOrderMaint")/' + @Model.WorkOderId + "?workOrderDetailId=" + workOrderDetailId
                                                    }).center();

                                                    windowWidget.open();


                                                }

                                                function CancelWorkOrderDetailWithCampaignRequest(workOrderDetailId, campaignRequestId, obj) {

                                                    CancelDetailDeleteConfirm(function() {
                                                        CancelWorkOrderDetail(workOrderDetailId, obj);
                                                    });

                                                }


                                                function CancelWorkOrderDetail(workOrderDetailId,needRefresh, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#CancelWorkOrderDetailWindow').html('');
                                                    var windowWidget = $("#CancelWorkOrderDetailWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("CancelWorkOrderDetail")/' + @Model.WorkOderId + "?workOrderDetailId=" + workOrderDetailId
                                                    }).center();
                                                    windowWidget.bind("close", function() {
                                                        if(needRefresh==true)
                                                            window.location.reload()
                                                    });
                                                    windowWidget.open();


                                                }
                                                function _CancelWorkOrder(workOrderId,vehicleId,needRefresh, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#CancelWorkOrderWindow').html('');
                                                    var windowWidget = $("#CancelWorkOrderWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("CancelWorkOrder")?id=' + @Model.WorkOderId + '&vehicleId=' + vehicleId
                                                        }).center();
                                                    windowWidget.bind("close", function() {
                                                        if(needRefresh==true)
                                                            window.location.reload()
                                                    });
                                                    windowWidget.open();


                                                }
                                                function UpdateCustomerNote(workOrderId,needRefresh, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#UpdateCustomerNoteWindow').html('');
                                                    var windowWidget = $("#UpdateCustomerNoteWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("UpdateCustomerNote")/' + @Model.WorkOderId
                                                        }).center();
                                                    windowWidget.bind("close", function() {
                                                        if(needRefresh==true)
                                                            window.location.reload()
                                                    });
                                                    windowWidget.open();


                                                }

                                                function ReservDetailParts(workOrderDetailId, indicatorId, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#ReservDetailPartsWindow').html('');
                                                    var windowWidget = $("#ReservDetailPartsWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("ReservDetailParts")/' + @Model.WorkOderId + "?workOrderDetailId=" + workOrderDetailId,
                                                    }).center();

                                                    windowWidget.open();


                                                }

                                                function ReturnParts(workOrderDetailId, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#ReturnPartsWindow').html('');
                                                    var windowWidget = $("#ReturnPartsWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("ReturnParts")/' + @Model.WorkOderId + "?workOrderDetailId=" + workOrderDetailId,
                                                    }).center();

                                                    windowWidget.open();


                                                }

                                                function AddCampaign(obj, campaignCode) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#AddCampaignWindow').html('');
                                                    var windowWidget = $("#AddCampaignWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("AddCampaign")/' + @Model.WorkOderId + "?campaignCode=" + campaignCode
                                                    }).center();

                                                    windowWidget.open();

                                                }


                                                function AddDetailDiscount(workOrderDetailId, id, type, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#AddDetailDiscountWindow').html('');
                                                    var windowWidget = $("#AddDetailDiscountWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("AddDetailDiscount")/' + @Model.WorkOderId + "?workOrderDetailId=" + workOrderDetailId + "&type=" + type + "&itemId=" + id,
                                                    }).center();

                                                    windowWidget.open();


                                                }

                                                function AddDetailQuantity(workOrderDetailId, id, type, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#AddDetailQuantityWindow').html('');
                                                    var windowWidget = $("#AddDetailQuantityWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("AddDetailQuantity")/' + @Model.WorkOderId + "?workOrderDetailId=" + workOrderDetailId + "&type=" + type + "&itemId=" + id,
                                                    }).center();

                                                    windowWidget.open();


                                                }

                                                function EditMaintenanceQuantity(workOrderDetailId, id, type, maintenanceId, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#EditMeintenanceQuantityWindow').html('');
                                                    var windowWidget = $("#EditMeintenanceQuantityWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("EditMeintenanceQuantity")/' + @Model.WorkOderId + "?workOrderDetailId=" + workOrderDetailId + "&type=" + type + "&itemId=" + id + "&maintId=" + maintenanceId,
                                                    }).center();

                                                    windowWidget.open();


                                                }

                                                function OpenDocuments(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    $('#DocumentsWindow').html('');
                                                    var windowWidget = $("#DocumentsWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("WorkOrderDocumentsIndex", "WorkOrderDocuments")/' + @Model.WorkOderId
                                                        }).center();
                                                    windowWidget.open();


                                                }

                                                function OpenVehicleNotes(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    $('#VehicleNotesWindow').html('');
                                                    var windowWidget = $("#VehicleNotesWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("VehicleNotes", "WorkOrderCard")/' + @Model.WorkOderId //+"?workOrderDetailId="+workOrderDetailId+"&type="+type+"&itemId="+id +"&maintId="+maintenanceId,
                                                        }).center();

                                                    windowWidget.open();


                                                }

                                                function DisplayVehicleNotePopup(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    $('#VehicleNotesWindow').html('');
                                                    var windowWidget = $("#VehicleNotesWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("VehicleNotesPopup", "WorkOrderCard")/' + @Model.WorkOderId //+"?workOrderDetailId="+workOrderDetailId+"&type="+type+"&itemId="+id +"&maintId="+maintenanceId,
                                                        }).center();

                                                    windowWidget.open();


                                                }
                                                function OpenDealerNotes(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    $('#DealerNotesWindow').html('');
                                                    var windowWidget = $("#DealerNotesWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("DealerNotes", "WorkOrderCard")/' + @Model.WorkOderId //+"?workOrderDetailId="+workOrderDetailId+"&type="+type+"&itemId="+id +"&maintId="+maintenanceId,
                                                        }).center();

                                                    windowWidget.open();


                                                }
                                                function OpenWarrantyWindow(workOrderDetailId, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#WarrantyWindow').html('');
                                                    var windowWidget = $("#WarrantyWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("ClaimWarranty", "WorkOrderCard")/' + @Model.WorkOderId + "?workOrderDetailId=" + workOrderDetailId
                                                    }).center();
                                                    windowWidget.open();

                                                }

                                                function ChangePriceList(workOrderDetailId, id, type, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#ChangePriceListWindow').html('');
                                                    var windowWidget = $("#ChangePriceListWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("ChangePriceList")/' + @Model.WorkOderId + "?workOrderDetailId=" + workOrderDetailId + "&type=" + type + "&itemId=" + id + "&date=" + '@Model.WorkOrderDate.ToString(new CultureInfo("tr-TR"))',
                                                    }).center();

                                                    windowWidget.open();


                                                }

                                                function AddLabourPrice(workOrderDetailId, id, type, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#AddLabourPriceWindow').html('');
                                                    var windowWidget = $("#AddLabourPriceWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("AddLabourPrice")/' + @Model.WorkOderId + "?workOrderDetailId=" + workOrderDetailId + "&type=" + type + "&itemId=" + id,
                                                    }).center();

                                                    windowWidget.open();


                                                }

                                                function UpdateFailureCode(workOrderDetailId, code, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#UpdateFailureCodeWindow').html('');
                                                    var windowWidget = $("#UpdateFailureCodeWindow").data("kendoWindow");
                                                    windowWidget.refresh({
                                                        url: '@Url.Action("UpdateFailureCode")/' + @Model.WorkOderId + "?workOrderDetailId=" + workOrderDetailId + "&code=" + code
                                                    }).center();

                                                    windowWidget.open();


                                                }

                                                function OpenCampaignRequestDetails(workOrderDetailId, campaignRequestId, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#CampaignRequestDetailsWindow').kwnd('@Url.Action("CampaignRequestDetails")' + '?workOrderDetailId=' + workOrderDetailId + '&campaignRequestId=' + campaignRequestId, '@MessageResource.CampaignRequest_PageTitle_Details',
                                                        {
                                                            iframe: false,
                                                            width: 800,
                                                            height: 460,
                                                            onClose: function() {
                                                                $("#CampaignRequestDetailsWindow").html('');
                                                                EnableClicks();
                                                            }
                                                        });
                                                    $('#CampaignRequestDetailsWindow').removeClass("hide");
                                                    OpenWindow($('#CampaignRequestDetailsWindow'));
                                                }


                                                function AddPdiPackage(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#AddPdiPackageWindow').kwnd('@Url.Action("AddPdiPackage", new { id = Model.WorkOderId })', '@Html.Raw(MessageResource.WorkOrderCard_Display_AddPdiPackage)',
                                                        {
                                                            iframe: false,
                                                            width: 960,
                                                            height: 250,
                                                            onClose: function() {
                                                                window.location.reload();
                                                            }
                                                        });
                                                    $('#AddPdiPackageWindow').removeClass("hide");
                                                    OpenWindow($('#AddPdiPackageWindow'));
                                                }

                                                function OpenPartRemovalWindow(workOrderDetailId, partId, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#PartRemovalWindow').kwnd('@Url.Action("PartRemovalInfo")' + '?workOrderDetailId=' + workOrderDetailId + '&partId=' + partId, "@Html.Raw(CommonUtility.GetResourceValue("WorkOrderCard_Display_PartRemovalTitle"))",
                                                        {
                                                            iframe: false,
                                                            width: 600,
                                                            height: 360,
                                                            onClose: function() {
                                                                $("#PartRemovalWindow").html('');
                                                                EnableClicks();
                                                            }
                                                        });
                                                    $('#PartRemovalWindow').removeClass("hide");
                                                    OpenWindow($('#PartRemovalWindow'));
                                                }

                                                function OpenPrintBarcodeWindow(workOrderId,printAll, obj) {
                                                    //if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#PrintBarcodeWindow').kwnd('@Url.Action("PrintBarcode", "SparePartBarcode")' + '/' + workOrderId+'?isPrinted='+printAll, "@Html.Raw(CommonUtility.GetResourceValue("WorkOrderCard_Display_PartRemovalTitle"))",
                                                        {
                                                            iframe: true,
                                                            width: 800,
                                                            height: 400,
                                                            onClose: function() {
                                                                $("#PrintBarcodeWindow").html('');
                                                                EnableClicks();
                                                            }
                                                        });
                                                    $('#PrintBarcodeWindow').removeClass("hide");
                                                    OpenWindow($('#PrintBarcodeWindow'));
                                                }


                                                function OpenVehicleDetails(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#VehicleInfoWindow').kwnd('@Url.Action("VehicleDetails", new { id = Model.Vehicle.VehicleId })', "@Html.Raw(CommonUtility.GetResourceValue("Vehicle_PageTitle_Details"))",
                                                        {
                                                            iframe: false,
                                                            width: 950,
                                                            height: 450,
                                                            onClose: function() {
                                                                $("#VehicleInfoWindow").html('');
                                                                EnableClicks();
                                                            }
                                                        });
                                                    $('#VehicleInfoWindow').removeClass("hide");
                                                    OpenWindow($('#VehicleInfoWindow'));
                                                }

                                                function OpenVehicleContactInfo(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#VehicleContactInfoWindow').kwnd('@Url.Action("VehicleContactEdit", "Vehicle", new { id = Model.Vehicle.VehicleId })', "@Html.Raw(CommonUtility.GetResourceValue("Vehicle_PageTitle_Details"))",
                                                        {
                                                            iframe: false,
                                                            width: 700,
                                                            height: 350,
                                                            onClose: function() {
                                                                $("#VehicleContactInfoWindow").html('');
                                                                $.post("@Url.Action("GetVehicleContactAsJson", "Vehicle", new { id = Model.Vehicle.VehicleId })", null, function(json) {
                                                                    $("#VehicleLocation").html(json.Location);
                                                                    $("#VehicleResponsiblePerson").html(json.ResponsiblePerson);
                                                                    $("#VehicleResponsiblePersonPhone").html(json.ResponsiblePersonPhone);
                                                                }, "JSON");
                                                                EnableClicks();
                                                            }


                                                        });
                                                    $('#VehicleContactInfoWindow').removeClass("hide");
                                                    OpenWindow($('#VehicleContactInfoWindow'));
                                                }

                                                function UpdateProcessType(workOrderDetailId, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#UpdateProcessType').kwnd('@Url.Action("UpdateProcessType")' + '?workOrderDetailId=' + workOrderDetailId, ('@MessageResource.WorkOrderCard_Display_UpdateProcessType').replace("&#252;", "ü"),
                                                {
                                                    iframe: false,
                                                    width: 500,
                                                    height: 250,
                                                    onClose: function() {
                                                        $("#UpdateProcessType").html('');
                                                        //EnableClicks();
                                                        RefreshDetails($('#refresh-details-btn'));
                                                    }
                                                });
                                                    $('#UpdateProcessType').removeClass("hide");
                                                    OpenWindow($('#UpdateProcessType'));
                                                }


                                                function OpenVehicleHistory(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#VehicleHistoryWindow').kwnd('@Url.Action("VehicleHistoryIndex", "Vehicle", new { vehicleId = Model.Vehicle.VehicleId })', '@Html.Raw(MessageResource.WorkOrderCard_Display_VehicleHistory)',
                                                {
                                                    iframe: true,
                                                    width: 1250,
                                                    height: 650,
                                                    onClose: function() {
                                                        $("#VehicleHistoryWindow").html('');
                                                        EnableClicks();
                                                    }
                                                });
                                                    $('#VehicleHistoryWindow').removeClass("hide");
                                                    OpenWindow($('#VehicleHistoryWindow'));
                                                }

                                                function OpenPeriodicMaintControlList(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    $('#PeriodicMaintControlListWindow').kwnd('@Url.Action("OpenPeriodicMaintControlList", "WorkOrderCard", new { id = Model.Vehicle.VehicleTypeId })', '@Html.Raw(MessageResource.PeriodicMaintControlList_PageTitle_Index)',
                                                        {
                                                            iframe: false,
                                                            width: 960,
                                                            height: 450,
                                                            onClose: function() {
                                                                $("#PeriodicMaintControlListWindow").html('');
                                                                EnableClicks();
                                                            }
                                                        });
                                                    $('#PeriodicMaintControlListWindow').removeClass("hide");
                                                    OpenWindow($('#PeriodicMaintControlListWindow'));
                                                }

                                                function CheckVehicleLeave(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    $.ajax({
                                                        type: "POST",
                                                        url: '@Url.Action("CheckVehicleLeave", "WorkOrderCard")',
                                                        data: { id: @Model.WorkOderId },
                                                        success: function(json) {
                                                            if (json.VehicleLeaveDate == null) {
                                                                CustomConfirm2(function() {
                                                                    CheckVehicleLeaveStep2(obj);
                                                                }, "@MessageResource.Global_Display_Warning", "@MessageResource.WorkOrderCard_Display_VehicleLeaveConfirmMessage", "@MessageResource.Global_Display_Yes", "@MessageResource.Global_Display_No");
                                                            }
                                                        },
                                                        dataType: "JSON"
                                                    });


                                                }

                                                function CheckVehicleLeaveStep2(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    $.ajax({
                                                        type: "POST",
                                                        url: '@Url.Action("CheckVehicleLeaveStep2", "WorkOrderCard")',
                                                        data: { id: @Model.WorkOderId },
                                                        success: function(json) {
                                                            if (json.IsValid == 0) {
                                                                AlertSuccessMessage("@MessageResource.Global_Display_Success");
                                                                window.location.reload();
                                                                //$('#GetWorkOrderVehicleLeave').trigger("click");
                                                            } else if (json.IsValid == 1) {
                                                                AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeaveProcessTypeError");
                                                            } else if (json.IsValid == 2) {
                                                                // AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_DismentledPartsNotSet");
                                                                OpenMustRemovedPartsWindow(obj);
                                                            } else if (json.IsValid == 3) {
                                                                AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_IncompletedLabourExists");
                                                            } else if (json.IsValid == 4) {
                                                                AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_NotPickedPartsExists");
                                                            }else if (json.IsValid == 5) {
                                                                AlertErrorMessage("@MessageResource.Error_DB_PdiResultNotExists");
                                                            }else if (json.IsValid == 6) {
                                                                AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_PickingIsNotFinished");
                                                            }else if (json.IsValid == 7) {
                                                                AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_EmptyWorkOrderDeatail");
                                                            }else if (json.IsValid == 8) {
                                                                AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_EmptyTechDesc");
                                                            }else if (json.IsValid == 9) {
                                                                AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_NoDetailExists");
                                                            }else if (json.IsValid == 10) {
                                                                AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_WaitingPreApproval");
                                                            }else if (json.IsValid == 11) {
                                                                AlertErrorMessage("@MessageResource.WorkOrderCard_Warning_VehicleKM");
                                                            }else if (json.IsValid == 12) {
                                                                AlertErrorMessage("@MessageResource.WorkOrderCard_Warning_RequiredPartForGuarantee");
                                                            }else if (json.IsValid == 13) {
                                                                AlertErrorMessage("@MessageResource.WorkOrderCard_Warning_CouponMaintenanceKmControl");
                                                            }
                                                        },
                                                        dataType: "JSON"
                                                    });
                                                }

                                                function PrintLabels(workOrderDetailId, printAll, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    OpenPrintBarcodeWindow(@Model.WorkOderId,printAll, obj);
                                                    @*$.ajax({
            type: "POST",
            url: '@Url.Action("PrintLabels", "WorkOrderCard")',
            data: { workOrderDetailId: workOrderDetailId, printAll: printAll },
            success: function(json) {
                if (json.Result == 1) {
                    SetSuccessMessage(json.Message);
                    OpenPrintBarcodeWindow(@Model.WorkOderId, obj);
                } else {
                    SetErrorMessage(json.Message);
                }
            },
            complete: function() {
                EnableClicks();
            },
            dataType: "JSON"
        });*@
                                                }

                                                function OpenMustRemovedPartsWindow(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    var html = '<div id="MustRemovedPartsWindow" style="background-color:#EDF1F4 !important" class="hide"></div>';
                                                    $('#workOrderWrap').append(html);

                                                    $('#MustRemovedPartsWindow').kwnd('@Url.Action("MustRemovedParts", "WorkOrderCard")' + '/@Model.WorkOderId', '@Html.Raw(MessageResource.WorkOrderCard_Title_MustRemovedParts)',
                                                                                        {
                                                                                            iframe: false,
                                                                                            width: 800,
                                                                                            height: 400,
                                                                                            onClose: function() {
                                                                                                $('#MustRemovedPartsWindow').remove();
                                                                                            }
                                                                                        });
                                                    $('#MustRemovedPartsWindow').removeClass("hide");
                                                    OpenWindow($('#MustRemovedPartsWindow'));
                                                }


                                                function OpenAssaignTechicianWindow(workOrderDetailId, labourId, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    var title = $(obj).html();
                                                    $('#AssignTechnicianWindow').kwnd('@Url.Action("LabourTechnicianIndex", "LabourTechnician")' + '?workOrderDetailId=' + workOrderDetailId + '&labourId=' + labourId, title,
                                                                                        {
                                                                                            iframe: true,
                                                                                            width: 1400,
                                                                                            height: 500,
                                                                                            onClose: function() {
                                                                                                $("#AssignTechnicianWindow").html('');
                                                                                                RefreshDetails();
                                                                                                EnableClicks();
                                                                                            }
                                                                                        });
                                                    $('#AssignTechnicianWindow').removeClass("hide");
                                                    OpenWindow($('#AssignTechnicianWindow'));
                                                }
                                                function CancelLabourTecnician(workOrderDetailId,labourId,obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    CustomConfirm2(function() {
                                                        DisableClicks();
                                                        $.post(
                                                            "@Url.Action("CancelLabourTecnician", "LabourTechnician", new {workOrderId=Model.WorkOderId })", { workOrderDetailId :workOrderDetailId, labourId : labourId },

                                                            function(json) {
                                                                if (json.Status == 0) {
                                                                    AlertErrorMessage(json.Message);
                                                                } else {
                                                                    AlertSuccessMessage(json.Message);
                                                                    window.location.reload()
                                                                }
                                                                EnableClicks();
                                                            }, "json");

                                                    }, '@Html.Raw(MessageResource.Global_Display_Warning)', '@Html.Raw(MessageResource.WorkOrderCard_Display_CancelLabourTecnicianMessage)', '@MessageResource.Global_Display_Yes',  '@MessageResource.Global_Display_No');
                                                }
                                                function OpenPdiPackage(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    var title = $(obj).html();
                                                    $('#PdiPackageResultsWindow').kwnd('@Url.Action("OpenPdiPackageResults", "WorkOrderCard", new { id = Model.WorkOderId })', title,
                                                        {
                                                            iframe: false,
                                                            width: 1000,
                                                            height: 400,
                                                            onClose: function() {
                                                                $("#PdiPackageResultsWindow").html('');
                                                                EnableClicks();
                                                            }
                                                        });
                                                    $('#PdiPackageResultsWindow').removeClass("hide");
                                                    OpenWindow($('#PdiPackageResultsWindow'));
                                                }

                                                function DeleteItem(workOrderDetailId, itemId, type, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DeleteConfirm(function() {
                                                        DisableClicks();
                                                        $.post(
                                                            "@Url.Action("DeleteDetailItem", new { id = Model.WorkOderId })",
                                                            { workOrderDetailId: workOrderDetailId, itemId: itemId, type: type },
                                                            function(json) {
                                                                if (json.Result == false) {
                                                                    AlertErrorMessage(json.Message);
                                                                } else {
                                                                    AlertSuccessMessage(json.Message);
                                                                    RefreshDetails($('#refresh-details-btn'));
                                                                }
                                                                EnableClicks();
                                                            }, "json");

                                                    });
                                                }
                                                function CancelWorkOrder(obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    CustomConfirm2(function() {
                                                        DisableClicks();
                                                        $.post(
                                                            "@Url.Action("CancelWorkOrder", "WorkOrder", new { id = Model.WorkOderId })",
                                                    null,
                                                    function(json) {
                                                        if (json.Status == 0) {
                                                            AlertErrorMessage(json.Message);
                                                        } else {
                                                            AlertSuccessMessage(json.Message);
                                                            window.location.reload()
                                                        }
                                                        EnableClicks();
                                                    }, "json");

                                                    }, '@Html.Raw(MessageResource.Global_Display_Warning)', '@Html.Raw(MessageResource.WorkOrderCard_Display_CancelWorkOrderMessage)', '@MessageResource.Global_Display_Yes',  '@MessageResource.Global_Display_No');
                                                }
                                                function GoToWorkOrderInvoice() {
                                                    window.location = "@Url.Action("WorkOrderInvoiceIndex", "WorkOrderInvoice", new { id = Model.WorkOderId })";
                                                }

                                                function DisableClicks() {
                                                    $(".btn, a.k-link, .k-button").not(".k-window-action").addClass("disabled");
                                                    $(".k-link").css({ opacity: "0.7" });
                                                    $(".k-button").attr("disabled", "disabled");
                                                }

                                                function PickDetailParts(workOrderDetailId, obj) {
                                                    $(obj).addClass("hide");
                                                    $(obj).next(".ajax-loading").removeClass("hide");
                                                    $.post(
                                                        "@Url.Action("PickDetailParts", new { id = Model.WorkOderId })",
                                                        { workOrderDetailId: workOrderDetailId },
                                                        function(json) {
                                                            if (json.Result == false) {
                                                                AlertErrorMessage(json.Message);
                                                            } else {
                                                                AlertSuccessMessage(json.Message);
                                                                RefreshDetails($('#refresh-details-btn'));
                                                            }
                                                            $(obj).next(".ajax-loading").addClass("hide");
                                                            $(obj).removeClass("hide");
                                                        }, "json");


                                                }

                                                function RemoveMaintItem(maintId, workOrderDetailId, id, type, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DeleteConfirm(function() {
                                                        DisableClicks();
                                                        $.post(
                                                            "@Url.Action("RemoveItem")",
                                                            { WorkOrderId: @Model.WorkOderId, WorkOrderDetailId: workOrderDetailId, ItemId: id, Type: type, MaintenanceId: maintId },
                                                            function(json) {
                                                                if (json.Result == false) {
                                                                    AlertErrorMessage(json.Message);
                                                                } else {
                                                                    AlertSuccessMessage(json.Message);
                                                                    RefreshDetails($('#refresh-details-btn'));
                                                                }
                                                                EnableClicks();
                                                            }, "json");

                                                    });
                                                }


                                                function SendToWarrantyAppoval(workOrderDetailId, obj) {


                                                    SendToWarrantyConfirm(function() {
                                                        $(obj).addClass("hide");
                                                        $(obj).next(".ajax-loading").removeClass("hide");
                                                        $.post(
                                                            "@Url.Action("SendToWarrantyApproval")",
                                                            { workOrderDetailId: workOrderDetailId },
                                                            function(json) {
                                                                if (json.Result == false) {
                                                                    AlertErrorMessage(json.Message);
                                                                } else {
                                                                    AlertSuccessMessage(json.Message);
                                                                    RefreshDetails($('#refresh-details-btn'));
                                                                }
                                                                $(obj).next(".ajax-loading").addClass("hide");
                                                                $(obj).removeClass("hide");
                                                            }, "json");
                                                    });


                                                }

                                                function SendToWarrantyPreAppoval(workOrderDetailId, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    var title = $(obj).html();
                                                    $('#SendToWarrantyWindow').kwnd('@Url.Action("SendToWarrantyPreApproval", "WorkOrderCard", new { id = Model.WorkOderId })' + '?workOrderDetailId=' + workOrderDetailId, '@Html.Raw(MessageResource.WorkOrderCard_Display_SendToPreWarranty)',
                                                        {
                                                            iframe: false,
                                                            width: 800,
                                                            height: 300,
                                                            onClose: function() {
                                                                $("#SendToWarrantyWindow").html('');
                                                                RefreshDetails();
                                                                EnableClicks();
                                                            }
                                                        });
                                                    $('#SendToWarrantyWindow').removeClass("hide");
                                                    OpenWindow($('#SendToWarrantyWindow'));
                                                }

                                                function CreateCampaignRequest(workOrderDetailId, obj) {
                                                    $(obj).addClass("hide");
                                                    $(obj).next(".ajax-loading").removeClass("hide");
                                                    $.post(
                                                        "@Url.Action("CreateCampaignRequest")",
                                                        { workOrderDetailId: workOrderDetailId },
                                                        function(json) {
                                                            if (json.Result == false) {
                                                                AlertErrorMessage(json.Message);
                                                            } else {
                                                                AlertSuccessMessage(json.Message);
                                                                RefreshDetails($('#refresh-details-btn'));
                                                            }
                                                            $(obj).next(".ajax-loading").addClass("hide");
                                                            $(obj).removeClass("hide");
                                                        }, "json");
                                                }

                                                function CustomConfirm2(func, title, content, textYes, textNo) {
                                                    var confirm = false;
                                                    var kendoWindow = $("<div />").kendoWindow({
                                                        title: title,
                                                        resizable: false,
                                                        modal: true
                                                    });

                                                    var string = '<p class="custom-confirm-message">' + content + '</p>' +

                                                        '<p style="text-align:right">' +
                                                          '<input type="text" name="desc" />  '+
                                                        '<button class="custom-confirm k-button">' + textYes + '</button>' +
                                                        '<button class="custom-cancel k-button">' + textNo + '</button></p>';

                                                    kendoWindow.data("kendoWindow")
                                                        .content(string)
                                                        .center().open();

                                                    kendoWindow
                                                        .find(".custom-confirm, .custom-cancel")
                                                        .click(function() {
                                                            if ($(this).hasClass("custom-confirm")) {
                                                                confirm = true;
                                                                if (func)
                                                                    func();
                                                            }
                                                            kendoWindow.data("kendoWindow").close();
                                                        })
                                                        .end();
                                                    return confirm;
                                                }


                                                function EnableClicks() {
                                                    $(".btn, a.k-link, .k-button").removeClass("disabled");
                                                    $(".k-link").css({ opacity: "1" });
                                                    $(".k-button").removeAttr("disabled");
                                                    ResetToolTips();
                                                }

                                                function RefreshDetails(obj) {
                                                    $(obj).addClass("hide");
                                                    $(obj).next(".ajax-loading").removeClass("hide");
                                                    var wrapper = $('#WorkOrderDetails');
                                                    $.post(
                                                        "@Html.Raw(Url.Action("GetWorkOrderDetails", new { workOrderId = Model.WorkOderId, vehicleId = Model.Vehicle.VehicleId, vehicleLeave = Model.VehicleLeaveDate.HasValue }))",
                                                        null,
                                                        function(html) {
                                                            wrapper.html(html);
                                                            $.validator.unobtrusive.parse(wrapper);
                                                            EnableClicks();
                                                            //stickIt();
                                                            $(obj).next(".ajax-loading").addClass("hide");
                                                            $(obj).removeClass("hide");
                                                        }, "html");


                                                }

                                                function CancelDetailDeleteConfirm(deleteFunction) {
                                                    var confirm = false;
                                                    var kendoWindow = $("<div />").kendoWindow({
                                                        title: "@MessageResource.Gloabl_Display_DeleteConfirmTitle",
                                                        resizable: false,
                                                        modal: true
                                                    });

                                                    kendoWindow.data("kendoWindow")
                                                        .content($("#campaign-request-delete-confirm-modal").html())
                                                        .center().open();

                                                    kendoWindow
                                                        .find(".delete-confirm, .delete-cancel")
                                                        .click(function() {
                                                            if ($(this).hasClass("delete-confirm")) {
                                                                confirm = true;
                                                                if (deleteFunction)
                                                                    deleteFunction();
                                                            }
                                                            kendoWindow.data("kendoWindow").close();
                                                        })
                                                        .end();
                                                    return confirm;
                                                }
                                                function SendToWarrantyConfirm(deleteFunction) {
                                                    var kendoWindow = $("<div />").kendoWindow({
                                                        title: "@MessageResource.Global_Display_Warning",
                                                        resizable: false,
                                                        width:450,
                                                        modal: true
                                                    });

                                                    kendoWindow.data("kendoWindow")
                                                        .content($("#SendToWarranty-confirm-modal").html())
                                                        .center().open();

                                                    kendoWindow
                                                        .find(".confirm, .cancel")
                                                        .click(function() {
                                                            if ($(this).hasClass("confirm")) {
                                                                confirm = true;
                                                                if (deleteFunction)
                                                                    deleteFunction();
                                                            }
                                                            kendoWindow.data("kendoWindow").close();
                                                        })
                                                        .end();
                                                }


                                                function AddHourMaintConfirm(deleteFunction) {
                                                    var kendoWindow = $("<div />").kendoWindow({
                                                        title: "@MessageResource.Global_Display_Warning",
                                                        resizable: false,
                                                        width:450,
                                                        modal: true
                                                    });

                                                    kendoWindow.data("kendoWindow")
                                                        .content($("#AddHourMaint-confirm-modal").html())
                                                        .center().open();

                                                    kendoWindow
                                                        .find(".confirm, .cancel")
                                                        .click(function() {
                                                            if ($(this).hasClass("confirm")) {
                                                                confirm = true;
                                                                if (deleteFunction)
                                                                    deleteFunction();
                                                            }
                                                            kendoWindow.data("kendoWindow").close();
                                                        })
                                                        .end();
                                                }

                                                var cnt1 = 0;

                                                function AlertErrorMessage(msg) {
                                                    cnt1++;
                                                    var id = 'alert-div-' + cnt1;
                                                    var kendoWindow = $("<div id='" + id + "'/>").kendoWindow({
                                                        title: "@MessageResource.Global_Display_Warning",
                                                        resizable: false,
                                                        modal: true
                                                    });

                                                    kendoWindow.data("kendoWindow")
                                                        .content($("#alert-modal").html())
                                                        .center().open();
                                                    $(".warning-message", '#' + id).append(msg);
                                                    kendoWindow
                                                        .find(".warning-ok")
                                                        .click(function() {
                                                            kendoWindow.data("kendoWindow").destroy();
                                                        })
                                                        .end();
                                                }

                                                var cnt2 = 0;

                                                function AlertSuccessMessage(msg) {
                                                    cnt2++;
                                                    var id = 'success-div-' + cnt1;
                                                    var kendoWindow = $("<div id='" + id + "'/>").kendoWindow({
                                                        title: "@MessageResource.Global_Display_Warning",
                                                        resizable: false,
                                                        modal: true
                                                    });

                                                    kendoWindow.data("kendoWindow")
                                                        .content($("#success-modal").html())
                                                        .center().open();
                                                    $(".warning-message", '#' + id).append(msg);
                                                    kendoWindow
                                                        .find(".warning-ok")
                                                        .click(function() {
                                                            kendoWindow.data("kendoWindow").destroy();
                                                        })
                                                        .end();
                                                }

                                                function ResetToolTips() {
                                                    $('.part-tooltip, .bstooltip').each(function(i, e) {
                                                        if ($(e).attr('title') != '')
                                                            $(e).tooltipster({
                                                                animation: 'fade',
                                                                delay: 100,
                                                                touchDevices: false,
                                                                fixedWidth: '50px',
                                                                maxWidth: 400,
                                                                theme: 'part-theme',
                                                                trigger: 'hover',
                                                                contentAsHTML: true
                                                            });
                                                    });
                                                }

    </script>
}
<script>
    $(document).ready(function () {
        ResetToolTips();
        //$(".part-tooltip").on( 'mouseenter', function () {
        //    $('.part-tooltip').tooltipster({
        //        animation: 'grow',
        //        delay: 200,
        //        trigger: 'hover',
        //        theme:'part-theme',
        //        contentAsHTML:true
        //    });
        //});
        //$(document).delegate(".bstooltip,.part-tooltip", 'mouseenter', function () {
        //    $('.bstooltip,.part-tooltip').tooltipster({
        //        animation: 'grow',
        //        delay: 200,
        //        trigger: 'hover',
        //        theme:'part-theme',
        //        contentAsHTML:true
        //    });
        //});
        $("#btnVehicleHistory").kendoTooltip({
            content: {
                url: "@Url.Action("GetVehicleHistoryToolTipContent", new { id = Model.Vehicle != null ? Model.Vehicle.VehicleId : 0 })"
            },
            width: 250,
            height: 100,
            position: "top",
        });


    });
</script>
@helper GetPartTdClass(decimal required, decimal reserved, decimal picked, decimal returned)
{
    if (required > reserved && required > 0 && required > (reserved + picked - returned))
    {
        @Html.Raw(" danger ")
        return;
    }
    if (required == (picked - returned))
    {
        @Html.Raw(" success ")
        return;
    }
    if (required == reserved + (picked - returned) && reserved > 0)
    {
        @Html.Raw(" warning ")
    }
}

@helper GetPartToolTipHtml(decimal required, decimal reserved, decimal picked, decimal returned)
{
    @Html.Raw("<div class=\"part-detail-tooltip\"> " +
        "<ul>" +

           " <li><span class=\"bold\">" + MessageResource.WorkOrderCard_Display_ReservedQuantity + "</span><span class='value'>" + reserved + "</span></li>" +
           " <li><span class=\"bold\">" + MessageResource.WorkOrderCard_Display_WorkShopQuantity + "</span><span class='value'>" + (picked - returned) + "</span></li>" +
        "</ul>" +
    "</div>")
}


<script id="alert-modal" type="text/x-kendo-template">
    <div class="alert alert-danger">
        <div style="width:500px">
            <p class="warning-message" style="font-weight:bold"></p>
            <p style="text-align:right">
                <button class="warning-ok btn btn-danger">@MessageResource.Global_Display_Ok</button>
            </p>
        </div>
    </div>
</script>

<script id="success-modal" type="text/x-kendo-template">
    <div class="alert alert-success">
        <div style="width:500px">
            <p class="warning-message" style="font-weight:bold"></p>
            <p style="text-align:right">
                <button class="warning-ok btn btn-success">@MessageResource.Global_Display_Ok</button>
            </p>
        </div>
    </div>
</script>
<script id="campaign-request-delete-confirm-modal" type="text/x-kendo-template">
    <p class="delete-message">@MessageResource.WorkOrderCard_Display_CancelCampaignRequestConfirmQuestion</p>
    <p style="text-align:right">
        <button class="delete-confirm k-button">@MessageResource.Global_Display_Yes</button>
        <button class="delete-cancel k-button">@MessageResource.Global_Display_No</button>
    </p>
</script>
<script id="SendToWarranty-confirm-modal" type="text/x-kendo-template">
    <p class="">@MessageResource.WorkOrderCard_Message_SendToWarranty</p>
    <p style="margin-top:6px"><i class="text-info glyphicon glyphicon-info-sign"></i> <em style="font-size:11px">@MessageResource.WorkOrderCard_Message_SendToWarrantyNote</em></p>
    <p style="text-align:right">
        <button class="confirm k-button">@MessageResource.Global_Display_Yes</button>
        <button class="cancel k-button">@MessageResource.Global_Display_No</button>
    </p>
</script>
<script id="AddHourMaint-confirm-modal" type="text/x-kendo-template">
    <p class="">@MessageResource.WorkOrderCard_Message_AddHourMaint</p>
    <p style="text-align:right">
        <button class="confirm k-button">@MessageResource.Global_Display_Yes</button>
        <button class="cancel k-button">@MessageResource.Global_Display_No</button>
    </p>
</script>



@if (Model.Vehicle != null)
{
    <script>

        function BodyWorkProcess(obj) {

            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            var isReq = '@Model.Vehicle.IsBodyWorkRequired';
            if (isReq.toUpperCase() == 'TRUE') {
                $("#VehicleBodyWorkWindow").html('');
                var wnd = $("#VehicleBodyWorkWindow").data("kendoWindow");

                wnd.refresh({
                    url: '@Url.Action("UpdateVehicleBodyWork")?id=' + '@Model.Vehicle.VehicleId' + '&vinNo=' + '@Model.Vehicle.VinNo' + '&woNo=' + '@Model.WorkOderId'
                }).center();

                wnd.open();
                DisableClicks();
            }
        }
    </script>

}

@helper GetDiscountTdClass(decimal discountPrice, decimal? dealerPrice, decimal? profitMarginRatio)
{
    if (dealerPrice.GetValueOrDefault(0) > discountPrice)
    {
        @Html.Raw("danger")
        return;
    }
    if (profitMarginRatio.GetValueOrDefault() > 0)
    {
        if ((dealerPrice * (1 + (profitMarginRatio / 100))) < discountPrice)
        {
            @Html.Raw("warning")
        }
    }

}
@helper GetDiscountTdTitle(decimal discountPrice, decimal? dealerPrice, decimal? profitMarginRatio)
{
    if (dealerPrice.GetValueOrDefault(0) > discountPrice)
    {
        @Html.Raw(MessageResource.WorkOrderWard_Message_DiscountLessThanDealerPrice)
        return;
    }
    if (profitMarginRatio.GetValueOrDefault() > 0)
    {
        if ((dealerPrice * (1 + (profitMarginRatio / 100))) < discountPrice)
        {
            @Html.Raw(MessageResource.WorkOrderWard_Message_DiscountLessThanProfitMargin)
        }
    }

}
@helper GetPriceToolTipHtml(WorkOrderDetailModel detail)
{
    <table>
        @if (detail.Type == "PART")
        {
            <tr>
                <th style="padding-right: 8px">@MessageResource.StockCard_Display_AvgDealerPrice </th>
                <td>: @detail.DealerPrice</td>
            </tr>
        }
        <tr>
            @if (detail.ProcessTypeCode == "PT_P" && detail.Type == "PART")
            {
                <th style="padding-right: 8px">@MessageResource.WorkOrderCard_Display_PartWarrantyPrice </th>
            }
            else
            {
                <th style="padding-right: 8px">@MessageResource.WorkOrderCard_Display_WarrantyPrice </th>
            }
            <td>: @detail.WarrantyPrice</td>
        </tr>
    </table>
}

@helper GetLabourTdClass(sbyte id, bool isExternal)
{
    if (isExternal)
    {
        @Html.Raw(" success ")
        return;
    }
    if (id == -1 || id == 0)
    {
        @Html.Raw(" danger ")
        return;
    }
    else if (id == 4)
    {
        @Html.Raw(" success ")
        return;
    }
    else
    {
        @Html.Raw(" warning ")
    }
}
@helper GetLabourTdTitle(WorkOrderDetailModel detail)
{
    if (detail.LabourWorkStatusId != 4)
    {
        if (@detail.LabourTechnician.Count() > 0)
        {
            <table>
                <tr>
                    <th style="padding-right: 8px">@Html.Raw(detail.LabourWorkStatus)</th>
                    <td>: @detail.LabourTechnician</td>
                </tr>
            </table>
        }
        else
        {
            @Html.Raw(detail.LabourWorkStatus)
        }
    }
    else
    {
        <table>
            <tr>
                <th style="padding-right: 8px">@MessageResource.LabourTechnician_Display_UserNameSurname </th>
                <td>: @detail.LabourTechnician</td>
            </tr>
            @if (detail.LabourStartDate != DateTime.MinValue)
            {
                <tr>
                    <th style="padding-right: 8px">@MessageResource.LabourTechnician_Display_StartDate </th>
                    <td>: @detail.LabourStartDate.ToString("dd/MM/yyyy HH:mm")</td>
                </tr>
                <tr>
                    <th style="padding-right: 8px">@MessageResource.LabourTechnician_Display_EndDate </th>
                    <td>
                        : @detail.LabourFinishDate.ToString("dd/MM/yyyy HH:mm")
                    </td>
                </tr>
            }
        </table>
    }
}
@helper GetDismentledPartTdClass(WorkOrderDetailModel detail, string processTypeCode)
{
    if (detail.Type != "PART")
    {
        return;
    }
    else
    {
        if (!string.IsNullOrEmpty(detail.DismantledPart))
        {
            @Html.Raw("success")
            return;
        }
        else
        {
            if (processTypeCode == "PT_M")
            {
                //zorunlu değil
                @Html.Raw(" _blue")
                return;
            }
            else
            {
                if (detail.DismantledPartCount == 1)
                {
                    //zorunlu değil
                    @Html.Raw(" _blue")
                    return;
                }
                else if (detail.DismantledPartCount > 1)
                {
                    //zorunlu
                    @Html.Raw("danger")
                    return;
                }
            }
        }

    }
}

