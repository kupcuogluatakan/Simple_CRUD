@using ODMSCommon.Resources
@using ODMSModel.ProposalCard
@using ODMSModel.WorkOrderCard
@using ODMSCommon.Security
@model ProposalCardModel
@{
    ViewBag.Title = MessageResource.ProposalCard_PageTitle_Index + " (" + Model.ProposalId + ")" + " - " + MessageResource.ProposalCard_Display_ProposalRevision + " (" + Model.ProposalSeq + ")";
    bool HasMaint = Model.Details.Any(c => c.MaintenanceId > 0);
    var campaignCheckList = ViewBag.CampaignCheckList as List<CampaignCheckModel>;
    var campaignCheckMessage = string.Empty;
    ViewBag.IsVehicleLeft = Model.VehicleLeaveDate.HasValue;
    var HasAnyGuaranteeAuthorizationNeed = Model.DetailList.Any(c => c.GuarantyAuthorizationNeed && c.WarrantyStatus.In(1, 1));

}
<script src="~/Scripts/Tooltipster/jquery.tooltipster.min.js"></script>
<link href="~/Style/Tooltipster/tooltipster.css" rel="stylesheet" />
<link href="~/Style/Tooltipster/tooltipster-shadow.css" rel="stylesheet" />
<script src="~/Scripts/jQuery.print.js"></script>
<style type="text/css">
    #tblProposalDetails {
        border-spacing: 0px;
        margin: 0;
    }

        #tblProposalDetails thead.fixed {
            position: fixed;
            top: 0;
            background-color: #ffffff;
            z-index: 1000;
        }

    .seperator {
        border-bottom: 1px solid #cbcbcb;
        margin: 2px 0;
    }

    .table tbody tr.info > td {
        background-color: #D9EDF7;
        font-weight: bold;
    }

    button:focus {
        -moz-outline: 0 none !important;
        outline: 0 none !important;
    }

    a {
        cursor: default;
    }

    .fa-caret-right {
        margin-right: 4px;
    }

    .part-theme {
        background: white;
        border: 1px solid #c6c6c6;
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
        border-radius: 5px;
        color: #090909;
    }

        .part-theme .tooltipster-content {
            font-size: 12px;
            font-weight: 400;
            line-height: 14px;
            padding: 15px 18px;
        }

            .part-theme .tooltipster-content ul {
                margin: 0;
                padding: 0;
                list-style: none;
            }

                .part-theme .tooltipster-content ul li {
                    list-style: none;
                    padding: 0 0 5px;
                }

                    .part-theme .tooltipster-content ul li span.value {
                        padding-left: 10px;
                    }

    .k-widget.k-tooltip {
        background-color: white;
        color: #090909;
    }

    .tooltip-content {
        background-color: white;
        text-align: left;
        padding: 10px;
    }

        .tooltip-content .bold {
            padding-right: 12px;
        }

    .color-box-wrapper {
        display: inline-block;
        margin: 0 5px;
        text-align: center;
    }

    .color-box {
        border-radius: 15px;
        content: "";
        display: inline-block;
        height: 15px;
        width: 15px;
    }

    .menu {
        background-color: white;
    }
</style>

@if (Session["PrintProposal"] != null)
{
    <script>
        setTimeout(function() {
            document.location = "@Url.Content("~")Proposal_Card/Print";
        }, 1000);
    </script>
}

@if (ViewBag.HideElements != null && !ViewBag.HideElements)
{
    <div id="ProposalWrap" class="container" style="max-width: 100%;">
        @if (campaignCheckList != null && campaignCheckList.Count > 0)
        {
            <div class="panel panel-danger">
                <div class="panel-heading">
                    @MessageResource.WorkOrderCard_Display_CriticalCampaignMessage
                </div>
                <div class="panel-body">
                    <div class="well">
                        <strong>@MessageResource.ProposalCard_Display_MandatoryCampaignsMessage</strong>
                    </div>
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>@MessageResource.Campaign_Display_CampaignCode</th>
                                <th>@MessageResource.Campaign_Display_CampaignName</th>
                                <th>@MessageResource.WorkOrderCard_Display_HasStock</th>
                                <th>@MessageResource.WorkOrderCard_Display_TotalLabourDuration</th>
                                <th>@MessageResource.Global_Display_Add</th>

                            </tr>
                        </thead>
                        @foreach (var item in campaignCheckList)
                        {
                            <tr>
                                <td>@item.CampaignCode</td>
                                <td>@item.Description</td>
                                <td>
                                    @if (item.HasStock)
                                    {
                                        <strong style="color: #5cb85c"><i class="glyphicon glyphicon-ok"></i></strong>
                                    }
                                    else
                                    {
                                        <strong style="color: #d9534f"><i class="glyphicon glyphicon-remove"></i></strong>
                                    }
                                </td>
                                <td>@item.TotalLabourDuration</td>
                                <td>
                                    <a class="k-link" onclick="AddCampaign(this,'@item.CampaignCode')">
                                        <img src="@Url.Content("~/Images/add2.png")" />
                                    </a>
                                </td>

                            </tr>
                        }
                    </table>
                </div>
            </div>
            <div>
            </div>


        }
        <div class="panel-group" id="accordion" style="margin-bottom: 5px;">

            <div class="panel panel-default ">
                <div class="panel-heading">
                    <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseVehicle">
                        <strong style="font-size: 16px;">
                            @MessageResource.Appointment_Display_Vehicle
                        </strong>
                    </a>
                </div>
                <div id="collapseVehicle" class="panel-body panel-collapse collapse" style="height:0px">

                    <table class="table table-bordered table-zipped">
                        <tbody>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Appointment_Display_VehicleModel :</th>
                                <td class="col-md-3">@Model.Vehicle.VehicleModel</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Appointment_Display_VehicleType :</th>
                                <td class="col-md-3">@Model.Vehicle.VehicleType</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.VehicleCode_Display_Kod :</th>
                                <td class="col-md-3">@Model.Vehicle.VehicleCode</td>
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_Plate:</th>
                                <td class="col-md-3">@Model.Vehicle.Plate</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_VinNo :</th>
                                <td class="col-md-3">@Model.Vehicle.VinNo</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_EngineNo :</th>
                                <td class="col-md-3">@Model.Vehicle.EngineNo</td>
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_WarrantyStatus :</th>
                                <td class="col-md-3">
                                    @if (Model.Vehicle.WarrantyStartDate.HasValue)
                                    {

                                        if (Model.Vehicle.WarrantyEndDate > Model.ProposalDate)
                                        {
                                            <text>@MessageResource.WorkOrderCard_Display_VehicleWarranty</text>
                                        }
                                        else
                                        {
                                            <text>@MessageResource.WorkOrderCard_Display_VehicleOutOfWarranty</text>
                                        }

                                    }
                                    else
                                    {
                                        @Html.Raw("-")
                                    }

                                </td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyStartDate :</th>
                                <td class="col-md-3">
                                    @if (Model.Vehicle.WarrantyStartDate != default(DateTime))
                                    {
                                        @Model.Vehicle.WarrantyStartDate.GetValueOrDefault().ToString("dd/MM/yyyy").Replace(".", "/")
                                    }
                                    else
                                    {
                                        @Html.Raw("-")
                                    }
                                </td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyEndDate :</th>
                                <td class="col-md-3">
                                    @if (Model.Vehicle.WarrantyEndDate != default(DateTime))
                                    {
                                        @Model.Vehicle.WarrantyEndDate.GetValueOrDefault().ToString("dd/MM/yyyy").Replace(".", "/")
                                    }
                                    else
                                    {
                                        @Html.Raw("-")
                                    }

                                </td>
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_PaintWarrantyEndDate :</th>
                                <td class="col-md-3">
                                    @if (Model.Vehicle.PaintWarrantyEndDate.HasValue && Model.Vehicle.PaintWarrantyEndDate != default(DateTime))
                                    {
                                        @Model.Vehicle.PaintWarrantyEndDate.GetValueOrDefault().ToString("dd/MM/yyyy").Replace(".", "/")
                                    }
                                    else
                                    {
                                        @Html.Raw("-")
                                    }
                                </td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_CorrosionWarrantyEndDate :</th>
                                <td class="col-md-3">
                                    @if (Model.Vehicle.CorrosionWarrantyEndDate.HasValue && Model.Vehicle.CorrosionWarrantyEndDate != default(DateTime))
                                    {
                                        @Model.Vehicle.CorrosionWarrantyEndDate.GetValueOrDefault().ToString("dd/MM/yyyy").Replace(".", "/")
                                    }
                                    else
                                    {
                                        @Html.Raw("-")
                                    }
                                </td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_VehicleKilometer :</th>
                                <td class="col-md-3">@Model.Vehicle.VehicleKilometer</td>
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_WarrantyStatus :</th>
                                <td class="col-md-3">
                                    @if (Model.Vehicle.WarrantyStartDate.HasValue)
                                    {
                                        if (Model.Vehicle.WarrantyStatus)
                                        {
                                            <text>@MessageResource.WorkOrderCard_Display_VehicleWarranty</text>
                                        }
                                        else
                                        {
                                            <text>@MessageResource.WorkOrderCard_Display_VehicleOutOfWarranty</text>
                                        }
                                    }
                                    else
                                    {
                                        @Html.Raw("-")
                                    }
                                </td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.VehicleBodywork_Display_BodyworkName:</th>
                                <td id="VehicleLocation" class="col-md-7" colspan="4">
                                    @Model.Vehicle.BodyWorkName
                                </td>
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead">
                                    <i class="fa fa-caret-right"></i>
                                    @MessageResource.WorkOrderCard_Display_VehicleLocation
                                </th>

                                <td class="col-md-3">@Model.Vehicle.Location</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_VehicleResponsible :</th>
                                <td class="col-md-3">@Model.Vehicle.ResponsiblePerson</td>

                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_VehicleResponsiblePhone :</th>
                                <td class="col-md-3">@Model.Vehicle.ResponsiblePersonPhone</td>

                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">

                    <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseCustomer">
                        <strong style="font-size: 16px;">
                            @MessageResource.Appointment_Display_Customer
                        </strong>
                    </a>

                </div>
                <div class="panel-body panel-collapse collapse" id="collapseCustomer" style="height: 0px">
                    <table class="table table-bordered table-zipped">
                        <tbody>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.CustomerAddress_Display_CustomerName :</th>
                                <td class="col-md-3">@Model.Customer.CustomerName</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Customer_Display_TCIdentityNo :</th>
                                <td class="col-md-3">@Model.Customer.TcIdentityNo</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.User_Display_Address :</th>
                                <td class="col-md-3">@Model.Customer.CustomerAddress</td>
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_ContactInfo :</th>
                                <td class="col-md-3">@Model.ContactInfo</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Customer_Display_TaxOffice :</th>
                                <td class="col-md-3">@Model.Customer.TaxOffice</td>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Dealer_Display_TaxNo :</th>
                                <td class="col-md-3">@Model.Customer.TaxNo</td>
                            </tr>
                            <tr>
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Proposal_Display_ResponsibleConsultant :</th>
                                <td colspan="5" class="col-md-11">@Model.Customer.Staff </td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>

        </div>
        @*Emre: 3 önceden iptal karşılığıymış ama şuan database'de 3 statusu yok. yine de bıraktım *@
        @if (Model.ProposalStatId != 3 && Model.ProposalStatId != 8)
        {
            <div class="panel panel-default">
                <div class="panel-heading">

                    @if (Model.Vehicle.PdiCheck && Model.Vehicle.IsPdiAccomplished && Model.IsPdiOwner)
                    {
                        <button class="btn btn-info" onclick=" OpenPdiPackage(this) ">@MessageResource.WorkOrderCard_Display_PdiResultList</button>
                    }

                    <button class="btn btn-info" id="btnVehicleHistory" onclick=" OpenVehicleHistory(this) ">@MessageResource.WorkOrderCard_Display_VehicleHistory</button>
                    @if (Model.ProposalStatId != 6 && Model.ProposalStatId != 7 && Model.ApprovedCount == 0)
                    {
                        <a class="btn btn-info" target="_blank" href="@Url.Action("ProposalRevision", new { id = Model.ProposalId, seq = Model.ProposalSeq })" id="btnPrintProposal">@MessageResource.ProposalCard_Display_ProposalRevision</a>
                    }
                    @* <a class="btn btn-info" href="@Url.Action("Print", new { id = Model.ProposalId, seq = Model.ProposalSeq })" id="btnPrintProposal">@MessageResource.ProposalCard_Display_Print</a>*@
                    <a class="btn btn-info" onclick="Print()">@MessageResource.ProposalCard_Display_Print</a>
                    <button class="btn btn-info" id="btnVehicleDetails" onclick=" OpenVehicleDetails(this) ">@MessageResource.Vehicle_PageTitle_Details</button>
                    <button class="btn btn-info" onclick="OpenVehicleNotesProposal(this)">@MessageResource.WorkOrderCard_Display_VehicleNotes <span class="label label-danger">@Model.Vehicle.NoteCount</span></button>
                    <button class="btn btn-info" onclick="OpenDealerNotes(this)">@MessageResource.WorkOrderCard_Display_DealerNotes <span class="label label-danger">@Model.Vehicle.DealerNoteCount</span></button>
                    <button class="btn btn-info" onclick=" OpenDocuments(this) ">@MessageResource.WorkOrderCard_Display_Documents <span class="label label-danger">@Model.DocumentCount</span></button>
                    @if (Model.ProposalStatId == 1)
                    {
                        <button class="btn btn-info" onclick="ApproveProposal();">@MessageResource.ApproveProposal</button>
                    }

                    @*Yeni Teklif ya da Onay Bekleyen ise Göster*@
                    @if (Model.ProposalStatId == -1 || Model.ProposalStatId == 1)
                    {
                        if (ODMSHelpers.UserHasPermission(CommonValues.PermissionCodes.ProposalCard.ProposalCardCancel))
                        {
                            <button class="btn btn-danger pull-right" onclick="_CancelProposal(true,this);">
                                <i class="glyphicon glyphicon-ban-circle"></i>@MessageResource.Global_Display_Cancel
                            </button>
                        }
                    }

                </div>
            </div>
        }
        <div id="work-order-grid" class="panel panel-default">
            <div class="panel-heading">
                <strong style="font-size: 16px;">
                    @String.Format(MessageResource.ProposalCard_Title_ProposalDetails, Model.ProposalId) [@Model.DealerName]


                </strong>


                @if (Model.ProposalStatId != 4)
                {

                    <div class="pull-right">
                        @Html.Kendo().DropDownListFor(c => c.ProposalStatId).AutoBind(true).DataValueField("Value").DataTextField("Text").BindTo(ViewBag.ProposalStatsList as List<SelectListItem>).Enable(Model.ProposalStatManualChangeAllow).HtmlAttributes(new { style = "width:200px" })
                    </div>
                }
                else
                {
                    <div style="color: #ff0000; display: inline-block; font-size: 16px; font-weight: bold; padding-right: 10px; text-transform: uppercase;" class="pull-right">
                        @MessageResource.ApprovedProposal
                    </div>
                }

                <div class="clearfix"></div>

            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-lg-7">
                        @if (Model.FleetId.HasValue)
                        {
                            <div class="alert alert-info">

                                <strong>
                                    @Html.Raw(string.Format(MessageResource.WorkOrderCard_Display_FleetMessage, Model.Customer.CustomerName, Model.FleetName, Model.OtokarPartDiscountRate, Model.DealerPartDiscountRate, Model.OtokarLabourDiscountRate, Model.DealerLabourDiscountRate))
                                </strong>
                            </div>
                        }
                        <p>
                            <strong style="font-size: 14px;">@MessageResource.Proposal_Display_ProposalDate :</strong><em style="font-size: 13px; padding-left: 5px;">@Model.ProposalDate.ToString("dd MMMM yyyy HH:mm")</em> <span style="padding-left: 20px;">&nbsp;</span>
                            @if (Model.VehicleLeaveDate.HasValue)
                            {
                                <strong style="font-size: 14px;">@MessageResource.WorkOrderCard_Dislay_VehicleLeaveDate :</strong> <em style="font-size: 13px; padding-left: 5px;">@Model.VehicleLeaveDate.GetValueOrDefault().ToString("dd MMMM yyyy HH:mm") <span style="padding-left: 20px; "></span></em>

                            }
                        </p>
                        <p>
                            <strong style="font-size: 14px;">@MessageResource.Vehicle_Display_SpecialConditions : </strong><em style="font-size: 12px; padding-left: 5px;"><span style="">@Model.Vehicle.SpecialConditions</span></em> <span style="padding-left: 20px;">&nbsp;</span>

                        </p>
                        @if (UserManager.UserInfo.DealerID == 0)
                        {
                            <p>
                                <strong style="font-size: 14px;">@MessageResource.GRADGif_Display_Notes : </strong><em style="font-size: 12px; padding-left: 5px;"><span style="">@Model.Vehicle.Notes</span></em> <span style="padding-left: 20px;">&nbsp;</span>

                            </p>
                        }
                        <p>
                            <strong style="font-size: 14px;">@MessageResource.Appointment_Display_ComplaintDescription : </strong><em style="font-size: 12px; padding-left: 5px;"><span style="">@Model.CustomerNote</span></em> <span style="padding-left: 20px;">&nbsp;</span>

                        </p>
                    </div>


                    <div class="col-lg-4 text-right">
                        <table class="table table-condensed text-left table-bordered">
                            <tr>
                                <th style="padding-right: 8px;">
                                    @MessageResource.WorkOrderCard_Display_AppointmentNo :
                                </th>
                                <td>
                                    @(Model.AppointmentId > 0 ? Html.Raw(Model.AppointmentId) : Html.Raw("-"))
                                </td>
                            </tr>
                            <tr>
                                <th style="padding-right: 8px;">
                                    @MessageResource.Appointment_Display_AppointmentDate :
                                </th>
                                <td>
                                    @(Model.AppointmentDate.GetValueOrDefault() == new DateTime(1900, 1, 1, 0, 0, 0) ? Html.Raw("-") : Html.Raw(Model.AppointmentDate))
                                </td>
                            </tr>
                            <tr>
                                <th style="padding-right: 8px;">
                                    @MessageResource.Appointment_Display_AppointmentType :
                                </th>
                                <td>
                                    @Model.AppointmentType
                                </td>
                            </tr>
                            <tr>
                                <th style="padding-right: 8px;">
                                    @MessageResource.Proposal_Display_ResponsibleConsultant :
                                </th>
                                <td>
                                    @Model.Customer.Staff
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <div id="ProposalDetails">

                <table id="tblProposalDetails" class="table table-striped table-bordered" style="width: 100%; margin: 10px auto 0;">
                    <thead>
                        <tr class="menu">
                            <th class="text-center">
                                @MessageResource.WorkOrderCard_Display_Indicator @MessageResource.Global_Display_Id / GIF NO
                            </th>
                            <th>@MessageResource.WorkOrderCard_Display_IndicatorStatus</th>
                            <th>@MessageResource.WorkOrderCard_Display_Part</th>
                            <th>@MessageResource.WorkOrderCard_Display_Labour</th>
                            <th>@MessageResource.WorkOrderCard_Display_TechnicalDescription</th>
                            @if (Model.Details.Any(c => c.IsCampaign))
                            {
                                <th>
                                    @MessageResource.WorkOrderCard_Display_CampaingPartRequest
                                </th>
                            }
                            <th>@MessageResource.Global_Display_Cancel</th>
                            <th>@MessageResource.AppointmentIndicatorFailureCode_Display_Code</th>
                            <th>@MessageResource.WorkOrderCard_Display_Type</th>
                            <th>@MessageResource.WorkOrderCard_Display_PartLabourCode</th>
                            <th>@MessageResource.WorkOrderCard_Display_Description</th>
                            <th>@MessageResource.WorkOrderCard_Display_CountTime</th>
                            <th>@MessageResource.WorkOrderCard_Display_UnitPrice</th>
                            <th>@MessageResource.WorkOrderCard_Display_DiscountRatio</th>
                            <th>@MessageResource.WorkOrderCard_Display_TotalPrice</th>

                        </tr>
                    </thead>
                    <tbody>

                        @foreach (var item in Model.DetailList)
                        {
                            <tr class="@(item.IsCanceled ? Html.Raw("danger") : Html.Raw("info")) text-center">
                                <td>
                                    @item.ProposalDetailId / @item.GifNo
                                </td>
                                <td style="width: 60px">
                                    @if (item.GosApprovalNeed)
                                    {
                                        @item.WarrantyStatusDesc
                                        if (item.WarrantyStatus.In(3, 6))
                                        {
                                            <a class="k-link bstooltip" title="@item.GuaranteeConfirmDesc">
                                                <i class="glyphicon glyphicon-info-sign"></i>
                                            </a>
                                        }
                                    }
                                    @if (item.InvoiceId.HasValue)
                                    {
                                        <span style="display: inline-block" class="bold text-success">@MessageResource.WorkOrderCard_Display_Invoiced</span>
                                    }
                                    else if (item.InvoiceId == null && item.IsBillable && item.InvoiceCancel && !Model.VehicleLeaveDate.HasValue)
                                    {
                                        <span style="display: inline-block" class="bold text-success">@MessageResource.WorkOrderCard_Not_Invoice</span>
                                    }
                                </td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center">

                                    <a class="k-link bstooltip" title="@item.TechicalDescription">
                                        <i class="glyphicon glyphicon-info-sign"></i>
                                    </a>

                                </td>
                                @if (Model.Details.Any(c => c.IsCampaign))
                                {
                                    <td>
                                        @if (Model.Details.Any(c => c.IsCampaign && c.ProposalDetailId == item.ProposalDetailId && c.HasOtokarCampaignStock == false && c.CampaignRequestId != null))
                                        {
                                            <a class="k-link" onclick="OpenCampaignRequestDetails(@item.ProposalDetailId, @Model.Details.FirstOrDefault(c => c.IsCampaign && c.ProposalDetailId == item.ProposalDetailId).CampaignRequestId, this) ">
                                                <i class="glyphicon glyphicon-list"></i>
                                            </a>
                                        }

                                    </td>
                                }
                                <td class="text-center"></td>
                                <td>
                                    <a class="bstooltip k-link" title="@item.FailureCodeDescription">@item.FailureCode</a>

                                </td>
                                <td>@item.ProcessType</td>
                                <td>@item.Code</td>
                                <td>@item.Description</td>


                                <td class="text-center text-danger"></td>


                            </tr>
                            foreach (var detail in Model.Details.Where(c => c.ProposalDetailId == item.ProposalDetailId && c.Type != "INDICATOR"))
                            {
                                <tr>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td class="text-center"></td>
                                    @if (detail.Type == "LABOUR")
                                    {
                                        <td title="@GetLabourTdTitle(detail)" class="bstooltip text-center @GetLabourTdClass(detail.LabourWorkStatusId, detail.IsExternalLabour)"></td>
                                    }
                                    else
                                    {
                                        <td class="text-center">&nbsp;</td>
                                    }
                                    <td class="text-center">&nbsp;</td>
                                    @if (Model.Details.Any(c => c.IsCampaign))
                                    {
                                        <td>&nbsp;</td>
                                    }
                                    <td></td>

                                    <td>&nbsp;</td>
                                    <td>
                                        @(detail.Type == "LABOUR" ? detail.IsExternalLabour ? MessageResource.WorkOrderCard_Display_ExternalLabour : MessageResource.WorkOrderCard_Display_Labour : MessageResource.WorkOrderCard_Display_Part)
                                    </td>
                                    <td class="@Html.Raw(detail.Type == "LABOUR" ? "labourCode" : "partCode")">@detail.Code</td>
                                    <td>
                                        @if (detail.Type == "PART")
                                        {
                                            @detail.Name
                                            <a class="k-link bstooltip" title="@detail.StockType">
                                                <i class="glyphicon glyphicon-info-sign"></i>
                                            </a>
                                        }
                                        else
                                        {
                                            @detail.Name
                                        }

                                    </td>
                                    <td class="@(detail.Type == "PART" ? GetPartTdClass(detail.RequiredQuantity, detail.ReservedQuantity, detail.PickedQuantity, detail.ReturnedQuantity) : @Html.Raw(""))">
                                        @if (detail.Type == "PART")
                                        {
                                            @detail.RequiredQuantity
                                        }
                                        else
                                        {
                                            <span>@Convert.ToInt32(detail.Quantity) / @detail.Duration</span>
                                        }
                                        @if (detail.Type == "PART")
                                        {
                                            <a class="part-tooltip" title="@(GetPartToolTipHtml(detail.RequiredQuantity, detail.ReservedQuantity, detail.PickedQuantity, detail.ReturnedQuantity))">
                                                <i class="glyphicon glyphicon-info-sign"></i>
                                            </a>
                                        }
                                    </td>
                                    <td>
                                        @detail.Price.RoundUp(2)
                                        <a class="part-tooltip" title="@(GetPriceToolTipHtml(detail))">
                                            <i class="glyphicon glyphicon-info-sign"></i>
                                        </a>
                                    </td>
                                    @if (detail.Type == "PART" && !detail.IsCampaign)
                                    {
                                        <td title="@GetDiscountTdTitle(detail.DiscountPrice, detail.DealerPrice, detail.ProfitMarginRatio)" class="@GetDiscountTdClass(detail.DiscountPrice, detail.DealerPrice, detail.ProfitMarginRatio) bstooltip">
                                            @detail.DiscountRatio

                                        </td>
                                    }
                                    else
                                    {
                                        <td>
                                            @detail.DiscountRatio

                                        </td>
                                    }
                                    <td>@detail.TotalPrice.RoundUp(2)</td>


                                </tr>
                            }
                        }


                    </tbody>

                </table>





                <div class="panel-footer">
                    <div class="panel panel-default ">
                        <div class="panel-heading">
                            <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseCustomerTotal">


                                <strong style="font-size: 16px;">
                                    @MessageResource.WorkOrderCard_Display_TotalCustomer
                                </strong>
                            </a>

                        </div>
                        <div class="panel-body panel-collapse collapse" id="collapseCustomerTotal" style="height: 0px">



                            <table class="table table-bordered table-zipped">
                                <tbody>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalPartPrice : </th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalCustomerPrice : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalLabourPrice :</th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalCustomerPrice : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_CustomerTotalPrice :</th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.TotalCustomerPrice).RoundUp(2)</td>
                                    </tr>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_DiscountPartPrice :</th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalDiscount : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_DiscountLabourPrice :</th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalDiscount : 0).RoundUp(2) </td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_DiscountTotalPrice :</th>
                                        <td class="col-md-2" colspan="3">@Model.Details.Sum(c => c.TotalDiscount).RoundUp(2)</td>
                                    </tr>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Discounted_Total_SparePart_Price</th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? (c.TotalPrice) : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Discounted_Total_Labour_Price :</th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? (c.TotalPrice) : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Discounted_Total_Customer_Price :</th>
                                        <td class="col-md-2" colspan="3">@Model.Details.Sum(c => c.TotalPrice).RoundUp(2)</td>
                                    </tr>

                                </tbody>
                            </table>

                        </div>
                    </div>

                    <div class="panel panel-default ">
                        <div class="panel-heading">
                            <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseWarrantyTotal">


                                <strong style="font-size: 16px;">
                                    @MessageResource.WorkOrderCard_Display_TotalWarranty
                                </strong>
                            </a>

                        </div>
                        <div class="panel-body panel-collapse collapse" id="collapseWarrantyTotal" style="height: 0px">

                            <table class="table table-bordered table-zipped">
                                <tbody>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalPartPrice :  </th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalWarrantyPriceWithoutDeduction : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalLabourPrice : </th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalWarrantyPriceWithoutDeduction : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyTotalPrice :</th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.TotalWarrantyPriceWithoutDeduction).RoundUp(2)</td>
                                    </tr>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Deduction_Total_SparePart_Price :  </th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalWarrantyDeductionPrice : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Deduction_Total_Labour_Price :  </th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalWarrantyDeductionPrice : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Deduction_Total_Guarantee_Price :</th>
                                        <td class="col-md-2 ">@Model.Details.Sum(c => c.TotalWarrantyDeductionPrice).RoundUp(2)</td>

                                    </tr>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyPartGeneralPrice :  </th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalWarrantyPrice : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyLabourGeneralPrice :  </th>
                                        <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalWarrantyPrice : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyGeneralPrice :</th>
                                        <td class="col-md-2 ">@Model.Details.Sum(c => c.TotalWarrantyPrice).RoundUp(2)</td>

                                    </tr>
                                </tbody>
                            </table>

                        </div>
                    </div>

                    <div class="panel panel-default ">
                        <div class="panel-heading">
                            <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseWOTotal">


                                <strong style="font-size: 16px;">
                                    @MessageResource.WorkOrderCard_Display_WOTotal
                                </strong>
                            </a>

                        </div>
                        <div class="panel-body panel-collapse collapse" id="collapseWOTotal" style="height: 0px">

                            <table class="table table-bordered table-zipped">
                                <tbody>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> @MessageResource.WorkOrderCard_Display_TotalPart : </th>
                                        <td class="col-md-3">@Model.Details.Where(c => c.Type == "PART").Sum(c => c.RequiredQuantity) </td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_TotalLabour :</th>
                                        <td class="col-md-7" colspan="3">@Model.Details.Where(c => c.Type == "LABOUR").Count()</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Deduction_And_Discount_Before_Price : </th>
                                        <td class="col-md-7" colspan="3">@Model.Details.Sum(c => (c.TotalCustomerPrice + c.TotalWarrantyPriceWithoutDeduction)).RoundUp(2)</td>
                                    </tr>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> @MessageResource.PDIInvoiceList_Display_TotalPartPrice : </th>
                                        <th class="col-md-3">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalPrice + c.TotalWarrantyPrice : 0).RoundUp(2)</th>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalLabourPrice : </th>
                                        <td class="col-md-3" colspan="3">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalPrice + c.TotalWarrantyPrice : 0).RoundUp(2)</td>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WOTotal : </th>
                                        <td class="col-md-3" colspan="3">@Model.Details.Sum(c => c.TotalPrice + c.TotalWarrantyPrice).RoundUp(2)</td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                    </div>
                    <div class="panel panel-default ">
                        <div class="panel-heading">
                            <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseTechnicianDesc">
                                <strong style="font-size: 16px;">
                                    @MessageResource.Proposal_Card_Tab_Title_Technician_Description
                                </strong>
                            </a>
                        </div>
                        <div class="panel-body panel-collapse collapse" id="collapseTechnicianDesc" style="height: 0px">
                            @using (Html.BeginForm("SaveTechnicianInfo", "Proposal_Card", FormMethod.Post))

                            {@Html.HiddenFor(x => x.ProposalId)
                            @Html.HiddenFor(x => x.ProposalSeq)
                            <div class="row clearfix">
                                <div class="col-md-11 column">
                                    <table class="table table-bordered table-hover" id="tab_logic">
                                        <thead>
                                            <tr>
                                                <th class="text-center">
                                                    Madde No
                                                </th>
                                                <th class="text-center">
                                                    Madde Açıklaması
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @{
                                                var count = Model.TechnicialDescList.Length;
                                            }
                                            @for (int i = 0; i < Model.TechnicialDescList.Length; i++)
                                            {
                                                <tr id="@string.Format("{0}{1}","addr",i)">
                                                    <td>@string.Format("{0}", i + 1)</td>
                                                    <td>
                                                        <input name="TechnicalDesc[@i]" type='text' placeholder="@string.Format("{0}",i+1). Madde Açıklaması" style="width:98%;" class="form-control input-md" value="@Model.TechnicialDescList[i]" disabled="" />
                                                    </td>
                                                </tr>
                                            }
                                            @if (count == 0)
                                            {
                                                <input name="TechnicalDesc[0]" type='text' placeholder="1. Madde Açıklaması" style="width:98%;" class="form-control input-md" value="" required />}

                                            <tr id="@string.Format("{0}{1}","addr",count)"></tr>
                                        </tbody>

                                    </table>
                                </div>
                            </div>






                        }
                        </div>
                    </div>

                    <div class="panel panel-default ">
                        <div class="panel-heading">
                            <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseGeneralDesc">


                                <strong style="font-size: 16px;">
                                    @MessageResource.Proposal_Card_Tab_Title_General_Description
                                </strong>
                            </a>

                        </div>
                        <div class="panel-body panel-collapse collapse" id="collapseGeneralDesc" style="height: 0px">
                            @using (Html.BeginForm("SaveGeneralInfos", "Proposal_Card", FormMethod.Post))

                            {
                                @Html.HiddenFor(x => x.ProposalId)
                                @Html.HiddenFor(x => x.ProposalSeq)
                                <table class="table table-bordered table-zipped">

                                    <tbody>
                                        <tr>
                                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> 1: </th>
                                            <td class="col-md-3">
                                                @("Verilen teklifin geçerlilik süresi Teklif Veriliş Tarihinden itibaren")

                                                @Html.TextBoxFor(x => x.Matter1, htmlAttributes: new { @style = "text-decoration:underline;width:70px;" }) @("gün geçerlidir.")
                                            </td>

                                        </tr>
                                        <tr>
                                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> 2: </th>
                                            <td class="col-md-3">@("Teklifte bildirilen Parça ve Onarım Hizmeti Onay Tarihinden itibaren") @Html.TextBoxFor(x => x.Matter2, htmlAttributes: new { @style = "text-decoration:underline;width:70px;" }) @("gün içinde teslim edilir / tamamlanır.")</td>
                                        </tr>
                                        <tr>
                                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> 3: </th>
                                            <td class="col-md-3">@("Teklifte bildirilen Parça ve Onarım Hizmeti dışında doğacak Parçaların teslimi, Onarım Hizmeti ve ek Taleplerin tamamlanması 2. maddede verilen süreye ilave edilir. Müşteri onayına istinaden işlem yapılır.")</td>
                                        </tr>
                                        <tr>
                                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> 4: </th>
                                            <td class="col-md-3">@("Teklifte yer alan parça ve işçiliklerdeki değişiklik müşteri onayına istinaden yapılır.")</td>
                                            @*<td class="col-md-3">@("Verilen Teklifte işin nevine göre teklif tutarında (+/-) %") @Html.TextBoxFor(x => x.Matter3, htmlAttributes: new { @style = "text-decoration:underline;width:70px;" })@("oranında doğacak değişikleri müşteri kabul eder ve değişen tutar üzerinden fatura düzenlenmek suretiyle ödeme alınır.  Belirtilen oranın üzerinde doğan maliyetler için müşteri onayına istinaden işlem yapılır.")</td>*@
                                        </tr>
                                        <tr>
                                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> 5: </th>
                                            <td class="col-md-3">@("Verilen Teklifin müşteri tarafından yaptırılmaması durumunda Teklif hazırlama ve Ekspertiz ücreti müşteriye faturalandırılır.")</td>
                                        </tr>
                                        @*<tr>
                                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> 6: </th>
                                                <td class="col-md-3">@("Konu Teklif dokümanının onaylanması durumunda doğacak damga vergisi ")@Html.TextBoxFor(x => x.Matter4, new { @readonly = "readonly" }) <text id="type1">tarafından / <s>taraflarca</s></text><text id="type2" style="display:none"><s>tarafından</s> / taraflarca</text> @("ödenecektir.")</td>
                                            </tr>*@
                                    </tbody>
                                </table>
                                <br /><br />
                                <div class="labelDiv">@Html.LabelFor(v => v.WitholdingStatusName) : </div>
                                <div class="shortTxtDiv">@Html.DisplayFor(v => v.WitholdingStatusName) &nbsp;</div>
                                <div class="labelDiv">@Html.LabelFor(v => v.WitholdingId) : </div>
                                <div class="shortTxtDiv">@Html.DisplayFor(v => v.WitholdingName)</div>
                            }

                        </div>
                    </div>
                </div>


            </div>

        </div>
    </div>
    @*PopUp Windows*@
    <div id="CampaignRequestDetailsWindow"></div>

    @(Html.Kendo().Window()
       .Name("CancelProposalWindow")
       .Modal(true).Width(500).Height(200)
       .Visible(false)
       .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
       .Events(evt => evt.Close("function(e){ $('#CancelProposalWindow').html(''); }"))  /*RefreshDetails();*/
                                                                                         //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
       .Title(string.Format("{0} [{1}]", MessageResource.Global_Display_Warning, MessageResource.Global_Display_Cancel)))


    @(Html.Kendo().Window()
                  .Name("VehicleKMWindow")
                  .Modal(true).Width(400).Height(200)
                  .Events(evt => evt.Close("function(e){$('#VehicleKMWindow').html('');}"))
                  .Visible(false)
                  //.Animation(a=>a.Open(effect=>effect.SlideIn(SlideDirection.Right)).Close(effect=>effect.Fade(FadeDirection.Out)))
                  .Title(string.Format("{0} [{1}]", MessageResource.Vehicle_Display_VehicleKilometer, MessageResource.Global_Display_Update)))

    @(Html.Kendo().Window()
                  .Name("VehiclePlateWindow")
                  .Modal(true).Width(400).Height(200)
                  .Events(evt => evt.Close("function(e){$('#VehiclePlateWindow').html('');}"))
                  .Visible(false)
                  //.Animation(a=>a.Open(effect=>effect.SlideIn(SlideDirection.Right)).Close(effect=>effect.Fade(FadeDirection.Out)))
                  .Title(string.Format("{0} [{1}]", MessageResource.Vehicle_Display_VehiclePlate, MessageResource.Global_Display_Update)))
    @(Html.Kendo().Window()
                  .Name("ContactInfoWindow")
                  .Modal(true).Width(800).Height(340)
                  .Events(evt => evt.Close("function(e){$('#ContactInfoWindow').html('');}"))
                  .Visible(false)
                  .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_PageTitle_Index, MessageResource.WorkOrderCard_Display_ContactInfo)))


    @(Html.Kendo().Window()
                  .Name("AddProposalDetailWindow")
                  .Modal(true).Width(600).Height(380)
                  .Visible(false)
                  .Iframe(true)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){ $('#AddProposalDetailWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_AddDetail)))

    @(Html.Kendo().Window()
                  .Name("AddProposalLabourWindow")
                  .Modal(true).Width(950).Height(350)
                  .Visible(false)
                  .Iframe(true)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){ $('#AddProposalLabourWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1} {2}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_Labour, MessageResource.Global_Display_Add)))

    @(Html.Kendo().Window()
                  .Name("AddProposalPartWindow")
                  .Modal(true).Width(650).Height(200)
                  .Visible(false)
                  .Iframe(true)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){ $('#AddProposalPartWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1} {2}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_Part, MessageResource.Global_Display_Add)))
    @(Html.Kendo().Window()
                  .Name("AddProposalMaintWindow")
                  .Modal(true).Width(500).Height(200)
                  .Visible(false)
                  .Iframe(true)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){ $('#AddProposalMaintWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1} {2}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_PeriodicMeintenance, MessageResource.Global_Display_Add)))
    @(Html.Kendo().Window()
                  .Name("CancelProposalDetailWindow")
                  .Modal(true).Width(500).Height(200)
                  .Visible(false)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){ $('#CancelProposalDetailWindow').html(''); RefreshDetails(); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.Global_Display_Cancel)))
    @(Html.Kendo().Window()
                  .Name("AddDetailDiscountWindow")
                  .Modal(true).Width(500).Height(350)
                  .Visible(false)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){ $('#AddDetailDiscountWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1} {2}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_Discount, MessageResource.Global_Display_Add)))
    @(Html.Kendo().Window()
                  .Name("AddDetailQuantityWindow")
                  .Modal(true).Width(500).Height(250)
                  .Visible(false)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                   .Events(evt => evt.Close("function(e){ $('#AddDetailQuantityWindow').html(''); RefreshDetails(); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1} {2}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_CountTime, MessageResource.Global_Display_Add)))
    @(Html.Kendo().Window()
                  .Name("EditMeintenanceQuantityWindow")
                  .Modal(true).Width(500).Height(300)
                  .Visible(false)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                 .Events(evt => evt.Close("function(e){ $('#EditMeintenanceQuantityWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1} {2}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_PeriodicMeintenance, MessageResource.Global_Display_Edit)))
    @(Html.Kendo().Window()
                  .Name("AddCampaignWindow")
                  .Modal(true).Width(800).Height(550)
                  .Visible(false)
                  .Iframe(true)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){ $('#AddCampaignWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_AddCampaign)))

    @(Html.Kendo().Window()
                  .Name("VehicleNotesWindow")
                  .Modal(true).Width(820).Height(350)
                  .Visible(false)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){location.reload();}"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0}", MessageResource.WorkOrderCard_Display_VehicleNotes)))

    @(Html.Kendo().Window()
                  .Name("DealerNotesWindow")
                  .Modal(true).Width(820).Height(350)
                  .Visible(false)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){$('.ajax-loading').removeClass('hide');location.reload();}"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0}", MessageResource.WorkOrderCard_Display_DealerNotes)))

    @(Html.Kendo().Window()
                  .Name("DocumentsWindow")
                  .Modal(true).Width(1200).Height(410)
                  .Visible(false)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){ $('#DocumentsWindow').html(''); $('.ajax-loading').addClass('hide');location.reload();}").Open("function(e){ $('.ajax-loading').addClass('hide'); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_PageTitle_Index, MessageResource.WorkOrderCard_Display_Documents)))

    @(Html.Kendo().Window()
                  .Name("WarrantyWindow")
                  .Modal(true).Width(800).Height(350)
                  .Visible(false)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){ $('#WarrantyWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_PageTitle_Index, MessageResource.WorkOrderCard_Display_SendToWarranty)))

    @(Html.Kendo().Window()
                  .Name("ChangePriceListWindow")
                  .Modal(true).Width(500).Height(350)
                  .Visible(false)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){ $('#ChangePriceListWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_ChangePriceList)))
    @(Html.Kendo().Window()
                  .Name("ReservDetailPartsWindow")
                  .Modal(true).Width(500).Height(350)
                  .Visible(false)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){ $('#ReservDetailPartsWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_ReservParts)))

    @(Html.Kendo().Window()
                  .Name("ReturnPartsWindow")
                  .Modal(true).Width(800).Height(450)
                  .Visible(false)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){ $('#ReturnPartsWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Title_ReturnParts)))

    @(Html.Kendo().Window()
                  .Name("TechnicalDescriptionWindow")
                  .Modal(true).Width(600).Height(380)
                  .Events(evt => evt.Close("function(e){$('#TechnicalDescriptionWindow').html('');}"))
                  .Visible(false)
                  .Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_TechnicalDescription)))

    @(Html.Kendo().Window()
                  .Name("InvoiceWindow")
                  .Iframe(true)
                  .Modal(true).Width(1200).Height(580)
                  .Events(evt => evt.Close("function(e){$('#InvoiceWindow').html(''); window.location.reload();}"))
                  .Visible(false)
                  .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_PageTitle_Index, MessageResource.WorkOrderInvoice_Dislay_FinishInvoice)))



    @(Html.Kendo().Window()
                  .Name("UpdateFailureCodeWindow")
                  .Modal(true).Width(500).Height(200)
                  .Visible(false)
                  .HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
                  .Events(evt => evt.Close("function(e){ $('#UpdateFailureCodeWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
                  //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
                  .Title(string.Format("{0} [{1} {2}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.AppointmentIndicatorFailureCode_Display_Code, MessageResource.Global_Display_Update)))
    <div id="AssignTechnicianWindow" class="hide"></div>
    <div id="UpdateProcessType" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="PartRemovalWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="AddPdiPackageWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="PdiPackageResultsWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="VehicleInfoWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="SendToWarrantyWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="PrintBarcodeWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="VehicleHistoryWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
    <div id="CancelVehicleLeaveWindow" style="background-color: #EDF1F4 !important" class="hide"></div>


    @*End of PopUp Windows*@

    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/Scripts/custom.js"></script>
    <script src="~/Scripts/jqueryFileDowload.js"></script>
    <script src="~/Scripts/odms.objectsearch.js"></script>
    <script>
        function stickIt() {

            var orgElementPos = $('.original').offset();
            var orgElementTop = orgElementPos.top;
            $("#tblProposalDetails tbody tr:last-child td").each(function(i, e) {
                var th = $(".cloned th").eq(i);
                th.width($(e).width() + 1);
            });

            if ($(window).scrollTop() >= (orgElementTop)) {

                var orgElement = $('.original');
                var coordsOrgElement = orgElement.offset();
                var leftOrgElement = coordsOrgElement.left;
                var widthOrgElement = orgElement.width();

                $('.cloned').css('left', leftOrgElement + 'px').css('top', 0).css('width', widthOrgElement + 'px').show();
                $('.original').css('visibility', 'hidden');
            } else {
                // not scrolled past the menu; only show the original menu.
                $('.cloned').hide();
                $('.original').css('visibility', 'visible');
            }
        }

        $(function() {
            $('.menu').addClass('original').clone().insertAfter('.menu').addClass('cloned').css('position', 'fixed').css('top', '0').css('margin-top', '0').css('z-index', '500').removeClass('original').hide();

            stickIt();
            $(window).scroll(function() {
                var windowTop = $(window).scrollTop();

                if (windowTop > $('.original').offset().top) {
                    stickIt();
                } else {
                    $('.cloned').hide();
                    $('.original').css('visibility', 'visible');
                }
            });
            $(window).resize(stickIt);
        });

        $(document).ready(function() {

            $('.panel-collapse').collapse({
                toggle: false
            });
            ResetToolTips();
            $(document).on("click", "#GetProposalVehicleLeave", function() {
                $.fileDownload($(this).prop('href'), {

                });
                return false;
            });



        });

        function UpDateVehicleKM(obj) {
            if ($(obj).hasClass("disabled")) return;
            var km = parseInt($("#VehicleKM").text());
            $('#VehicleKMWindow').html('');
            var windowWidget = $("#VehicleKMWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("UpdateVehicleKM")/' + @Model.ProposalId + "?km=" + $("#VehicleKM").text().replace("\/s", "")
            }).center();


            windowWidget.open();

            $('.k-overlay').unbind("click");
            $('.k-overlay').click(function() {
                if (windowWidget) {
                    windowWidget.close();
                    $('#VehicleKMWindow').html('');
                }
            });

        }

        function ProposalRevision(obj) {
            if ($(obj).hasClass("disabled")) return;
            CustomConfirm2(function() {
                DisableClicks();
                $.post(
                    "@Url.Action("ProposalRevision")", { id: @Model.ProposalId,seq:@Model.ProposalSeq},

                    function(json) {
                        if (json.Status == 0) {
                            AlertErrorMessage(json.Message);
                        } else {
                            AlertSuccessMessage(json.Message);
                            window.location.reload()
                        }
                        EnableClicks();
                    }, "json");

            }, '@Html.Raw(MessageResource.Global_Display_Warning)', '@Html.Raw(MessageResource.ProposalCard_Display_Revision_Proposal)', '@MessageResource.Global_Display_Yes',  '@MessageResource.Global_Display_No');
        }
        function ApproveProposal(obj) {
            if ($(obj).hasClass("disabled")) return;
            CustomConfirm2(function() {
                DisableClicks();
                $.post(
                    "@Url.Action("ApproveProposal")", { id: @Model.ProposalId,seq:@Model.ProposalSeq},

                    function(json) {
                        if (json.Result == 0) {
                            AlertErrorMessage(json.Message);
                        } else {
                            AlertSuccessMessage(json.Message);
                            window.location.reload()
                        }
                        EnableClicks();
                    }, "json");

            }, '@Html.Raw(MessageResource.Global_Display_Warning)', '@Html.Raw(MessageResource.ProposalCard_Display_Approve_Proposal)', '@MessageResource.Global_Display_Yes',  '@MessageResource.Global_Display_No');
        }
        function UpDateVehiclePlate(obj) {
            if ($(obj).hasClass("disabled")) return;
            var km = parseInt($("#VehiclePlate").text());
            $('#VehiclePlateWindow').html('');
            var windowWidget = $("#VehiclePlateWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("UpdateVehiclePlate")/' + @Model.ProposalId + "?plate=" + $("#VehiclePlate").text().replace("\/s", "")
            }).center();


            windowWidget.open();

            $('.k-overlay').unbind("click");
            $('.k-overlay').click(function() {
                if (windowWidget) {
                    windowWidget.close();
                    $('#VehiclePlateWindow').html('');
                }
            });

        }

        function OpenInvoiceWindow(obj) {
            if ($(obj).hasClass("disabled")) return;
            $('#InvoiceWindow').html('');
            var windowWidget = $("#InvoiceWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("ProposalInvoiceCreate", "ProposalInvoice", new { id = Model.ProposalId })'
            }).center();


            windowWidget.open();
        }

        function UpdateContactInfo(idProposal, obj) {
            if ($(obj).hasClass("disabled")) return;
            $('#ContactInfoWindow').html('');
            var windowWidget = $("#ContactInfoWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("UpdateContactInfo")/' + @Model.ProposalId
            }).center();


            windowWidget.open();



        }

        function AddTechnicalDetail(ProposalDetailId, obj) {
            if ($(obj).hasClass("disabled")) return;
            $('#TechnicalDescriptionWindow').html('');
            var windowWidget = $("#TechnicalDescriptionWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("AddTechnicalDetail")/' + @Model.ProposalId + '?ProposalDetailId=' + ProposalDetailId
            }).center();
            //windowWidget.center();
            windowWidget.bind("close", function() {
                window.location.reload()
            });
            windowWidget.open();


        }


        function AddProposalDetail(obj) {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#AddProposalDetailWindow').html('');
            var windowWidget = $("#AddProposalDetailWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("AddProposalDetail")/' + @Model.ProposalId
            }).center();

            windowWidget.open();



        }

        function AddPart(ProposalDetailId, obj) {

            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#AddProposalPartWindow').html('');
            var windowWidget = $("#AddProposalPartWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("AddProposalPart")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId
            }).center();

            windowWidget.open();
        }

        function AddLabour(ProposalDetailId, vehicleId, obj) {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#AddProposalLabourWindow').html('');
            var windowWidget = $("#AddProposalLabourWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("AddProposalLabour")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId + '&vehicleId=' + vehicleId
            }).center();

            windowWidget.open();


        }

        function AddMaintenance(ProposalDetailId, obj) {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#AddProposalMaintWindow').html('');
            var windowWidget = $("#AddProposalMaintWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("AddProposalMaint")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId
            }).center();

            windowWidget.open();



        }

        //Emre
        function _CancelProposal(needRefresh, obj)
        {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#CancelProposalWindow').html('');
            var windowWidget = $("#CancelProposalWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("CancelProposal")?id=' + @Model.ProposalId+"&seq="+@Model.ProposalStatId
            }).center();
            windowWidget.bind("close", function() {
                if(needRefresh==true)
                    window.location.reload()
            });
            windowWidget.open();


        }


        function CancelProposalDetailWithCampaignRequest(ProposalDetailId, campaignRequestId, obj) {

            CancelDetailDeleteConfirm(function() {
                CancelProposalDetail(ProposalDetailId, obj);
            });

        }


        function CancelProposalDetail(ProposalDetailId, obj) {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#CancelProposalDetailWindow').html('');
            var windowWidget = $("#CancelProposalDetailWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("CancelProposalDetail")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId
            }).center();

            windowWidget.open();


        }


        function ReservDetailParts(ProposalDetailId, indicatorId, obj) {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#ReservDetailPartsWindow').html('');
            var windowWidget = $("#ReservDetailPartsWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("ReservDetailParts")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId,
            }).center();

            windowWidget.open();


        }

        function ReturnParts(ProposalDetailId, obj) {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#ReturnPartsWindow').html('');
            var windowWidget = $("#ReturnPartsWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("ReturnParts")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId,
            }).center();

            windowWidget.open();


        }

        function AddCampaign(obj, campaignCode) {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#AddCampaignWindow').html('');
            var windowWidget = $("#AddCampaignWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("AddCampaign")/' + @Model.ProposalId + "?campaignCode=" + campaignCode
            }).center();

            windowWidget.open();

        }


        function AddDetailDiscount(ProposalDetailId, id, type, obj) {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#AddDetailDiscountWindow').html('');
            var windowWidget = $("#AddDetailDiscountWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("AddDetailDiscount")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId + "&type=" + type + "&itemId=" + id,
            }).center();

            windowWidget.open();



        }

        function AddDetailQuantity(ProposalDetailId, id, type, obj) {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#AddDetailQuantityWindow').html('');
            var windowWidget = $("#AddDetailQuantityWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("AddDetailQuantity")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId + "&type=" + type + "&itemId=" + id,
            }).center();

            windowWidget.open();


        }




        function OpenDocuments(obj) {
            if ($(obj).hasClass("disabled")) return;
            $('#DocumentsWindow').html('');
            var windowWidget = $("#DocumentsWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("ProposalDocumentsIndex", "ProposalDocuments")?id=' + @Model.ProposalId+'&seq='+@Model.ProposalSeq
            }).center();
            windowWidget.open();


        }

        function OpenVehicleNotesProposal(obj) {
            if ($(obj).hasClass("disabled")) return;
            $('#VehicleNotesWindow').html('');
            var windowWidget = $("#VehicleNotesWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("VehicleNotesProposal", "Proposal_Card")/' + @Model.ProposalId //+"?ProposalDetailId="+ProposalDetailId+"&type="+type+"&itemId="+id +"&maintId="+maintenanceId,
            }).center();

            windowWidget.open();




        }

        function OpenDealerNotes(obj) {
            if ($(obj).hasClass("disabled")) return;
            $('#DealerNotesWindow').html('');
            var windowWidget = $("#DealerNotesWindow").data("kendoWindow");
            windowWidget.refresh({
                url: '@Url.Action("DealerNotes", "Proposal_Card")?id=' + @Model.ProposalId+'&seq='+@Model.ProposalSeq //+"?workOrderDetailId="+workOrderDetailId+"&type="+type+"&itemId="+id +"&maintId="+maintenanceId,
            }).center();

            windowWidget.open();


        }



        function OpenCampaignRequestDetails(ProposalDetailId, campaignRequestId, obj) {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#CampaignRequestDetailsWindow').kwnd('@Url.Action("CampaignRequestDetails")' + '?ProposalDetailId=' + ProposalDetailId + '&campaignRequestId=' + campaignRequestId, '@MessageResource.CampaignRequest_PageTitle_Details',
                {
                    iframe: false,
                    width: 800,
                    height: 460,
                    onClose: function() {
                        $("#CampaignRequestDetailsWindow").html('');
                        EnableClicks();
                    }
                });
            $('#CampaignRequestDetailsWindow').removeClass("hide");
            OpenWindow($('#CampaignRequestDetailsWindow'));
        }




        function OpenVehicleDetails(obj) {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#VehicleInfoWindow').kwnd('@Url.Action("VehicleDetails", new { id = Model.Vehicle.VehicleId })', "@Html.Raw(CommonUtility.GetResourceValue("Vehicle_PageTitle_Details"))",
                {
                    iframe: false,
                    width: 950,
                    height: 450,
                    onClose: function() {
                        $("#VehicleInfoWindow").html('');
                        EnableClicks();
                    }
                });
            $('#VehicleInfoWindow').removeClass("hide");
            OpenWindow($('#VehicleInfoWindow'));
        }



        function OpenVehicleHistory(obj) {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#VehicleHistoryWindow').kwnd('@Url.Action("VehicleHistoryIndex", "Vehicle", new { vehicleId = Model.Vehicle.VehicleId })', '@Html.Raw(MessageResource.WorkOrderCard_Display_VehicleHistory)',
                {
                    iframe: true,
                    width: 1250,
                    height: 650,
                    onClose: function() {
                        $("#VehicleHistoryWindow").html('');
                        EnableClicks();
                    }
                });
            $('#VehicleHistoryWindow').removeClass("hide");
            OpenWindow($('#VehicleHistoryWindow'));
        }
        function ProposalRevision(obj) {
            if ($(obj).hasClass("disabled")) return;
            CustomConfirm2(function() {
                DisableClicks();
                $.post(
                    "@Url.Action("ProposalRevision")", { id: @Model.ProposalId,seq:@Model.ProposalSeq},

                    function(json) {
                        if (json.Result == 0) {
                            AlertErrorMessage(json.Message);
                        } else {
                            AlertSuccessMessage(json.Message);
                            window.location.reload()
                        }
                        EnableClicks();
                    }, "json");

            }, '@Html.Raw(MessageResource.Global_Display_Warning)', '@Html.Raw(MessageResource.ProposalCard_Display_Revision_Proposal)', '@MessageResource.Global_Display_Yes',  '@MessageResource.Global_Display_No');
        }
        function OpenPdiPackage(obj) {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            var title = $(obj).html();
            $('#PdiPackageResultsWindow').kwnd('@Url.Action("OpenPdiPackageResults", "Proposal_Card", new { id = Model.ProposalId })', title,
                {
                    iframe: false,
                    width: 1000,
                    height: 400,
                    onClose: function() {
                        $("#PdiPackageResultsWindow").html('');
                        EnableClicks();
                    }
                });
            $('#PdiPackageResultsWindow').removeClass("hide");
            OpenWindow($('#PdiPackageResultsWindow'));
        }

        @if (!ODMSCommon.Security.UserManager.UserInfo.IsDealer)
        {
            <text>
                function CancelVehicleLeave(obj) {

                    if ($(obj).hasClass("disabled")) return;
                    DisableClicks();
                    var title = $(obj).html();
                    $('#CancelVehicleLeaveWindow').kwnd('@Url.Action("CancelVehicleLeave", "Proposal_Card", new { id = Model.ProposalId })', '@Html.Raw(MessageResource.WorkOrder_Dislay_CancelVehicleLeave)',
                        {
                            iframe: false,
                            width: 800,
                            height: 400,
                            onClose: function() {
                                $("#CancelVehicleLeaveWindow").html('');
                                window.location.reload();
                            }
                        });
                    $('#CancelVehicleLeaveWindow').removeClass("hide");
                    OpenWindow($('#CancelVehicleLeaveWindow'));
                }
            </text>
        }

        function GoToProposalInvoice() {
            window.location = "@Url.Action("ProposalInvoiceIndex", "ProposalInvoice", new { id = Model.ProposalId })";
        }

        function DisableClicks() {
            $(".btn, a.k-link, .k-button").not(".k-window-action").addClass("disabled");
            $(".k-link").css({ opacity: "0.7" });
            $(".k-button").attr("disabled", "disabled");
        }





        function CustomConfirm2(func, title, content, textYes, textNo) {
            var confirm = false;
            var kendoWindow = $("<div />").kendoWindow({
                title: title,
                resizable: false,
                modal: true
            });

            var string = '<p class="custom-confirm-message">' + content + '</p>' +
                '<p style="text-align:right">' +
                '<button class="custom-confirm k-button">' + textYes + '</button>' +
                '<button class="custom-cancel k-button">' + textNo + '</button></p>';

            kendoWindow.data("kendoWindow")
                .content(string)
                .center().open();

            kendoWindow
                .find(".custom-confirm, .custom-cancel")
                .click(function() {
                    if ($(this).hasClass("custom-confirm")) {
                        confirm = true;
                        if (func)
                            func();
                    }
                    kendoWindow.data("kendoWindow").close();
                })
                .end();
            return confirm;
        }


        function EnableClicks() {
            $(".btn, a.k-link, .k-button").removeClass("disabled");
            $(".k-link").css({ opacity: "1" });
            $(".k-button").removeAttr("disabled");
            ResetToolTips();
        }

        function RefreshDetails(obj) {
            $(obj).addClass("hide");
            $(obj).next(".ajax-loading").removeClass("hide");
            var wrapper = $('#ProposalDetails');
            $.post(
                "@Html.Raw(Url.Action("GetProposalDetails", new { ProposalId = Model.ProposalId, vehicleId = Model.Vehicle.VehicleId, vehicleLeave = Model.VehicleLeaveDate.HasValue }))",
                null,
                function(html) {
                    wrapper.html(html);
                    $.validator.unobtrusive.parse(wrapper);
                    EnableClicks();
                    stickIt();
                    $(obj).next(".ajax-loading").addClass("hide");
                    $(obj).removeClass("hide");
                }, "html");


        }
        function Print() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("ChangeProposalStatForPrint", "Proposal_Card")",
                data: { id: @Model.ProposalId, seq: @Model.ProposalSeq  },
                traditional: true,
                success: function (result) {
                    if (result.Result == false) {
                        SetErrorMessage(result.Message);
                    }
                    else if (result.Result == true) {
                        window.location.reload();


                    }
                },
                dataType: "json"
            });
        }
        function PrintLabels(ProposalDetailId, printAll, obj) {
            if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            OpenPrintBarcodeWindow(@Model.ProposalId,printAll, obj);
        }

        function CancelDetailDeleteConfirm(deleteFunction) {
            var confirm = false;
            var kendoWindow = $("<div />").kendoWindow({
                title: "@MessageResource.Gloabl_Display_DeleteConfirmTitle",
                resizable: false,
                modal: true
            });

            kendoWindow.data("kendoWindow")
                .content($("#campaign-request-delete-confirm-modal").html())
                .center().open();

            kendoWindow
                .find(".delete-confirm, .delete-cancel")
                .click(function() {
                    if ($(this).hasClass("delete-confirm")) {
                        confirm = true;
                        if (deleteFunction)
                            deleteFunction();
                    }
                    kendoWindow.data("kendoWindow").close();
                })
                .end();
            return confirm;
        }


        function OpenPrintBarcodeWindow(ProposalId,printAll, obj) {
            //if ($(obj).hasClass("disabled")) return;
            DisableClicks();
            $('#PrintBarcodeWindow').kwnd('@Url.Action("PrintBarcode", "SparePartBarcode")' + '/' + ProposalId+'?isPrinted='+printAll, "@Html.Raw(CommonUtility.GetResourceValue("ProposalCard_Display_PartRemovalTitle"))",
                {
                    iframe: true,
                    width: 800,
                    height: 400,
                    onClose: function() {
                        $("#PrintBarcodeWindow").html('');
                        EnableClicks();
                    }
                });
            $('#PrintBarcodeWindow').removeClass("hide");
            OpenWindow($('#PrintBarcodeWindow'));
        }


        var cnt1 = 0;

        function AlertErrorMessage(msg) {
            cnt1++;
            var id = 'alert-div-' + cnt1;
            var kendoWindow = $("<div id='" + id + "'/>").kendoWindow({
                title: "@MessageResource.Global_Display_Warning",
                resizable: false,
                modal: true
            });

            kendoWindow.data("kendoWindow")
                .content($("#alert-modal").html())
                .center().open();
            $(".warning-message", '#' + id).append(msg);
            kendoWindow
                .find(".warning-ok")
                .click(function() {
                    kendoWindow.data("kendoWindow").destroy();
                })
                .end();
        }

        var cnt2 = 0;

        function AlertSuccessMessage(msg) {
            cnt2++;
            var id = 'success-div-' + cnt1;
            var kendoWindow = $("<div id='" + id + "'/>").kendoWindow({
                title: "@MessageResource.Global_Display_Warning",
                resizable: false,
                modal: true
            });

            kendoWindow.data("kendoWindow")
                .content($("#success-modal").html())
                .center().open();
            $(".warning-message", '#' + id).append(msg);
            kendoWindow
                .find(".warning-ok")
                .click(function() {
                    kendoWindow.data("kendoWindow").destroy();
                })
                .end();
        }

        function ResetToolTips() {
            $('.part-tooltip, .bstooltip').each(function(i, e) {
                if ($(e).attr('title') != '')
                    $(e).tooltipster({
                        animation: 'grow',
                        delay: 200,
                        touchDevices: false,
                        fixedWidth: '50px',
                        maxWidth: 400,
                        theme: 'part-theme',
                        trigger: 'hover',
                        contentAsHTML: true
                    });
            });
        }
        $("#btnVehicleHistory").kendoTooltip({
            content: {
                url: "@Url.Action("GetVehicleHistoryToolTipContent", new { id = Model.Vehicle.VehicleId })"
            },
            width: 250,
            height: 100,
            position: "top",
        });
    </script>
}

@helper GetPartTdClass(decimal required, decimal reserved, decimal picked, decimal returned)
{
    if (returned > 0)
    {
        @Html.Raw(" warning ")
        return;
    }
    else
    {
        @Html.Raw(" danger ")
        return;
    }
}

@helper GetPartToolTipHtml(decimal required, decimal reserved, decimal picked, decimal returned)
{
    if (returned > 0)
    {
        @Html.Raw("<div class=\"part-detail-tooltip\"> " +
            "<ul>" +
               " <li><span class=\"bold\">" + MessageResource.WorkOrderCard_Display_Stock + "</span>" +
           "</ul>" +
        "</div>")}
    else
    {
        @Html.Raw("<div class=\"part-detail-tooltip\"> " +
            "<ul>" +
               " <li><span class=\"bold\">" + MessageResource.WorkOrderCard_Display_NoStock + "</span>" +
            "</ul>" +
        "</div>")
    }
}


<script id="alert-modal" type="text/x-kendo-template">
    <div class="alert alert-danger">
        <div style="width:500px">
            <p class="warning-message" style="font-weight:bold"></p>
            <p style="text-align:right">
                <button class="warning-ok btn btn-danger">@MessageResource.Global_Display_Ok</button>
            </p>
        </div>
    </div>
</script>

<script id="success-modal" type="text/x-kendo-template">
    <div class="alert alert-success">
        <div style="width:500px">
            <p class="warning-message" style="font-weight:bold"></p>
            <p style="text-align:right">
                <button class="warning-ok btn btn-success">@MessageResource.Global_Display_Ok</button>
            </p>
        </div>
    </div>
</script>
<script id="campaign-request-delete-confirm-modal" type="text/x-kendo-template">
    <p class="delete-message">@MessageResource.WorkOrderCard_Display_CancelCampaignRequestConfirmQuestion</p>
    <p style="text-align:right">
        <button class="delete-confirm k-button">@MessageResource.Global_Display_Yes</button>
        <button class="delete-cancel k-button">@MessageResource.Global_Display_No</button>
    </p>
</script>

@helper GetDiscountTdClass(decimal discountPrice, decimal? dealerPrice, decimal? profitMarginRatio)
{
    if (dealerPrice.GetValueOrDefault(0) > discountPrice)
    {
        @Html.Raw("danger")
        return;
    }
    if (profitMarginRatio.GetValueOrDefault() > 0)
    {
        if ((dealerPrice * (1 + (profitMarginRatio / 100))) < discountPrice)
        {
            @Html.Raw("warning")
        }
    }

}
@helper GetDiscountTdTitle(decimal discountPrice, decimal? dealerPrice, decimal? profitMarginRatio)
{
    if (dealerPrice.GetValueOrDefault(0) > discountPrice)
    {
        @Html.Raw(MessageResource.WorkOrderWard_Message_DiscountLessThanDealerPrice)
        return;
    }
    if (profitMarginRatio.GetValueOrDefault() > 0)
    {
        if ((dealerPrice * (1 + (profitMarginRatio / 100))) < discountPrice)
        {
            @Html.Raw(MessageResource.WorkOrderWard_Message_DiscountLessThanProfitMargin)
        }
    }

}
@helper GetPriceToolTipHtml(ProposalDetailModel detail)
{
    <table>
        @if (detail.Type == "PART")
        {
            <tr>
                <th style="padding-right: 8px">@MessageResource.StockCard_Display_AvgDealerPrice </th>
                <td>: @detail.DealerPrice</td>
            </tr>
        }
        <tr>
            <th style="padding-right: 8px">@MessageResource.WorkOrderCard_Display_WarrantyPrice </th>
            <td>: @detail.WarrantyPrice</td>
        </tr>
    </table>
}
@helper GetLabourTdClass(sbyte id, bool isExternal)
{
    if (isExternal)
    {
        @Html.Raw(" success ")
        return;
    }

    if (id == -1 || id == 0)
    {
        @Html.Raw(" danger ")
        return;
    }
    else if (id == 4)
    {
        @Html.Raw(" success ")
        return;
    }
    else
    {
        @Html.Raw(" warning ")
    }
}

@helper GetLabourTdTitle(ProposalDetailModel detail)
{
    if (detail.LabourWorkStatusId != 4)
    {
        @Html.Raw(detail.LabourWorkStatus)
    }
    else
    {
        <table>
            <tr>
                <th style="padding-right: 8px">@MessageResource.LabourTechnician_Display_UserNameSurname </th>
                <td>: @detail.LabourTechnician</td>
            </tr>
            @if (detail.LabourStartDate != DateTime.MinValue)
            {
                <tr>
                    <th style="padding-right: 8px">@MessageResource.LabourTechnician_Display_StartDate </th>
                    <td>: @detail.LabourStartDate.ToString("dd/MM/yyyy HH:mm")</td>
                </tr>
                <tr>
                    <th style="padding-right: 8px">@MessageResource.LabourTechnician_Display_EndDate </th>
                    <td>
                        : @detail.LabourFinishDate.ToString("dd/MM/yyyy HH:mm")
                    </td>
                </tr>
            }
        </table>
    }
}
<span class="ajax-loading hide"></span>
