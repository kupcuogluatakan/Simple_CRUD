@using System.Globalization
@using ODMSCommon.Resources
@using ODMSCommon.Security
@using ODMSModel.ProposalCard
@using ODMSModel.WorkOrderCard
@using IndicatorType = ODMSModel.WorkOrderCard.IndicatorType;
@model ProposalCardModel
@{
    ViewBag.Title = MessageResource.ProposalCard_PageTitle_Index + " (" + Model.ProposalId + ")" + " - " + MessageResource.ProposalCard_Display_ProposalRevision + " (" + Model.ProposalSeq + ")";
    bool HasMaint = Model.DetailList.Any(c => c.IndicatorType == IndicatorType.PeriodicMaint || c.IndicatorType == IndicatorType.CouponMaint);
    var campaignCheckList = ViewBag.CampaignCheckList as List<CampaignCheckModel>;
    var campaignCheckMessage = string.Empty;
    ViewBag.IsVehicleLeft = Model.VehicleLeaveDate.HasValue;
    var customerCountryId = "";
}

<script src="~/Scripts/Tooltipster/jquery.tooltipster.min.js"></script>
<link href="~/Style/Tooltipster/tooltipster.css" rel="stylesheet" />
<link href="~/Style/Tooltipster/tooltipster-shadow.css" rel="stylesheet" />
<script src="~/Scripts/jQuery.print.js"></script>


<style type="text/css">
    #tblProposalDetails {
        border-spacing: 0px;
        margin: 0;
    }

        #tblProposalDetails thead.fixed {
            position: fixed;
            top: 0;
            background-color: #ffffff;
            z-index: 1000;
        }

    .seperator {
        border-bottom: 1px solid #cbcbcb;
        margin: 2px 0;
    }

    .table tbody tr.info > td {
        background-color: #D9EDF7;
        font-weight: bold;
    }

    button:focus {
        -moz-outline: 0 none !important;
        outline: 0 none !important;
    }

    a {
        cursor: default;
    }

    .fa-caret-right {
        margin-right: 4px;
    }

    .part-theme {
        background: white;
        border: 1px solid #c6c6c6;
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
        border-radius: 5px;
        color: #090909;
    }

        .part-theme .tooltipster-content {
            font-size: 12px;
            font-weight: 400;
            line-height: 14px;
            padding: 15px 18px;
        }

            .part-theme .tooltipster-content ul {
                margin: 0;
                padding: 0;
                list-style: none;
            }

                .part-theme .tooltipster-content ul li {
                    list-style: none;
                    padding: 0 0 5px;
                }

                    .part-theme .tooltipster-content ul li span.value {
                        padding-left: 10px;
                    }

    .k-widget.k-tooltip {
        background-color: white;
        color: #090909;
    }

    .tooltip-content {
        background-color: white;
        text-align: left;
        padding: 10px;
    }

        .tooltip-content .bold {
            padding-right: 12px;
        }

    .color-box-wrapper {
        display: inline-block;
        margin: 0 5px;
        text-align: center;
    }

    .color-box {
        border-radius: 15px;
        content: "";
        display: inline-block;
        height: 15px;
        width: 15px;
    }

    .menu {
        background-color: white;
    }
</style>


@if (!ViewBag.HideElements)
{
<div id="ProposalWrap" class="container" style="max-width: 100%;">
    @if (campaignCheckList != null && campaignCheckList.Count > 0)
    {
        <div class="panel panel-danger">
            <div class="panel-heading">
                @MessageResource.WorkOrderCard_Display_CriticalCampaignMessage
            </div>
            <div class="panel-body">
                <div class="well">
                    <strong>@MessageResource.ProposalCard_Display_MandatoryCampaignsMessage</strong>
                </div>
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>@MessageResource.Campaign_Display_CampaignCode</th>
                            <th>@MessageResource.Campaign_Display_CampaignName</th>
                            <th>@MessageResource.WorkOrderCard_Display_HasStock</th>
                            <th>@MessageResource.WorkOrderCard_Display_TotalLabourDuration</th>
                            <th>@MessageResource.Global_Display_Add</th>

                        </tr>
                    </thead>
                    @foreach (var item in campaignCheckList)
                    {
                        <tr>
                            <td>@item.CampaignCode</td>
                            <td>@item.Description</td>
                            <td>
                                @if (item.HasStock)
                                {
                                    <strong style="color: #5cb85c"><i class="glyphicon glyphicon-ok"></i></strong>
                                }
                                else
                                {
                                    <strong style="color: #d9534f"><i class="glyphicon glyphicon-remove"></i></strong>
                                }
                            </td>
                            <td>@item.TotalLabourDuration</td>
                            <td>
                                <a class="k-link" onclick="AddCampaign(this,'@item.CampaignCode')">
                                    <img src="@Url.Content("~/Images/add2.png")" />
                                </a>
                            </td>

                        </tr>
                    }
                </table>
            </div>
        </div>
        <div>
        </div>


    }



    <div class="panel-group" id="accordion" style="margin-bottom: 5px;">
        @if (Model.ApplicableFleetId.GetValueOrDefault(0) > 0)
        {
            @Html.Action("ApplicableFleet", new { id = Model.ApplicableFleetId })
        }
        <div class="panel panel-default ">
            <div class="panel-heading">
                <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseVehicle">
                    <strong style="font-size: 16px;">
                        @MessageResource.Appointment_Display_Vehicle
                    </strong>
                </a>
            </div>
            <div id="collapseVehicle" class="panel-body panel-collapse collapse" style="height: 0px">
                <table class="table table-bordered table-zipped">
                    <tbody>
                        <tr>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Appointment_Display_VehicleModel :</th>
                            <td class="col-md-3">@Model.Vehicle.VehicleModel</td>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Appointment_Display_VehicleType :</th>
                            <td class="col-md-3">@Model.Vehicle.VehicleType</td>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.VehicleCode_Display_Kod :</th>
                            <td class="col-md-3">@Model.Vehicle.VehicleCode</td>
                        </tr>
                        <tr>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_Plate:</th>
                            <td class="col-md-3 vtnr" style="border-top: 0 !important">
                                <span id="VehiclePlate">@Model.Vehicle.Plate </span>
                                <a id="btnUpDateVehiclePlate" class="k-link" onclick=" UpDateVehiclePlate(this) "><i class="glyphicon glyphicon-edit"></i></a>
                            </td>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_VinNo :</th>
                            <td class="col-md-3">@Model.Vehicle.VinNo</td>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_EngineNo :</th>
                            <td class="col-md-3">@Model.Vehicle.EngineNo</td>
                        </tr>
                        <tr>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_EngineType :</th>
                            <td class="col-md-3">
                                @Model.Vehicle.EngineType

                            </td>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyStartDate :</th>
                            <td class="col-md-3">
                                @if (Model.Vehicle.WarrantyStartDate != default(DateTime))
                                {
                                    @Model.Vehicle.WarrantyStartDate.GetValueOrDefault().ToString("dd/MM/yyyy").Replace(".", "/")
                                }
                                else
                                {
                                    @Html.Raw("-")
                                }
                            </td>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyEndDate :</th>
                            <td class="col-md-3">
                                @if (Model.Vehicle.WarrantyEndDate != default(DateTime))
                                {
                                    @Model.Vehicle.WarrantyEndDate.GetValueOrDefault().ToString("dd/MM/yyyy").Replace(".", "/")
                                }
                                else
                                {
                                    @Html.Raw("-")
                                }

                            </td>
                        </tr>
                        <tr>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_PaintWarrantyEndDate :</th>
                            <td class="col-md-3">
                                @if (Model.Vehicle.PaintWarrantyEndDate.HasValue && Model.Vehicle.PaintWarrantyEndDate != default(DateTime))
                                {
                                    @Model.Vehicle.PaintWarrantyEndDate.GetValueOrDefault().ToString("dd/MM/yyyy").Replace(".", "/")
                                }
                                else
                                {
                                    @Html.Raw("-")
                                }
                            </td>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_CorrosionWarrantyEndDate :</th>
                            <td class="col-md-3">
                                @if (Model.Vehicle.CorrosionWarrantyEndDate.HasValue && Model.Vehicle.CorrosionWarrantyEndDate != default(DateTime))
                                {
                                    @Model.Vehicle.CorrosionWarrantyEndDate.GetValueOrDefault().ToString("dd/MM/yyyy").Replace(".", "/")
                                }
                                else
                                {
                                    @Html.Raw("-")
                                }
                            </td>
                            @if (Model.Vehicle.IsHourMaint)
                            {
                                <td colspan="2" class="col-md-4 t-customhead" style="padding: 0 !important">
                                    <table class="col-md-12">
                                        <tr>
                                            <th class="col-md-3 teksatir t-customhead" style="border-top: 0 !important"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_VehicleKilometer :</th>
                                            <td class="col-md-3 vtnr" style="border-top: 0 !important">
                                                <span id="VehicleKM">@Model.Vehicle.VehicleKilometer </span>
                                                @if (!Model.VehicleLeaveDate.HasValue)
                                                {
                                                    <a id="btnUpDateVehicleKM" class="k-link" onclick=" UpDateVehicleKM(this) "><i class="glyphicon glyphicon-edit"></i></a>
                                                }
                                            </td>
                                            <th class="col-md-3 teksatir t-customhead" style="border-top: 0 !important; border-left: 1px solid rgba(204, 204, 204, 1);"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_Hour :</th>
                                            <td class="col-md-3 vtnr" style="border-top: 0 !important">
                                                <span id="VehicleHour">@Model.Vehicle.VehicleHour </span>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            }
                            else
                            {
                                <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_VehicleKilometer :</th>
                                <td class="col-md-3">
                                    <span id="VehicleKM">@Model.Vehicle.VehicleKilometer </span>
                                    @if (!Model.VehicleLeaveDate.HasValue)
                                    {
                                        <a id="btnUpDateVehicleKM" class="k-link" onclick=" UpDateVehicleKM(this) "><i class="glyphicon glyphicon-edit"></i></a>
                                    }
                                </td>
                            }
                        </tr>
                        <tr>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Vehicle_Display_WarrantyStatus :</th>
                            <td class="col-md-3">
                                @if (Model.Vehicle.WarrantyStartDate.HasValue)
                                {

                                    if (Model.Vehicle.WarrantyEndDate > Model.ProposalDate)
                                    {
                                        <text>@MessageResource.WorkOrderCard_Display_VehicleWarranty</text>
                                    }
                                    else
                                    {
                                        <text>@MessageResource.WorkOrderCard_Display_VehicleOutOfWarranty</text>
                                    }

                                }
                                else
                                {
                                    @Html.Raw("-")
                                }
                            </td>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.VehicleBodywork_Display_BodyworkName:</th>
                            <td id="VehicleLocation" class="col-md-7" colspan="4">
                                @Model.Vehicle.BodyWorkName
                                @if (Model.Vehicle.IsBodyWorkRequired)
                                {
                                    <a class="k-link" id="btnBodyWorkProcess" onclick="BodyWorkProcess(this)">
                                        <i class="glyphicon glyphicon-edit"></i>
                                    </a>
                                }

                            </td>
                        </tr>
                        <tr>
                            <th class="col-md-1 teksatir t-customhead" colspan="6">
                                <i class="fa fa-envelope-o" style="margin-bottom: 4px;"></i>
                                @MessageResource.WorkOrderCard_Display_VehicleContactInfo
                                <a class="k-link" onclick="OpenVehicleContactInfo(this)">
                                    <i class="glyphicon glyphicon-edit"></i>
                                </a>
                            </th>
                        </tr>
                        <tr>
                            <th class="col-md-1 teksatir t-customhead">
                                <i class="fa fa-caret-right"></i>
                                @MessageResource.WorkOrderCard_Display_VehicleLocation
                            </th>

                            <td id="VehicleLocation" class="col-md-3">@Model.Vehicle.Location</td>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_VehicleResponsible :</th>
                            <td id="VehicleResponsiblePerson" class="col-md-3">@Model.Vehicle.ResponsiblePerson</td>

                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_VehicleResponsiblePhone :</th>
                            <td id="VehicleResponsiblePersonPhone" class="col-md-3">@Model.Vehicle.ResponsiblePersonPhone</td>

                        </tr>


                    </tbody>
                </table>

            </div>
        </div>

        <div class="panel panel-default ">
            <div class="panel-heading">

                <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseCustomer">
                    <strong style="font-size: 16px;">
                        @MessageResource.Appointment_Display_Customer
                    </strong>
                </a>

            </div>
            <div class="panel-body panel-collapse collapse" id="collapseCustomer" style="height: 0px">

                <table class="table table-bordered table-zipped">
                    <tbody>
                        <tr>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.CustomerAddress_Display_CustomerName :</th>
                            <td class="col-md-3">@Model.Customer.CustomerName</td>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Customer_Display_TCIdentityNo :</th>
                            <td class="col-md-3">@Model.Customer.TcIdentityNo</td>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.User_Display_Address :</th>
                            <td class="col-md-3">@Model.Customer.CustomerAddress</td>
                        </tr>
                        <tr>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_ContactInfo :</th>
                            <td class="col-md-3"><span id="ContactInfo">@Model.ContactInfo</span> <a class="k-link" onclick="UpdateContactInfo(@Model.ProposalId,this)"><i class="glyphicon glyphicon-edit"></i></a></td>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Customer_Display_TaxOffice :</th>
                            <td class="col-md-3">@Model.Customer.TaxOffice</td>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Dealer_Display_TaxNo :</th>
                            <td class="col-md-3">@Model.Customer.TaxNo</td>
                        </tr>
                        <tr>
                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.Proposal_Display_ResponsibleConsultant :</th>
                            <td colspan="5" class="col-md-11">@Model.Customer.Staff </td>
                        </tr>

                    </tbody>
                </table>

            </div>
        </div>

    </div>

    @*Emre: 3 önceden iptal karşılığıymış ama şuan database'de 3 statusu yok. yine de bıraktım *@
    @if (Model.ProposalStatId != 3 && Model.ProposalStatId != 8)
    {
        <div class="panel panel-default">
            <div class="panel-heading">
                @if (!Model.VehicleLeaveDate.HasValue)
                {
                    <button class="btn btn-info" onclick=" AddProposalDetail(this) ">@MessageResource.WorkOrderCard_Display_AddDetail</button>

                    if (Model.HasCampaign && Model.Vehicle.IsCampaignApplicable)
                    {
                        <button class="btn btn-info" onclick=" AddCampaign(this) ">@MessageResource.WorkOrder_Display_HasCampaignMessage</button>
                    }
                    if (!HasMaint && Model.Vehicle.WarrantyEndDate.GetValueOrDefault() != default(DateTime))
                    {
                        <button class="btn btn-info" onclick=" AddMaintenance(0, this) ">
                            @MessageResource.WorkOrderCard_Display_AddMeintenance
                        </button>
                    }

                }
                <button class="btn btn-info" id="btnVehicleHistory" onclick="OpenVehicleHistory(this)">@MessageResource.WorkOrderCard_Display_VehicleHistory</button>
                @if (Model.ProposalStatId != 6 && Model.ProposalStatId != -1)
                {
                    <a class="btn btn-info" target="_blank" href="@Url.Action("ProposalRevision", new { id = Model.ProposalId, seq = Model.ProposalSeq })" id="btnPrintProposal">@MessageResource.ProposalCard_Display_ProposalRevision</a>}
                @* <a class="btn btn-info" href="@Url.Action("Print", new { id = Model.ProposalId, seq = Model.ProposalSeq })" id="btnPrintProposal">@MessageResource.ProposalCard_Display_Print</a>*@
                <a class="btn btn-info" onclick="Print()">@MessageResource.ProposalCard_Display_Print</a>


                @if (HasMaint)
                {
                    <button class="btn btn-info" onclick="OpenPeriodicMaintControlList(this)">@MessageResource.PeriodicMaintControlList_PageTitle_Index</button>
                }
                @if (!Model.VehicleLeaveDate.HasValue && Model.Vehicle.IsHourMaint)
                {
                    <button class="btn btn-info" id="btnAddHourMaint" onclick=" AddHourMaint(this) ">@MessageResource.WorkOrderCard_Display_AddHourMaint</button>
                }
                <button class="btn btn-info" onclick="OpenVehicleNotesProposal(this)">@MessageResource.WorkOrderCard_Display_VehicleNotes <span class="label label-danger">@Model.Vehicle.NoteCount</span></button>
                @*<a id="btnDisplayVehicleNotePopup" style="display:none;" class="k-link" onclick="DisplayVehicleNotePopup(this) "><i class="glyphicon glyphicon-edit"></i></a>*@
                <button class="btn btn-info" onclick="OpenDealerNotes(this)">@MessageResource.WorkOrderCard_Display_DealerNotes <span class="label label-danger">@Model.Vehicle.DealerNoteCount</span></button>
                <button class="btn btn-info" onclick="OpenDocuments(this)">@MessageResource.WorkOrderCard_Display_Documents <span class="label label-danger">@Model.DocumentCount</span></button>

                @*Yeni Teklif ya da Onay Bekleyen ise Göster*@
                @if (Model.ProposalStatId == -1 || Model.ProposalStatId == 1)
                {
                    if (ODMSHelpers.UserHasPermission(CommonValues.PermissionCodes.ProposalCard.ProposalCardCancel))
                    {
                        <button class="btn btn-danger pull-right" onclick="_CancelProposal(true,this);">
                            <i class="glyphicon glyphicon-ban-circle"></i>@MessageResource.Global_Display_Cancel
                        </button>
                    }
                    
                }

            </div>
        </div>
    }

    <div id="work-order-grid" class="panel panel-default">
        <div class="panel-heading">
            <strong style="font-size: 16px;">
                @String.Format(MessageResource.ProposalCard_Title_ProposalDetails, Model.ProposalId) [@Model.DealerName]

                <a class="btn" id="refresh-details-btn" onclick="RefreshDetails(this)"><i class="glyphicon glyphicon-refresh"></i></a><span class="ajax-loading hide"></span>

            </strong>

            <div style="display: inline-block" class="pull-right">
                @if (Model.ProposalStatManualChangeAllow)
                {
                    using (Html.BeginForm("SaveProposalStat", "Proposal_Card", FormMethod.Post))
                    {
                        @Html.HiddenFor(c => c.ProposalId)
                        @Html.HiddenFor(c => c.ProposalSeq)
                        @Html.Kendo().DropDownListFor(c => c.ProposalStatId).AutoBind(true).DataValueField("Value").DataTextField("Text").BindTo(ViewBag.ProposalStatsList as List<SelectListItem>).Enable(Model.ProposalStatManualChangeAllow).HtmlAttributes(new { style = "width:200px" })
                        <button class="k-button btn-primary">
                            <i class="glyphicon glyphicon-check"></i><b>@MessageResource.Global_Display_Save</b>
                        </button>
                    }
                }
                else
                {
                    @Html.Kendo().DropDownListFor(c => c.ProposalStatId).AutoBind(true).DataValueField("Value").DataTextField("Text").BindTo(ViewBag.ProposalStatsList as List<SelectListItem>).Enable(Model.ProposalStatManualChangeAllow).HtmlAttributes(new { style = "width:200px" })
                }
            </div>
            <div class="clearfix"></div>

        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-lg-7">
                    @if (Model.FleetId.HasValue)
                    {
                        <div class="alert alert-info">

                            <strong>
                                @Html.Raw(string.Format(MessageResource.WorkOrderCard_Display_FleetMessage, Model.Customer.CustomerName, Model.FleetName, Model.OtokarPartDiscountRate, Model.DealerPartDiscountRate, Model.OtokarLabourDiscountRate, Model.DealerLabourDiscountRate))
                            </strong>

                        </div>
                    }
                    <p>
                        <strong style="font-size: 14px;">@MessageResource.Proposal_Display_ProposalDate :</strong><em style="font-size: 13px; padding-left: 5px;">@Model.ProposalDate.ToString("dd MMMM yyyy HH:mm")</em> <span style="padding-left: 20px;">&nbsp;</span>
                        @if (Model.VehicleLeaveDate.HasValue)
                        {
                            <strong style="font-size: 14px;">@MessageResource.WorkOrderCard_Dislay_VehicleLeaveDate :</strong> <em style="font-size: 13px; padding-left: 5px;">@Model.VehicleLeaveDate.GetValueOrDefault().ToString("dd MMMM yyyy HH:mm") <span style="padding-left: 20px;"></span></em>
                        }
                    </p>
                    <p>
                        <strong style="font-size: 14px;">@MessageResource.Vehicle_Display_SpecialConditions : </strong><em style="font-size: 12px; padding-left: 5px;"><span style="">@Model.Vehicle.SpecialConditions</span></em> <span style="padding-left: 20px;">&nbsp;</span>

                    </p>
                    @if (UserManager.UserInfo.DealerID == 0)
                    {
                        <p>
                            <strong style="font-size: 14px;">@MessageResource.GRADGif_Display_Notes : </strong><em style="font-size: 12px; padding-left: 5px;"><span style="">@Model.Vehicle.Notes</span></em> <span style="padding-left: 20px;">&nbsp;</span>

                        </p>
                    }


                    <p>
                        <strong style="font-size: 14px;">@MessageResource.Appointment_Display_ComplaintDescription : </strong><em style="font-size: 12px; padding-left: 5px;"><span style="">@Model.CustomerNote</span></em> <span style="padding-left: 20px;">&nbsp;</span>

                    </p>


                </div>
                <div class="col-lg-4 text-right">
                    <table class="table table-condensed text-left table-bordered">
                        <tr>
                            <th style="padding-right: 8px;">
                                @MessageResource.WorkOrderCard_Display_AppointmentNo :
                            </th>
                            <td>
                                @(Model.AppointmentId > 0 ? Html.Raw(Model.AppointmentId) : Html.Raw("-"))
                            </td>
                        </tr>
                        <tr>
                            <th style="padding-right: 8px;">
                                @MessageResource.Appointment_Display_AppointmentDate :
                            </th>
                            <td>
                                @(Model.AppointmentDate.GetValueOrDefault() == new DateTime(1900, 1, 1, 0, 0, 0) ? Html.Raw("-") : Html.Raw(Model.AppointmentDate))
                            </td>
                        </tr>
                        <tr>
                            <th style="padding-right: 8px;">
                                @MessageResource.Appointment_Display_AppointmentType :
                            </th>
                            <td>
                                @Model.AppointmentType
                            </td>
                        </tr>
                        <tr>
                            <th style="padding-right: 8px;">
                                @MessageResource.Proposal_Display_ResponsibleConsultant :
                            </th>
                            <td>
                                @Model.Customer.Staff
                            </td>
                        </tr>
                    </table>
                    @*<div class="color-box-wrapper">
                            <div class="color-box alert-danger"></div>
                            <div class="bold">@MessageResource.WorkOrderCard_PartQuantityStatus_NotEnoughStock</div>
                        </div>
                        <div class="color-box-wrapper">
                            <div class="color-box alert-warning"></div>
                            <div class="bold">@MessageResource.WorkOrderCard_PartQuantityStatus_WaitingForPicking</div>
                        </div>
                        <div class="color-box-wrapper">
                            <div class="color-box alert-success"></div>
                            <div class="bold">@MessageResource.WorkOrderCard_PartQuantityStatus_Picked</div>
                        </div>*@
                </div>
            </div>
        </div>

        <div id="ProposalDetails">

            <table id="tblProposalDetails" class="table table-striped table-bordered" style="width: 100%; margin: 10px auto 0;">
                <thead>
                    <tr class="menu">
                        <th class="text-center">
                            @MessageResource.WorkOrderCard_Display_Indicator @MessageResource.Global_Display_Id / GIF NO
                        </th>
                        <th>@MessageResource.WorkOrderCard_Display_IndicatorStatus</th>
                        <th>@MessageResource.WorkOrderCard_Display_Part</th>
                        <th>@MessageResource.WorkOrderCard_Display_Labour</th>
                        <th>@MessageResource.WorkOrderCard_Display_TechnicalDescription</th>
                        @if (Model.Details.Any(c => c.IsCampaign))
                        {
                            <th>
                                @MessageResource.WorkOrderCard_Display_CampaingPartRequest
                            </th>
                        }
                        <th>@MessageResource.Global_Display_Cancel</th>
                        <th>@MessageResource.AppointmentIndicatorFailureCode_Display_Code</th>
                        <th>@MessageResource.WorkOrderCard_Display_Type</th>
                        <th>@MessageResource.WorkOrderCard_Display_PartLabourCode</th>
                        <th>@MessageResource.WorkOrderCard_Display_Description</th>
                        <th>@MessageResource.WorkOrderCard_Display_CountTime</th>
                        <th>@MessageResource.WorkOrderCard_Display_UnitPrice</th>
                        <th>@MessageResource.WorkOrderCard_Display_DiscountRatio</th>
                        <th>@MessageResource.WorkOrderCard_Display_TotalPrice</th>
                        @*<th>@MessageResource.WorkOrderCard_Display_WarrantyRatio</th>
                            <th>@MessageResource.GuaranteeRequestApprove_Display_WarrantyTotal</th>*@
                        @*<th class="teksatir" style="vertical-align: middle">*@

                        @*if (!Model.VehicleLeaveDate.HasValue && Model.Details.Any(c => c.ReservedQuantity > 0))
                            {
                                <a style="margin-left: 10px; color: #ff0000;" class="k-link picking blink_me" onclick="PickDetailParts(0, this) ">
                                    <i class="glyphicon glyphicon-plus-sign"></i>@MessageResource.WokrOrderCard_Display_Pick
                                </a>
                                <span class="ajax-loading hide"></span>
                            }*@
                        @*</th>*@
                    </tr>
                </thead>
                <tbody>
                    @if (!Model.VehicleLeaveDate.HasValue)
                    {
                        foreach (var item in Model.DetailList.Where(c => c.InvoiceId.HasValue == false && !c.WarrantyStatus.In(1, 4, 5)))
                        {
                            <tr class="@(item.IsCanceled ? Html.Raw("danger") : Html.Raw("info")) text-center">
                                <td>@item.ProposalDetailId / @item.GifNo </td>
                                <td style="width: 60px">
                                    @if (item.GosApprovalNeed)
                                    {
                                        @item.WarrantyStatusDesc
                                        if (item.WarrantyStatus.In(3, 6))
                                        {
                                            <a class="k-link bstooltip" title="@item.GuaranteeConfirmDesc">
                                                <i class="glyphicon glyphicon-info-sign"></i>
                                            </a>
                                        }
                                    }
                                    @if (item.InvoiceId.HasValue)
                                    {
                                        <span style="display: inline-block" class="bold text-success">@MessageResource.WorkOrderCard_Display_Invoiced</span>
                                    }
                                    else if (item.InvoiceId == null && item.IsBillable && item.InvoiceCancel && !Model.VehicleLeaveDate.HasValue)
                                    {
                                        <span style="display: inline-block" class="bold text-success">@MessageResource.WorkOrderCard_Not_Invoice</span>
                                    }
                                </td>
                                <!--Basılmamış etiketleri bas || Etiket bas-->
                                <td class="text-center">
                                    @if (item.IndicatorType == IndicatorType.BreakDown && !item.WarrantyStatus.In(4, 5))
                                    {
                                        <a class="k-link" onclick="AddPart(@item.ProposalDetailId, this); ">
                                            <img src="@Url.Content("~/Images/add2.png")" />
                                        </a>
                                    } &nbsp;
                                </td>
                                <td class="text-center">
                                    @if (item.IndicatorType == IndicatorType.BreakDown && !item.WarrantyStatus.In(4, 5))
                                    {
                                        <a class="k-link" onclick="AddLabour(@item.ProposalDetailId, @Model.Vehicle.VehicleId, this); ">
                                            <img src="@Url.Content("~/Images/add2.png")" />
                                        </a>
                                    } &nbsp;
                                </td>
                                <td class="text-center">

                                    <a class="k-link bstooltip" title="@item.TechicalDescription" onclick="AddTechnicalDetail(@item.ProposalDetailId, this); ">
                                        <img src="@Url.Content("~/Images/edit.png")" />
                                    </a>

                                </td>
                                @if (Model.Details.Any(c => c.IsCampaign))
                                {
                                    <td>
                                        @if (Model.Details.Any(c => c.IsCampaign && c.ProposalDetailId == item.ProposalDetailId && c.HasOtokarCampaignStock == false && c.CampaignRequestId == null))
                                        {
                                            <a class="k-link" onclick="CreateCampaignRequest(@item.ProposalDetailId, this) ">@MessageResource.CampaignRequest_PageTitle_Create</a>
                                            <span class="ajax-loading hide"></span>
                                        }
                                        else if (Model.Details.Any(c => c.IsCampaign && c.ProposalDetailId == item.ProposalDetailId && c.HasOtokarCampaignStock == false && c.CampaignRequestId != null))
                                        {
                                            <a class="k-link" onclick="OpenCampaignRequestDetails(@item.ProposalDetailId, @Model.Details.FirstOrDefault(c => c.IsCampaign && c.ProposalDetailId == item.ProposalDetailId).CampaignRequestId, this) ">
                                                <i class="glyphicon glyphicon-list"></i>
                                            </a>
                                        }

                                    </td>
                                }
                                <td class="text-center">

                                    @{
                                        var campaignRequestId = Model.Details.Any(c => c.IsCampaign && c.ProposalDetailId == item.ProposalDetailId && c.HasOtokarCampaignStock == false && c.CampaignRequestId != null) ?
                                            Model.Details.FirstOrDefault(c => c.IsCampaign && c.ProposalDetailId == item.ProposalDetailId).CampaignRequestId
                                            : 0;
                                    }
                                    @if (campaignRequestId == 0)
                                    {
                                        <a class="k-link" onclick="CancelProposalDetail(@item.ProposalDetailId, @(!((int)item.IndicatorType).In((int)IndicatorType.BreakDown, (int)IndicatorType.Campaign) ? Html.Raw("true") : Html.Raw("false")), this) ">
                                            @MessageResource.Global_Display_Cancel
                                        </a>
                                    }
                                    else
                                    {
                                        <a class="k-link" onclick="CancelProposalDetailWithCampaignRequest(@item.ProposalDetailId, @campaignRequestId, this) ">
                                            @MessageResource.Global_Display_Cancel
                                        </a>

                                    }
                                </td>
                                <td>
                                    <a class="bstooltip k-link" title="@item.FailureCodeDescription">@item.FailureCode</a>
                                    @if (item.AllowFailureCodeChange)
                                    {
                                        <span>&nbsp; - &nbsp;</span>

                                        <a class="k-link" onclick="UpdateFailureCode(@item.ProposalDetailId, '@item.FailureCode', this); "><i class="glyphicon glyphicon-edit"></i></a>
                                    }
                                </td>
                                <td>@item.ProcessType&nbsp; - &nbsp; </td>
                                <td>@item.Code</td>
                                <td>@item.Description</td>
                                <td>
                                    @*if (Model.Details.Any(c => c.ProposalDetailId == item.ProposalDetailId && (c.Type == "PART" && c.ReservedQuantity == 0)))
                                        {
                                            <a class="k-link" href="javascript:void(0);" onclick="ReservDetailParts(@item.ProposalDetailId, this); "><i style="padding-right: 6px;" class="glyphicon glyphicon-repeat"></i>Rezerv Et</a>
                                        }*@
                                </td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                @*<td class="text-center text-danger">*@
                                @*if (Model.VehicleLeaveDate.HasValue == false && item.GuarantyAuthorizationNeed && item.WarrantyStatus.In(0, 3) && Model.Details.Any(c => c.ProposalDetailId == item.ProposalDetailId && c.Type != "INDICATOR"))
                                    {
                                        <a class="k-link bstooltip" onclick=" SendToWarrantyPreAppoval(@item.ProposalDetailId, this); " title="@MessageResource.WorkOrderCard_Message_WarrantyPreAppoval">

                                            <span class="blink_me" style="color: red">@MessageResource.WorkOrderCard_Display_SendToPreWarranty</span>
                                        </a>
                                        <span class="ajax-loading hide"></span>
                                    }*@



                                @*</td>
                                    <td>&nbsp;</td>
                                    <td class="teksatir">*@
                                @*<a class="k-link picking" onclick="PickDetailParts(@item.ProposalDetailId, this) ">
                                        <i class="glyphicon glyphicon-plus-sign"></i>@MessageResource.WokrOrderCard_Display_Pick
                                    </a>
                                    <span class="ajax-loading hide"></span>
                                    &nbsp;-&nbsp;
                                    <a class="k-link picking" onclick="ReturnParts(@item.ProposalDetailId, this) ">
                                        <i class="glyphicon glyphicon-hand-left"></i>@MessageResource.Global_Display_Return
                                    </a>
                                    <span class="ajax-loading hide"></span>*@
                                @*</td>*@

                            </tr>
                            foreach (var detail in Model.Details.Where(c => c.ProposalDetailId == item.ProposalDetailId && c.Type != "INDICATOR"))
                            {
                                <tr>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td class="text-center">
                                        @*@if (detail.Type == "PART")
                                            {
                                                <a class="k-link bstooltip" title="@MessageResource.WorkOrderCard_Display_DismentledPart" onclick="OpenPartRemovalWindow(@item.ProposalDetailId, @detail.Id, this); "><i class="glyphicon glyphicon-edit"></i></a>
                                            }*@

                                    </td>



                                    <td class="text-center">&nbsp;</td>

                                    <td class="text-center">&nbsp;</td>
                                    @if (Model.Details.Any(c => c.IsCampaign))
                                    {
                                        <td>&nbsp;</td>
                                    }
                                    <td>
                                        @if (!detail.IsCampaign && detail.MaintenanceId == 0 && item.IndicatorType != IndicatorType.Pdi)
                                        {
                                            <a class="k-link" title="@MessageResource.Global_Display_Delete" onclick="DeleteItem(@item.ProposalDetailId, @detail.Id, '@detail.Type', this); "><i class="glyphicon glyphicon-trash"></i></a>
                                        }
                                        else if (detail.MaintenanceId > 0 && !detail.IsMust)
                                        {
                                            <a class="k-link" title="@MessageResource.Global_Display_Delete" onclick="RemoveMaintItem(@detail.MaintenanceId,@item.ProposalDetailId, @detail.Id, '@detail.Type', this); "><i class="glyphicon glyphicon-trash"></i></a>
                                        }
                                    </td>

                                    <td>&nbsp;</td>
                                    <td>
                                        @(detail.Type == "LABOUR" ? detail.IsExternalLabour ? MessageResource.WorkOrderCard_Display_ExternalLabour : MessageResource.WorkOrderCard_Display_Labour : MessageResource.WorkOrderCard_Display_Part)
                                    </td>
                                    <td class="@Html.Raw(detail.Type == "LABOUR" ? "labourCode" : "partCode")">@detail.Code</td>
                                    <td>
                                        @if (detail.Type == "PART")
                                        {
                                            @detail.Name
                                            <a class="k-link bstooltip" title="@detail.StockType">
                                                <i class="glyphicon glyphicon-info-sign"></i>
                                            </a>
                                        }
                                        else
                                        {
                                            @detail.Name
                                        }

                                    </td>
                                    <td class="@(detail.Type == "PART" ? GetPartTdClass(detail.RequiredQuantity, detail.ReservedQuantity, detail.PickedQuantity, detail.ReturnedQuantity) : @Html.Raw(""))">
                                        @if (detail.Type == "PART")
                                        {
                                            @detail.RequiredQuantity
                                        }
                                        else
                                        {
                                            <span>@Convert.ToInt32(detail.Quantity) / @detail.Duration</span>
                                        }
                                        @if (!detail.IsCampaign && item.IndicatorType != IndicatorType.Pdi)
                                        {
                                            if (item.DetailType != DetailType.Meintenance)
                                            {
                                                @Html.Raw("&nbsp; - &nbsp;")
                                                <a class="k-link" onclick="AddDetailQuantity(@detail.ProposalDetailId, @detail.Id, '@detail.Type', this); ">@MessageResource.Global_Display_Add</a>
                                            }
                                            else
                                            {
                                                @Html.Raw("&nbsp; - &nbsp;")
                                                <a class="k-link" onclick="EditMaintenanceQuantity(@detail.ProposalDetailId, @detail.Id, '@detail.Type', @detail.MaintenanceId, this); "><i class="glyphicon glyphicon-edit"></i></a>
                                            }
                                        }

                                        @if (detail.Type == "PART")
                                        {
                                            <a class="part-tooltip" title="@(GetPartToolTipHtml(detail.RequiredQuantity, detail.ReservedQuantity, detail.PickedQuantity, detail.ReturnedQuantity))">
                                                <i class="glyphicon glyphicon-info-sign"></i>
                                            </a>
                                        }

                                    </td>
                                    <td>
                                        @detail.Price.RoundUp(2)
                                        @if (!detail.IsCampaign)
                                        {
                                            @Html.Raw("&nbsp; - &nbsp;")
                                            <a class="k-link" onclick="ChangePriceList(@detail.ProposalDetailId, @detail.Id, '@detail.Type', this); "><i class="glyphicon glyphicon-edit"></i></a>
                                            if (detail.Type == "LABOUR" && item.ProcessTypeCode == "PT_M")
                                            {
                                                <a class="k-link" onclick="AddLabourPrice(@detail.ProposalDetailId, @detail.Id, '@detail.Type', this); "><i class="glyphicon glyphicon-plus-sign"></i></a>
                                            }
                                        }
                                        <a class="part-tooltip" title="@(GetPriceToolTipHtml(detail))">
                                            <i class="glyphicon glyphicon-info-sign"></i>
                                        </a>
                                    </td>
                                    @if (detail.Type == "PART" && !detail.IsCampaign)
                                    {
                                        <td title="@GetDiscountTdTitle(detail.DiscountPrice, detail.DealerPrice, detail.ProfitMarginRatio)" class="@GetDiscountTdClass(detail.DiscountPrice, detail.DealerPrice, detail.ProfitMarginRatio) bstooltip">
                                            @detail.DiscountRatio
                                            @if (!detail.IsCampaign && detail.WarrantyRatio.GetValueOrDefault(0) == 0)
                                            {
                                                @Html.Raw("&nbsp; - &nbsp;")
                                                <a class="k-link" onclick="AddDetailDiscount(@detail.ProposalDetailId, @detail.Id, '@detail.Type', this); ">@MessageResource.Global_Display_Add</a>
                                            }
                                        </td>
                                    }
                                    else
                                    {
                                        <td>
                                            @detail.DiscountRatio
                                            @if (!detail.IsCampaign && detail.WarrantyRatio.GetValueOrDefault(0) == 0)
                                            {
                                                @Html.Raw("&nbsp; - &nbsp;")
                                                <a class="k-link" onclick="AddDetailDiscount(@detail.ProposalDetailId, @detail.Id, '@detail.Type', this); ">@MessageResource.Global_Display_Add</a>
                                            }
                                        </td>
                                    }
                                    <td>@detail.TotalPrice.RoundUp(2)</td>


                                </tr>
                            }
                        }
                    }
                    @Html.Partial("_ProposalInvoicedDetails", Model)


                </tbody>

            </table>





            <div class="panel-footer">
                <div class="panel panel-default ">
                    <div class="panel-heading">
                        <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseCustomerTotal">


                            <strong style="font-size: 16px;">
                                @MessageResource.WorkOrderCard_Display_TotalCustomer
                            </strong>
                        </a>

                    </div>
                    <div class="panel-body panel-collapse collapse" id="collapseCustomerTotal" style="height: 0px">



                        <table class="table table-bordered table-zipped">
                            <tbody>
                                <tr>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalPartPrice : </th>
                                    <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalCustomerPrice : 0).RoundUp(2)</td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalLabourPrice :</th>
                                    <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalCustomerPrice : 0).RoundUp(2)</td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_CustomerTotalPrice :</th>
                                    <td class="col-md-2">@Model.Details.Sum(c => c.TotalCustomerPrice).RoundUp(2)</td>
                                </tr>
                                <tr>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_DiscountPartPrice :</th>
                                    <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalDiscount : 0).RoundUp(2)</td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_DiscountLabourPrice :</th>
                                    <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalDiscount : 0).RoundUp(2) </td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_DiscountTotalPrice :</th>
                                    <td class="col-md-2" colspan="3">@Model.Details.Sum(c => c.TotalDiscount).RoundUp(2)</td>
                                </tr>
                                <tr>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Discounted_Total_SparePart_Price</th>
                                    <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? (c.TotalPrice) : 0).RoundUp(2)</td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Discounted_Total_Labour_Price :</th>
                                    <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? (c.TotalPrice) : 0).RoundUp(2)</td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Discounted_Total_Customer_Price :</th>
                                    <td class="col-md-2" colspan="3">@Model.Details.Sum(c => c.TotalPrice).RoundUp(2)</td>
                                </tr>

                            </tbody>
                        </table>

                    </div>
                </div>

                <div class="panel panel-default ">
                    <div class="panel-heading">
                        <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseWarrantyTotal">


                            <strong style="font-size: 16px;">
                                @MessageResource.WorkOrderCard_Display_TotalWarranty
                            </strong>
                        </a>

                    </div>
                    <div class="panel-body panel-collapse collapse" id="collapseWarrantyTotal" style="height: 0px">

                        <table class="table table-bordered table-zipped">
                            <tbody>
                                <tr>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalPartPrice :  </th>
                                    <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalWarrantyPriceWithoutDeduction : 0).RoundUp(2)</td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalLabourPrice : </th>
                                    <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalWarrantyPriceWithoutDeduction : 0).RoundUp(2)</td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyTotalPrice :</th>
                                    <td class="col-md-2">@Model.Details.Sum(c => c.TotalWarrantyPriceWithoutDeduction).RoundUp(2)</td>
                                </tr>
                                <tr>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Deduction_Total_SparePart_Price :  </th>
                                    <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalWarrantyDeductionPrice : 0).RoundUp(2)</td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Deduction_Total_Labour_Price :  </th>
                                    <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalWarrantyDeductionPrice : 0).RoundUp(2)</td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Deduction_Total_Guarantee_Price :</th>
                                    <td class="col-md-2 ">@Model.Details.Sum(c => c.TotalWarrantyDeductionPrice).RoundUp(2)</td>

                                </tr>
                                <tr>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyPartGeneralPrice :  </th>
                                    <td class="col-md-2">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalWarrantyPrice : 0).RoundUp(2)</td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyLabourGeneralPrice :  </th>
                                    <td class="col-md-2">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalWarrantyPrice : 0).RoundUp(2)</td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WarrantyGeneralPrice :</th>
                                    <td class="col-md-2 ">@Model.Details.Sum(c => c.TotalWarrantyPrice).RoundUp(2)</td>

                                </tr>
                            </tbody>
                        </table>

                    </div>
                </div>

                <div class="panel panel-default ">
                    <div class="panel-heading">
                        <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseWOTotal">
                            <strong style="font-size: 16px;">
                                @MessageResource.WorkOrderCard_Display_WOTotal
                            </strong>
                        </a>
                    </div>
                    <div class="panel-body panel-collapse collapse" id="collapseWOTotal" style="height: 0px">

                        <table class="table table-bordered table-zipped">
                            <tbody>
                                <tr>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> @MessageResource.WorkOrderCard_Display_TotalPart : </th>
                                    <td class="col-md-3">@Model.Details.Where(c => c.Type == "PART").Sum(c => c.RequiredQuantity) </td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_TotalLabour :</th>
                                    <td class="col-md-7" colspan="3">@Model.Details.Where(c => c.Type == "LABOUR").Count()</td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_Deduction_And_Discount_Before_Price : </th>
                                    <td class="col-md-7" colspan="3">@Model.Details.Sum(c => (c.TotalCustomerPrice + c.TotalWarrantyPriceWithoutDeduction)).RoundUp(2)</td>
                                </tr>
                                <tr>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> @MessageResource.PDIInvoiceList_Display_TotalPartPrice : </th>
                                    <th class="col-md-3">@Model.Details.Sum(c => c.Type == "PART" ? c.TotalPrice + c.TotalWarrantyPrice : 0).RoundUp(2)</th>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.PDIInvoiceList_Display_TotalLabourPrice : </th>
                                    <td class="col-md-3" colspan="3">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.TotalPrice + c.TotalWarrantyPrice : 0).RoundUp(2)</td>
                                    <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i>@MessageResource.WorkOrderCard_Display_WOTotal : </th>
                                    <td class="col-md-3" colspan="3">@Model.Details.Sum(c => c.TotalPrice + c.TotalWarrantyPrice).RoundUp(2)</td>
                                </tr>
                            </tbody>
                        </table>

                    </div>
                </div>
                <div class="panel panel-default ">
                    <div class="panel-heading">
                        <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseTechnicianDesc">
                            <strong style="font-size: 16px;">
                                @MessageResource.Proposal_Card_Tab_Title_Technician_Description
                            </strong>
                        </a>
                    </div>
                    <div class="panel-body panel-collapse collapse" id="collapseTechnicianDesc" style="height: 0px">
                        @using (Html.BeginForm("SaveTechnicianInfo", "Proposal_Card", FormMethod.Post))

                        {@Html.HiddenFor(x => x.ProposalId)
                        @Html.HiddenFor(x => x.ProposalSeq)
                        <div class="row clearfix">
                            <div class="col-md-11 column">
                                <table class="table table-bordered table-hover" id="tab_logic">
                                    <thead>
                                        <tr>
                                            <th class="text-center">
                                                Madde No
                                            </th>
                                            <th class="text-center">
                                                Madde Açıklaması
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @{
                                            var count = Model.TechnicialDescList.Length;
                                        }

                                        @for (int i = 0; i < Model.TechnicialDescList.Length; i++)
                                        {
                                            <tr id="@string.Format("{0}{1}","addr",i)">
                                                <td>@string.Format("{0}", i + 1)</td>
                                                <td>
                                                    <input name="TechnicalDesc[@i]" type='text' placeholder="@string.Format("{0}",i+1). Madde Açıklaması" style="width:98%;" class="form-control input-md" value="@Model.TechnicialDescList[i]" required />
                                                </td>
                                            </tr>
                                        }
                                        @if (count == 0)
                                        {
                                            <input name="TechnicalDesc[0]" type='text' placeholder="1. Madde Açıklaması" style="width:98%;" class="form-control input-md" value="" required />}

                                        <tr id="@string.Format("{0}{1}","addr",count)"></tr>
                                    </tbody>

                                </table>
                            </div>
                        </div>
                        <div class="" id="warning" style="display:none">
                            <strong style="font-size: 16px;">
                                <i>Teknik açıklamalar için en fazla 10 kayıt girebilirsiniz.</i>
                            </strong><br /><br />
                        </div>
                        <a id="add_row" class="btn btn-default pull-left">@MessageResource.Add_Item</a>
                        <a id='delete_row' class="pull-left btn btn-default" style="margin-left:10px;">@MessageResource.Delete_Item</a>
                        <script>
                                    $(document).ready(function(){
                                        var i=@count;
                                        if (i >= 10) {
                                            $("#add_row").hide();
                                            $("#warning").show();
                                        }
                                        $("#add_row").click(function(){
                                            $('#addr'+i).html("<td>"+(i+1)+"</td><td><input name='TechnicalDesc["+i+"]' id='TechnicalDesc' type='text' placeholder='"+(i+1)+". Madde Açıklaması' style='width:98%;' class='form-control input-md' required /> </td>");
                                            $('#tab_logic').append('<tr id="addr'+(i+1)+'"></tr>');
                                            i++;
                                            if (i == 10) {
                                                $("#add_row").hide();
                                                $("#warning").show();
                                            }

                                        });

                                        $("#delete_row").click(function(){
                                            if(i>=1){
                                                $("#addr"+(i-1)).html('');
                                                i--;
                                                if(i<10){
                                                    $("#add_row").show();
                                                    $("#warning").hide();
                                                }
                                            }
                                        });

                                    });
                        </script>



                        <button type="submit" class="btn btn-info" style="margin-top:10px;float:right;">@MessageResource.ClaimDismantledParts_Display_Save</button>





                    }
                    </div>
                </div>

                <div class="panel panel-default ">
                    <div class="panel-heading">
                        <a class="k-link" data-toggle="collapse" data-parent="#accordion" data-target="#collapseGeneralDesc">


                            <strong style="font-size: 16px;">
                                @MessageResource.Proposal_Card_Tab_Title_General_Description
                            </strong>
                        </a>

                    </div>
                    <div class="panel-body panel-collapse collapse" id="collapseGeneralDesc" style="height: 0px">
                        @using (Html.BeginForm("SaveGeneralInfos", "Proposal_Card", FormMethod.Post))

                        {
                            @Html.HiddenFor(x => x.ProposalId)
                            @Html.HiddenFor(x => x.ProposalSeq)
                            <table class="table table-bordered table-zipped">

                                <tbody>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> 1: </th>
                                        <td class="col-md-3">
                                            @("Verilen teklifin geçerlilik süresi Teklif Veriliş Tarihinden itibaren")

                                            @Html.TextBoxFor(x => x.Matter1, htmlAttributes: new { @style = "text-decoration:underline;width:70px;" }) @("gün geçerlidir.")
                                        </td>

                                    </tr>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> 2: </th>
                                        <td class="col-md-3">@("Teklifte bildirilen Parça ve Onarım Hizmeti Onay Tarihinden itibaren") @Html.TextBoxFor(x => x.Matter2, htmlAttributes: new { @style = "text-decoration:underline;width:70px;" }) @("gün içinde teslim edilir / tamamlanır.")</td>
                                    </tr>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> 3: </th>
                                        <td class="col-md-3">@("Teklifte bildirilen Parça ve Onarım Hizmeti dışında doğacak Parçaların teslimi, Onarım Hizmeti ve ek Taleplerin tamamlanması 2. maddede verilen süreye ilave edilir. Müşteri onayına istinaden işlem yapılır.")</td>
                                    </tr>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> 4: </th>
                                        <td class="col-md-3">@("Teklifte yer alan parça ve işçiliklerdeki değişiklik müşteri onayına istinaden yapılır.")</td>
                                        @*<td class="col-md-3">@("Verilen Teklifte işin nevine göre teklif tutarında (+/-) %") @Html.TextBoxFor(x => x.Matter3, htmlAttributes: new { @style = "text-decoration:underline;width:70px;" })@("oranında doğacak değişikleri müşteri kabul eder ve değişen tutar üzerinden fatura düzenlenmek suretiyle ödeme alınır.  Belirtilen oranın üzerinde doğan maliyetler için müşteri onayına istinaden işlem yapılır.")</td>*@
                                    </tr>
                                    <tr>
                                        <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> 5: </th>
                                        <td class="col-md-3">@("Verilen Teklifin müşteri tarafından yaptırılmaması durumunda Teklif hazırlama ve Ekspertiz ücreti müşteriye faturalandırılır.")</td>
                                    </tr>
                                    @*Gürdal Beyin isteğiyle kaldırıldı. Teklif Dökümanı 2 Şubat*@
                                    @*<tr>
                                            <th class="col-md-1 teksatir t-customhead"><i class="fa fa-caret-right"></i> 6: </th>
                                            <td class="col-md-3">@("Konu Teklif dokümanının onaylanması durumunda doğacak damga vergisi ")@Html.DropDownListFor(x => x.Matter4, Model.TypeList) <text id="type1">tarafından / <s>taraflarca</s></text><text id="type2" style="display:none"><s>tarafından</s> / taraflarca</text> @("ödenecektir.")</td>
                                        </tr>*@
                                </tbody>

                            </table><br /><br />
                            <div id="divWitholding">
                                <div class="labelDiv">@Html.LabelFor(v => v.WitholdingStatusName)</div>
                                <div class="shortTxtDiv">@Html.Kendo().ComboBoxFor(v => v.WitholdingStatus).DataTextField("Text").DataValueField("Value").BindTo(ViewBag.YesNoList as List<SelectListItem>).Placeholder(CommonUtility.GetResourceValue("Global_Display_Choose")).Events(e => e.Change("function(e){ShowHideWitholding(e);}")) @Html.ValidationMessageFor(v => v.WitholdingStatus)</div>
                            </div>
                            <script>
                                    customerCountryId=@Model.Customer.CountryId;
                            </script>
                            <div id="divWitholdingStatus">
                                <div class="labelDiv">@Html.LabelFor(v => v.WitholdingId)</div>
                                <div class="shortTxtDiv">@Html.Kendo().ComboBoxFor(v => v.WitholdingId).CascadeFrom("customerCountryId").AutoBind(true).DataTextField("Text").DataValueField("Value").DataSource(d => d.Read(r => r.Type(HttpVerbs.Post).Action("ListWitholding", "Customer").Data("GetCountryId")).ServerFiltering(true)).Placeholder(CommonUtility.GetResourceValue("Global_Display_Choose")) @Html.ValidationMessageFor(v => v.WitholdingId)</div>
                            </div>
                            <button type="submit" class="btn btn-info" style="margin-top:10px;float:right;">@MessageResource.ClaimDismantledParts_Display_Save</button>

                        }

                    </div>
                </div>

                @*<div class="row">
                        <div class="col-md-4">
                            <div class="col-sm-4 bold" style="width: 9%">@MessageResource.WorkOrderCard_Display_TotalPart : </div>
                            <div class="col-sm-8" style="width: 9%">@Model.Details.Count(c => c.Type == "PART")</div>
                        </div>
                        <div class="col-md-4">
                            <div class="col-sm-4 bold" style="width: 9%">@MessageResource.WorkOrderCard_Display_TotalLabour :</div>
                            <div class="col-sm-8" style="width: 9%">@Model.Details.Count(c => c.Type == "LABOUR")</div>
                        </div>


                    </div>
                    <div class="clearfix"></div>
                    <div class="row">

                        <div class="col-sm-2 bold" style="width: 9%">@MessageResource.WorkOrderCard_Display_TotalPartPrice :</div>
                        <div class="col-sm-1" style="width: 9%">

                            @Model.Details.Sum(c => c.Type == "PART" && Model.DetailList.Any(k=> c.WorkOrderDetailId == k.WorkOrderDetailId  && k.ProcessTypeCode=="PT_M") ? c.Price*c.RequiredQuantity*((100 - c.DiscountRatio)/100) : 0).RoundUp(2)
                        </div>
                        <div class="col-sm-2 bold" style="width: 9%">@MessageResource.WorkOrderCard_Display_TotalLabourPrice :</div>
                        <div class="col-sm-1" style="width: 9%">@Model.Details.Sum(c => c.Type == "LABOUR" && Model.DetailList.Any(k => c.WorkOrderDetailId == k.WorkOrderDetailId && k.ProcessTypeCode == "PT_M") ? c.Price*c.Quantity*(c.Duration/100)*((100 - c.DiscountRatio)/100) : 0).RoundUp(2)</div>
                        <div class="col-sm-2 bold" style="width: 9%">@MessageResource.WorkOrderCard_Display_NondiscountedPrice :</div>
                        <div class="col-sm-1" style="width: 9%">@Model.Details.Sum(c => c.Type == "LABOUR" ? c.Price*c.Quantity*(c.Duration/100) : (c.Type == "PART" ? c.Price*c.RequiredQuantity : 0)).RoundUp(2)</div>

                        <div class="clearfix"></div>
                    </div>
                    <div class="clearfix"></div>*@
            </div>
        </div>


    </div>

</div>



    @*PopUp Windows*@


    <div id="CampaignRequestDetailsWindow"></div>

    @(Html.Kendo().Window()
.Name("CancelProposalWindow")
.Modal(true).Width(500).Height(200)
.Visible(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#CancelProposalWindow').html(''); }"))  /*RefreshDetails();*/
                                                                          //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1}]", MessageResource.Global_Display_Warning, MessageResource.Global_Display_Cancel)))

  



                                        @(Html.Kendo().Window()
.Name("VehicleKMWindow")
.Modal(true).Width(400).Height(200)
.Visible(false)
.Events(evt => evt.Close(@"function(e){ if ('" + Html.Raw(Model.Vehicle.IsBodyWorkRequired.ToString()) + "' == 'True' && '" + String.IsNullOrEmpty(Model.Vehicle.BodyWorkName).ToString() + "' == 'True') {"
                  + "  DisableClicks();"
                  + "  $('#btnBodyWorkProcess').removeClass('disabled');"
                   + " var obj2 = document.getElementById('btnBodyWorkProcess');"
                   + "BodyWorkProcess(obj2);"
                + "}  else if(parseInt($('#VehicleKM').text())>0) {"
                   + " EnableClicks(); "
                + "} }"))
//.Animation(a=>a.Open(effect=>effect.SlideIn(SlideDirection.Right)).Close(effect=>effect.Fade(FadeDirection.Out)))
.Title(string.Format("{0} [{1}]", MessageResource.Vehicle_Display_VehicleKilometer, MessageResource.Global_Display_Update)))
                                                @(Html.Kendo().Window()
      .Name("ContactInfoWindow")
      .Modal(true).Width(800).Height(340)
      .Events(evt => evt.Close("function(e){$('#ContactInfoWindow').html('');}"))
      .Visible(false)
      .Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_PageTitle_Index, MessageResource.WorkOrderCard_Display_ContactInfo)))


                                        @(Html.Kendo().Window()
.Name("VehiclePlateWindow")
.Modal(true).Width(400).Height(200)
.Visible(false)
.Events(evt => evt.Close(@"function(e){ if ('" + Html.Raw(Model.Vehicle.IsBodyWorkRequired.ToString()) + "' == 'True' && '" + String.IsNullOrEmpty(Model.Vehicle.BodyWorkName).ToString() + "' == 'True') {"
                  + "  DisableClicks();"
                  + "  $('#btnBodyWorkProcess').removeClass('disabled');"
                   + " var obj2 = document.getElementById('btnBodyWorkProcess');"
                   + "BodyWorkProcess(obj2);"
                + "}  else if(parseInt($('#VehiclePlate').text())>0) {"
                   + " EnableClicks(); "
                + "} }"))
//.Animation(a=>a.Open(effect=>effect.SlideIn(SlideDirection.Right)).Close(effect=>effect.Fade(FadeDirection.Out)))
.Title(string.Format("{0} [{1}]", MessageResource.Vehicle_Display_VehiclePlate, MessageResource.Global_Display_Update)))


                                        @(Html.Kendo().Window()
.Name("ContactInfoWindow")
.Modal(true).Width(800).Height(340)
.Events(evt => evt.Close("function(e){$('#ContactInfoWindow').html('');}"))
.Visible(false)
.Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_PageTitle_Index, MessageResource.WorkOrderCard_Display_ContactInfo)))






                                        @(Html.Kendo().Window()
.Name("AddProposalDetailWindow")
.Modal(true).Width(600).Height(380)
.Visible(false)
.Iframe(true)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
          .Events(evt => evt.Close("function(e){ $('#AddProposalDetailWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
          //.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
          .Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_AddDetail)))

@(Html.Kendo().Window()
.Name("AddProposalLabourWindow")
.Modal(true).Width(950).Height(350)
.Visible(false)
.Iframe(true)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#AddProposalLabourWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1} {2}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_Labour, MessageResource.Global_Display_Add)))

@(Html.Kendo().Window()
.Name("AddProposalPartWindow")
.Modal(true).Width(650).Height(300)
.Visible(false)
.Iframe(true)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#AddProposalPartWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1} {2}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_Part, MessageResource.Global_Display_Add)))
@(Html.Kendo().Window()
.Name("AddProposalMaintWindow")
.Modal(true).Width(500).Height(200)
.Visible(false)
.Iframe(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){window.location.reload();}"))
// .Events(evt => evt.Close("function(e){ $('#AddProposalMaintWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1} {2}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_PeriodicMeintenance, MessageResource.Global_Display_Add)))
@(Html.Kendo().Window()
.Name("CancelProposalDetailWindow")
.Modal(true).Width(500).Height(200)
.Visible(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#CancelProposalDetailWindow').html(''); RefreshDetails(); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.Global_Display_Cancel)))
@(Html.Kendo().Window()
.Name("AddDetailDiscountWindow")
.Modal(true).Width(500).Height(350)
.Visible(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#AddDetailDiscountWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1} {2}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_Discount, MessageResource.Global_Display_Add)))
@(Html.Kendo().Window()
.Name("AddDetailQuantityWindow")
.Modal(true).Width(500).Height(250)
.Visible(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#AddDetailQuantityWindow').html(''); RefreshDetails(); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1} {2}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_CountTime, MessageResource.Global_Display_Add)))
@(Html.Kendo().Window()
.Name("EditMeintenanceQuantityWindow")
.Modal(true).Width(500).Height(300)
.Visible(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#EditMeintenanceQuantityWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1} {2}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_PeriodicMeintenance, MessageResource.Global_Display_Edit)))
@(Html.Kendo().Window()
.Name("AddCampaignWindow")
.Modal(true).Width(800).Height(550)
.Visible(false)
.Iframe(true)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#AddCampaignWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_AddCampaign)))

@(Html.Kendo().Window()
.Name("VehicleNotesWindow")
.Modal(true).Width(820).Height(350)
.Visible(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){location.reload();}"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0}", MessageResource.WorkOrderCard_Display_VehicleNotes)))
@(Html.Kendo().Window()
.Name("DealerNotesWindow")
.Modal(true).Width(820).Height(350)
.Visible(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){location.reload();}"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0}", MessageResource.WorkOrderCard_Display_DealerNotes)))

@(Html.Kendo().Window()
.Name("DocumentsWindow")
.Modal(true).Width(1200).Height(410)
.Visible(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#DocumentsWindow').html(''); $('.ajax-loading').addClass('hide');location.reload(); }").Open("function(e){ $('.ajax-loading').addClass('hide'); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_PageTitle_Index, MessageResource.WorkOrderCard_Display_Documents)))

@(Html.Kendo().Window()
.Name("WarrantyWindow")
.Modal(true).Width(800).Height(350)
.Visible(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#WarrantyWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_PageTitle_Index, MessageResource.WorkOrderCard_Display_SendToWarranty)))

@(Html.Kendo().Window()
.Name("ChangePriceListWindow")
.Modal(true).Width(500).Height(350)
.Visible(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#ChangePriceListWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_ChangePriceList)))
@(Html.Kendo().Window()
.Name("ReservDetailPartsWindow")
.Modal(true).Width(500).Height(350)
.Visible(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#ReservDetailPartsWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_ReservParts)))

@(Html.Kendo().Window()
.Name("ReturnPartsWindow")
.Modal(true).Width(800).Height(450)
.Visible(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#ReturnPartsWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Title_ReturnParts)))

@(Html.Kendo().Window()
.Name("TechnicalDescriptionWindow")
.Modal(true).Width(600).Height(380)
.Events(evt => evt.Close("function(e){$('#TechnicalDescriptionWindow').html('');}"))
.Visible(false)
.Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.WorkOrderCard_Display_TechnicalDescription)))

@(Html.Kendo().Window()
.Name("InvoiceWindow")
.Iframe(true)
.Modal(true).Width(1200).Height(580)
.Events(evt => evt.Close("function(e){$('#InvoiceWindow').html(''); window.location.reload();}"))
.Visible(false)
.Title(string.Format("{0} [{1}]", MessageResource.WorkOrderCard_PageTitle_Index, MessageResource.WorkOrderInvoice_Dislay_FinishInvoice)))

@(Html.Kendo().Window()
.Name("VehicleBodyWorkWindow")
.Modal(true).Width(950).Height(350)
.Iframe(true)
.Events(e => e.Close("function(e){ window.location.reload();}"))
.Visible(false)
//.Animation(a=>a.Open(effect=>effect.SlideIn(SlideDirection.Right)).Close(effect=>effect.Fade(FadeDirection.Out)))
.Title(MessageResource.VehicleBodywork_PageTitle_Update))
@(Html.Kendo().Window()
.Name("AddLabourPriceWindow")
.Modal(true).Width(500).Height(150)
.Visible(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#AddLabourPriceWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.ProposalCard_Change_Labour_Price)))


@(Html.Kendo().Window()
.Name("UpdateFailureCodeWindow")
.Modal(true).Width(500).Height(200)
.Visible(false)
.HtmlAttributes(new { style = "background-color:#EDF1F4 !important" })
.Events(evt => evt.Close("function(e){ $('#UpdateFailureCodeWindow').html(''); RefreshDetails($('#refresh-details-btn')); }"))
//.Animation(a => a.Open(effect => effect.SlideIn(SlideDirection.Right)))
.Title(string.Format("{0} [{1} {2}]", MessageResource.ProposalCard_Display_ProposalDetails, MessageResource.AppointmentIndicatorFailureCode_Display_Code, MessageResource.Global_Display_Update)))
<div id="AssignTechnicianWindow" class="hide"></div>
<div id="UpdateProcessType" style="background-color: #EDF1F4 !important" class="hide"></div>
<div id="PartRemovalWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
<div id="AddPdiPackageWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
<div id="PdiPackageResultsWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
<div id="VehicleInfoWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
<div id="SendToWarrantyWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
<div id="PrintBarcodeWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
<div id="VehicleHistoryWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
<div id="VehicleContactInfoWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
<div id="PeriodicMaintControlListWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
<div id="AddHourMaintWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
<div id="PickingCancellationWindow" style="background-color: #EDF1F4 !important" class="hide"></div>
<div id="CancelVehicleLeaveWindow" style="background-color: #EDF1F4 !important" class="hide"></div>

@*End of PopUp Windows*@

<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/custom.js"></script>
<script src="~/Scripts/jqueryFileDowload.js"></script>
<script src="~/Scripts/odms.objectsearch.js"></script>
<script>

                                                        function stickIt() {

                                                            var orgElementPos = $('.original').offset();
                                                            var orgElementTop = orgElementPos.top;
                                                            $("#tblProposalDetails tbody tr:last-child td").each(function(i, e) {
                                                                var th = $(".cloned th").eq(i);
                                                                th.width($(e).width() + 1);
                                                            });

                                                            if ($(window).scrollTop() >= (orgElementTop)) {

                                                                var orgElement = $('.original');
                                                                var coordsOrgElement = orgElement.offset();
                                                                var leftOrgElement = coordsOrgElement.left;
                                                                var widthOrgElement = orgElement.width();

                                                                $('.cloned').css('left', leftOrgElement + 'px').css('top', 0).css('width', widthOrgElement + 'px').show();
                                                                $('.original').css('visibility', 'hidden');
                                                            } else {
                                                                // not scrolled past the menu; only show the original menu.
                                                                $('.cloned').hide();
                                                                $('.original').css('visibility', 'visible');
                                                            }
                                                        }

                                                        $(function() {
                                                            $('.menu').addClass('original').clone().insertAfter('.menu').addClass('cloned').css('position', 'fixed').css('top', '0').css('margin-top', '0').css('z-index', '500').removeClass('original').hide();

                                                            stickIt();
                                                            $(window).scroll(function() {
                                                                var windowTop = $(window).scrollTop();

                                                                if (windowTop > $('.original').offset().top) {
                                                                    stickIt();
                                                                } else {
                                                                    $('.cloned').hide();
                                                                    $('.original').css('visibility', 'visible');
                                                                }
                                                            });
                                                            $(window).resize(stickIt);
                                                        });

                                                        $(document).ready(function() {


                                                            //var tableOffset = $("#tblProposalDetails").offset().top;
                                                            //var $header = $("#tblProposalDetails > thead").clone();
                                                            //var $fixedHeader = $("#header-fixed").append($header);
                                                            //$fixedHeader.width($("#tblProposalDetails").width());


                                                            //$(window).bind("scroll", function() {
                                                            //    var offset = $(this).scrollTop();

                                                            //    if (offset >= tableOffset && $fixedHeader.is(":hidden")) {
                                                            //        $fixedHeader.show();
                                                            //    }
                                                            //    else if (offset < tableOffset) {
                                                            //        $fixedHeader.hide();
                                                            //    }
                                                            //});

                                                            $('.panel-collapse').collapse({
                                                                toggle: false
                                                            });

                                                            $(document).on("click", "#GetProposalVehicleLeave", function() {
                                                                $.fileDownload($(this).prop('href'), {

                                                                });
                                                                return false;
                                                            });
                                                            if ('@Model.Vehicle.VehicleKilometer.HasValue' == 'False') {
                                                                if($('#btnUpDateVehicleKM').length>0){
                                                                    DisableClicks();

                                                                    $('#btnUpDateVehicleKM').removeClass("disabled");
                                                                    $('#btnUpDateVehicleKM').trigger('click');
                                                                }
                                                            }
                                                            if ('@Model.Vehicle.Plate' == '' ) {
                                                                if($('#btnUpDateVehiclePlate').length>0){
                                                                    DisableClicks();

                                                                    $('#btnUpDateVehiclePlate').removeClass("disabled");
                                                                    $('#btnUpDateVehiclePlate').trigger('click');
                                                                }
                                                            }




                                                                //body work

                                                            else if ('@Model.Vehicle.IsBodyWorkRequired.ToString()' == 'True' && '@String.IsNullOrEmpty(Model.Vehicle.BodyWorkName).ToString()' == 'True') {
                                                                //AlertErrorMessage('@MessageResource.WorkOrderCard_Message_VehicleBodyWorkRequired');
                                                                DisableClicks();
                                                                $("#btnBodyWorkProcess").removeClass("disabled");
                                                                var obj2 = document.getElementById('btnBodyWorkProcess');

                                                                BodyWorkProcess(obj2);
                                                            }

                                                        });

                                                        @if (!UserManager.UserInfo.IsDealer)
         {
             <text>
                                                        function CancelVehicleLeave(obj) {

                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            var title = $(obj).html();
                                                            $('#CancelVehicleLeaveWindow').kwnd('@Url.Action("CancelVehicleLeave", "Proposal_Card", new { id = Model.ProposalId })', '@Html.Raw(MessageResource.WorkOrder_Dislay_CancelVehicleLeave)',
                                                                {
                                                                    iframe: false,
                                                                    width: 800,
                                                                    height: 400,
                                                                    onClose: function() {
                                                                        $("#CancelVehicleLeaveWindow").html('');
                                                                        window.location.reload();
                                                                    }
                                                                });
                                                            $('#CancelVehicleLeaveWindow').removeClass("hide");
                                                            OpenWindow($('#CancelVehicleLeaveWindow'));
                                                        }
                                                        </text>
         }


                                                        function OpenPickingCancellation(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#PickingCancellationWindow').kwnd('@Url.Action("PickingCancellation", new { id = Model.ProposalId })', '@Html.Raw(MessageResource.WorkOrderCard_Display_PickingCancellation)',
                                                                {
                                                                    iframe: false,
                                                                    width: 680,
                                                                    height: 350,
                                                                    onClose: function() {
                                                                        $("#PickingCancellationWindow").html('');
                                                                        RefreshDetails();
                                                                    }
                                                                });
                                                            $('#PickingCancellationWindow').removeClass("hide");
                                                            OpenWindow($('#PickingCancellationWindow'));
                                                        }


                                                        function AddHourMaint(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#AddHourMaintWindow').kwnd('@Url.Action("AddHourMaint", new { id = Model.ProposalId, vehicleId = Model.Vehicle.VehicleId })', '@Html.Raw(MessageResource.WorkOrderCard_Display_AddHourMaint)',
                                                                {
                                                                    iframe: false,
                                                                    width: 480,
                                                                    height: 200,
                                                                    onClose: function() {
                                                                        $("#AddHourMaintWindow").html('');
                                                                        RefreshDetails();
                                                                    }
                                                                });
                                                            $('#AddHourMaintWindow').removeClass("hide");
                                                            OpenWindow($('#AddHourMaintWindow'));
                                                        }

                                                        function UpDateVehicleKM(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            var km = parseInt($("#VehicleKM").text());
                                                            $('#VehicleKMWindow').html('');
                                                            var windowWidget = $("#VehicleKMWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("UpdateVehicleKM")/' + @Model.ProposalId + "?km=" + $("#VehicleKM").text().replace("\/s", "")+'&seq=@Model.ProposalSeq'+'&isHourMaint=@Model.Vehicle.IsHourMaint'+'&hour='+ $("#VehicleHour").text().replace("\/s", "")
                                                            }).center();


                                                            windowWidget.open();

                                                            $('.k-overlay').unbind("click");
                                                            $('.k-overlay').click(function() {
                                                                if (windowWidget) {
                                                                    windowWidget.close();
                                                                    $('#VehicleKMWindow').html('');
                                                                    if ('@Model.Vehicle.IsBodyWorkRequired.ToString()' == 'True' && '@String.IsNullOrEmpty(Model.Vehicle.BodyWorkName).ToString()' == 'True') {
                                                                        DisableClicks();
                                                                        $("#btnBodyWorkProcess").removeClass("disabled");
                                                                        var obj2 = document.getElementById('btnBodyWorkProcess');

                                                                        BodyWorkProcess(obj2);
                                                                    } else if(parseInt($("#VehicleKM").text())>0) {
                                                                        EnableClicks();
                                                                    }

                                                                }
                                                            });

                                                        }
                                                        function UpDateVehiclePlate(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            var km = parseInt($("#VehiclePlate").text());
                                                            $('#VehiclePlateWindow').html('');
                                                            var windowWidget = $("#VehiclePlateWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("UpdateVehiclePlate")/' + @Model.ProposalId + "?plate=" + $("#VehiclePlate").text().replace("\/s", "")}).center();
                                                            windowWidget.open();

                                                            $('.k-overlay').unbind("click");
                                                            $('.k-overlay').click(function() {
                                                                if (windowWidget) {
                                                                    windowWidget.close();
                                                                    $('#VehiclePlateWindow').html('');
                                                                    if ('@Model.Vehicle.IsBodyWorkRequired.ToString()' == 'True' && '@String.IsNullOrEmpty(Model.Vehicle.BodyWorkName).ToString()' == 'True') {
                                                                        DisableClicks();
                                                                        $("#btnBodyWorkProcess").removeClass("disabled");
                                                                        var obj2 = document.getElementById('btnBodyWorkProcess');

                                                                        BodyWorkProcess(obj2);
                                                                    } else if(parseInt($("#VehiclePlate").text())>0) {
                                                                        EnableClicks();
                                                                    }

                                                                }
                                                            });

                                                        }


                                                        function OpenInvoiceWindow(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            $('#InvoiceWindow').html('');
                                                            var windowWidget = $("#InvoiceWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("ProposalInvoiceCreate", "ProposalInvoice", new { id = Model.ProposalId, customerId = Model.Customer.CustomerId })'
                                                            }).center();


                                                            windowWidget.open();
                                                        }

                                                        function UpdateContactInfo(idProposal, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            $('#ContactInfoWindow').html('');
                                                            var windowWidget = $("#ContactInfoWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("UpdateContactInfo")/' + @Model.ProposalId
                                                                }).center();

                                                            windowWidget.open();
                                                        }

                                                        function AddTechnicalDetail(ProposalDetailId, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            $('#TechnicalDescriptionWindow').html('');
                                                            var windowWidget = $("#TechnicalDescriptionWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("AddTechnicalDetail")/' + @Model.ProposalId + '?ProposalDetailId=' + ProposalDetailId
                                                            }).center();
                                                            //windowWidget.center();
                                                            windowWidget.bind("close", function() {
                                                                window.location.reload()
                                                            });
                                                            windowWidget.open();


                                                        }


                                                        function AddProposalDetail(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#AddProposalDetailWindow').html('');
                                                            var windowWidget = $("#AddProposalDetailWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("AddProposalDetail")/' + @Model.ProposalId+"?seq="+@Model.ProposalSeq
                                                                }).center();

                                                            windowWidget.open();


                                                        }

                                                        function AddPart(ProposalDetailId, obj) {

                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#AddProposalPartWindow').html('');
                                                            var windowWidget = $("#AddProposalPartWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("AddProposalPart")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId
                                                            }).center();

                                                            windowWidget.open();
                                                        }

                                                        function AddLabour(ProposalDetailId, vehicleId, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#AddProposalLabourWindow').html('');
                                                            var windowWidget = $("#AddProposalLabourWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("AddProposalLabour")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId + '&vehicleId=' + vehicleId
                                                            }).center();

                                                            windowWidget.open();


                                                        }

                                                        function AddMaintenance(ProposalDetailId, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#AddProposalMaintWindow').html('');
                                                            var windowWidget = $("#AddProposalMaintWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("AddProposalMaint")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId+"&seq="+@Model.ProposalSeq
                                                                }).center();

                                                            windowWidget.open();


                                                        }

                                                        //Emre
                                                        function _CancelProposal(needRefresh, obj)
                                                        {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#CancelProposalWindow').html('');
                                                            var windowWidget = $("#CancelProposalWindow").data("kendoWindow");
                                                              windowWidget.refresh({
                                                                  url: '@Url.Action("CancelProposal")?id=' + @Model.ProposalId+"&seq="+@Model.ProposalStatId
                                                              }).center();
                                                                    windowWidget.bind("close", function() {
                                                                        if(needRefresh==true)
                                                                            window.location.reload()
                                                                    });
                                                                windowWidget.open();


                                                        }

                                                        function CancelProposalDetailWithCampaignRequest(ProposalDetailId, campaignRequestId, obj) {

                                                            CancelDetailDeleteConfirm(function() {
                                                                CancelProposalDetail(ProposalDetailId, obj);
                                                            });

                                                        }


                                                        function CancelProposalDetail(ProposalDetailId,needRefresh, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#CancelProposalDetailWindow').html('');
                                                            var windowWidget = $("#CancelProposalDetailWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("CancelProposalDetail")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId+"&seq="+@Model.ProposalSeq
                                                                }).center();
                                                            windowWidget.bind("close", function() {
                                                                if(needRefresh==true)
                                                                    window.location.reload()
                                                            });
                                                            windowWidget.open();


                                                        }


                                                        function ReservDetailParts(ProposalDetailId, indicatorId, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#ReservDetailPartsWindow').html('');
                                                            var windowWidget = $("#ReservDetailPartsWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("ReservDetailParts")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId,
                                                            }).center();

                                                            windowWidget.open();


                                                        }

                                                        function ReturnParts(ProposalDetailId, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#ReturnPartsWindow').html('');
                                                            var windowWidget = $("#ReturnPartsWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("ReturnParts")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId,
                                                            }).center();

                                                            windowWidget.open();


                                                        }

                                                        function AddCampaign(obj, campaignCode) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#AddCampaignWindow').html('');
                                                            var windowWidget = $("#AddCampaignWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("AddCampaign")/' + @Model.ProposalId + "?campaignCode=" + campaignCode
                                                            }).center();

                                                            windowWidget.open();

                                                        }


                                                        function AddDetailDiscount(ProposalDetailId, id, type, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#AddDetailDiscountWindow').html('');
                                                            var windowWidget = $("#AddDetailDiscountWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("AddDetailDiscount")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId + "&type=" + type + "&itemId=" + id,
                                                            }).center();

                                                            windowWidget.open();


                                                        }

                                                        function AddDetailQuantity(ProposalDetailId, id, type, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#AddDetailQuantityWindow').html('');
                                                            var windowWidget = $("#AddDetailQuantityWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("AddDetailQuantity")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId + "&type=" + type + "&itemId=" + id,
                                                            }).center();

                                                            windowWidget.open();


                                                        }

                                                        function EditMaintenanceQuantity(ProposalDetailId, id, type, maintenanceId, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#EditMeintenanceQuantityWindow').html('');
                                                            var windowWidget = $("#EditMeintenanceQuantityWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("EditMeintenanceQuantity")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId + "&type=" + type + "&itemId=" + id + "&maintId=" + maintenanceId,
                                                            }).center();

                                                            windowWidget.open();


                                                        }

                                                        function OpenDocuments(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            $('#DocumentsWindow').html('');
                                                            var windowWidget = $("#DocumentsWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("ProposalDocumentsIndex", "ProposalDocuments")?id=' + @Model.ProposalId+'&seq='+@Model.ProposalSeq
                                                                }).center();
                                                            windowWidget.open();


                                                        }

                                                        function OpenVehicleNotesProposal(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            $('#VehicleNotesWindow').html('');
                                                            var windowWidget = $("#VehicleNotesWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("VehicleNotesProposal", "Proposal_Card")/' + @Model.ProposalId}).center();

                                                            windowWidget.open();


                                                        }

                                                        @*function DisplayVehicleNotePopup(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            $('#VehicleNotesWindow').html('');
                                                            var windowWidget = $("#VehicleNotesWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("VehicleNotesProposalPopup", "Proposal_Card")/' + @Model.ProposalId }).center();

                                                            windowWidget.open();


                                                        }*@


                                                        function OpenDealerNotes(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            $('#DealerNotesWindow').html('');
                                                            var windowWidget = $("#DealerNotesWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("DealerNotes", "Proposal_Card")?id=' + @Model.ProposalId+'&seq='+@Model.ProposalSeq}).center();//+"?workOrderDetailId="+workOrderDetailId+"&type="+type+"&itemId="+id +"&maintId="+maintenanceId,
                                                            windowWidget.open();


                                                        }

                                                        function OpenWarrantyWindow(ProposalDetailId, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#WarrantyWindow').html('');
                                                            var windowWidget = $("#WarrantyWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("ClaimWarranty", "Proposal_Card")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId
                                                            }).center();
                                                            windowWidget.open();

                                                        }

                                                        function ChangePriceList(ProposalDetailId, id, type, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#ChangePriceListWindow').html('');
                                                            var windowWidget = $("#ChangePriceListWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("ChangePriceList")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId + "&type=" + type + "&itemId=" + id + "&date=" + '@Model.ProposalDate.ToString(new CultureInfo("tr-TR"))',
                                                            }).center();

                                                            windowWidget.open();


                                                        }
                                                        function AddLabourPrice(workOrderDetailId, id, type, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#AddLabourPriceWindow').html('');
                                                            var windowWidget = $("#AddLabourPriceWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("AddLabourPrice")/' + @Model.ProposalId + "?workOrderDetailId=" + workOrderDetailId + "&type=" + type + "&itemId=" + id,
                                                            }).center();

                                                            windowWidget.open();


                                                        }

                                                        function UpdateFailureCode(ProposalDetailId, code, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#UpdateFailureCodeWindow').html('');
                                                            var windowWidget = $("#UpdateFailureCodeWindow").data("kendoWindow");
                                                            windowWidget.refresh({
                                                                url: '@Url.Action("UpdateFailureCode")/' + @Model.ProposalId + "?ProposalDetailId=" + ProposalDetailId + "&code=" + code
                                                            }).center();

                                                            windowWidget.open();


                                                        }

                                                        function OpenCampaignRequestDetails(ProposalDetailId, campaignRequestId, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#CampaignRequestDetailsWindow').kwnd('@Url.Action("CampaignRequestDetails")' + '?ProposalDetailId=' + ProposalDetailId + '&campaignRequestId=' + campaignRequestId, '@MessageResource.CampaignRequest_PageTitle_Details',
                                                                {
                                                                    iframe: false,
                                                                    width: 800,
                                                                    height: 460,
                                                                    onClose: function() {
                                                                        $("#CampaignRequestDetailsWindow").html('');
                                                                        EnableClicks();
                                                                    }
                                                                });
                                                            $('#CampaignRequestDetailsWindow').removeClass("hide");
                                                            OpenWindow($('#CampaignRequestDetailsWindow'));
                                                        }


                                                        function AddPdiPackage(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#AddPdiPackageWindow').kwnd('@Url.Action("AddPdiPackage", new { id = Model.ProposalId })', '@Html.Raw(MessageResource.WorkOrderCard_Display_AddPdiPackage)',
                                                                {
                                                                    iframe: false,
                                                                    width: 960,
                                                                    height: 250,
                                                                    onClose: function() {
                                                                        window.location.reload();
                                                                    }
                                                                });
                                                            $('#AddPdiPackageWindow').removeClass("hide");
                                                            OpenWindow($('#AddPdiPackageWindow'));
                                                        }

                                                        function OpenPartRemovalWindow(ProposalDetailId, partId, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#PartRemovalWindow').kwnd('@Url.Action("PartRemovalInfo")' + '?ProposalDetailId=' + ProposalDetailId + '&partId=' + partId, "@Html.Raw(CommonUtility.GetResourceValue("ProposalCard_Display_PartRemovalTitle"))",
                                                                {
                                                                    iframe: false,
                                                                    width: 600,
                                                                    height: 360,
                                                                    onClose: function() {
                                                                        $("#PartRemovalWindow").html('');
                                                                        EnableClicks();
                                                                    }
                                                                });
                                                            $('#PartRemovalWindow').removeClass("hide");
                                                            OpenWindow($('#PartRemovalWindow'));
                                                        }

                                                        function OpenPrintBarcodeWindow(ProposalId,printAll, obj) {
                                                            //if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#PrintBarcodeWindow').kwnd('@Url.Action("PrintBarcode", "SparePartBarcode")' + '/' + ProposalId+'?isPrinted='+printAll, "@Html.Raw(CommonUtility.GetResourceValue("ProposalCard_Display_PartRemovalTitle"))",
                                                                {
                                                                    iframe: true,
                                                                    width: 800,
                                                                    height: 400,
                                                                    onClose: function() {
                                                                        $("#PrintBarcodeWindow").html('');
                                                                        EnableClicks();
                                                                    }
                                                                });
                                                            $('#PrintBarcodeWindow').removeClass("hide");
                                                            OpenWindow($('#PrintBarcodeWindow'));
                                                        }


                                                        function OpenVehicleDetails(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#VehicleInfoWindow').kwnd('@Url.Action("VehicleDetails", new { id = Model.Vehicle.VehicleId })', "@Html.Raw(CommonUtility.GetResourceValue("Vehicle_PageTitle_Details"))",
                                                                {
                                                                    iframe: false,
                                                                    width: 950,
                                                                    height: 450,
                                                                    onClose: function() {
                                                                        $("#VehicleInfoWindow").html('');
                                                                        EnableClicks();
                                                                    }
                                                                });
                                                            $('#VehicleInfoWindow').removeClass("hide");
                                                            OpenWindow($('#VehicleInfoWindow'));
                                                        }

                                                        function OpenVehicleContactInfo(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#VehicleContactInfoWindow').kwnd('@Url.Action("VehicleContactEdit", "Vehicle", new { id = Model.Vehicle.VehicleId })', "@Html.Raw(CommonUtility.GetResourceValue("Vehicle_PageTitle_Details"))",
                                                                {
                                                                    iframe: false,
                                                                    width: 700,
                                                                    height: 350,
                                                                    onClose: function() {
                                                                        $("#VehicleContactInfoWindow").html('');
                                                                        $.post("@Url.Action("GetVehicleContactAsJson", "Vehicle", new { id = Model.Vehicle.VehicleId })", null, function(json) {
                                                                            $("#VehicleLocation").html(json.Location);
                                                                            $("#VehicleResponsiblePerson").html(json.ResponsiblePerson);
                                                                            $("#VehicleResponsiblePersonPhone").html(json.ResponsiblePersonPhone);
                                                                        }, "JSON");
                                                                        EnableClicks();
                                                                    }


                                                                });
                                                            $('#VehicleContactInfoWindow').removeClass("hide");
                                                            OpenWindow($('#VehicleContactInfoWindow'));
                                                        }

                                                        function UpdateProcessType(ProposalDetailId, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#UpdateProcessType').kwnd('@Url.Action("UpdateProcessType")' + '?ProposalDetailId=' + ProposalDetailId, ('@MessageResource.WorkOrderCard_Display_UpdateProcessType').replace("&#252;", "ü"),
                                                                {
                                                                    iframe: false,
                                                                    width: 500,
                                                                    height: 250,
                                                                    onClose: function() {
                                                                        $("#UpdateProcessType").html('');
                                                                        //EnableClicks();
                                                                        RefreshDetails($('#refresh-details-btn'));
                                                                    }
                                                                });
                                                            $('#UpdateProcessType').removeClass("hide");
                                                            OpenWindow($('#UpdateProcessType'));
                                                        }


                                                        function OpenVehicleHistory(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#VehicleHistoryWindow').kwnd('@Url.Action("VehicleHistoryIndex", "Vehicle", new { vehicleId = Model.Vehicle.VehicleId })', '@Html.Raw(MessageResource.WorkOrderCard_Display_VehicleHistory)',
                                                                {
                                                                    iframe: true,
                                                                    width: 1250,
                                                                    height: 650,
                                                                    onClose: function() {
                                                                        $("#VehicleHistoryWindow").html('');
                                                                        EnableClicks();
                                                                    }
                                                                });
                                                            $('#VehicleHistoryWindow').removeClass("hide");
                                                            OpenWindow($('#VehicleHistoryWindow'));
                                                        }

                                                        function OpenPeriodicMaintControlList(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            $('#PeriodicMaintControlListWindow').kwnd('@Url.Action("OpenPeriodicMaintControlList", "Proposal_Card", new { id = Model.Vehicle.VehicleTypeId })', '@Html.Raw(MessageResource.PeriodicMaintControlList_PageTitle_Index)',
                                                                {
                                                                    iframe: false,
                                                                    width: 960,
                                                                    height: 450,
                                                                    onClose: function() {
                                                                        $("#PeriodicMaintControlListWindow").html('');
                                                                        EnableClicks();
                                                                    }
                                                                });
                                                            $('#PeriodicMaintControlListWindow').removeClass("hide");
                                                            OpenWindow($('#PeriodicMaintControlListWindow'));
                                                        }
                                                        function Print() {
                                                            $.ajax({
                                                                type: "POST",
                                                                url: "@Url.Action("ChangeProposalStatForPrint", "Proposal_Card")",
                                                                data: { id: @Model.ProposalId, seq: @Model.ProposalSeq  },
                                                                traditional: true,
                                                                success: function (result) {
                                                                    if (result.Result == false) {
                                                                        SetErrorMessage(result.Message);
                                                                    }
                                                                    else if (result.Result == true) {
                                                                        window.location.reload();


                                                                    }
                                                                },
                                                                dataType: "json"
                                                            });
                                                        }
                                                        function CheckVehicleLeave(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            $.ajax({
                                                                type: "POST",
                                                                url: '@Url.Action("CheckVehicleLeave", "Proposal_Card")',
                                                                data: { id: @Model.ProposalId },
                                                                success: function(json) {
                                                                    if (json.VehicleLeaveDate == null) {
                                                                        CustomConfirm2(function() {
                                                                            CheckVehicleLeaveStep2(obj);
                                                                        }, "@MessageResource.Global_Display_Warning", "@MessageResource.WorkOrderCard_Display_VehicleLeaveConfirmMessage", "@MessageResource.Global_Display_Yes", "@MessageResource.Global_Display_No");
                                                                    }
                                                                },
                                                                dataType: "JSON"
                                                            });


                                                        }

                                                        function CheckVehicleLeaveStep2(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            $.ajax({
                                                                type: "POST",
                                                                url: '@Url.Action("CheckVehicleLeaveStep2", "Proposal_Card")',
                                                                data: { id: @Model.ProposalId },
                                                                success: function(json) {
                                                                    if (json.IsValid == 0) {
                                                                        AlertSuccessMessage("@MessageResource.Global_Display_Success");
                                                                        window.location.reload();
                                                                        //$('#GetProposalVehicleLeave').trigger("click");
                                                                    } else if (json.IsValid == 1) {
                                                                        AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeaveProcessTypeError");
                                                                    } else if (json.IsValid == 2) {
                                                                        // AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_DismentledPartsNotSet");
                                                                        OpenMustRemovedPartsWindow(obj);
                                                                    } else if (json.IsValid == 3) {
                                                                        AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_IncompletedLabourExists");
                                                                    } else if (json.IsValid == 4) {
                                                                        AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_NotPickedPartsExists");
                                                                    }else if (json.IsValid == 5) {
                                                                        AlertErrorMessage("@MessageResource.Error_DB_PdiResultNotExists");
                                                                    }else if (json.IsValid == 6) {
                                                                        AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_PickingIsNotFinished");
                                                                    }else if (json.IsValid == 7) {
                                                                        AlertErrorMessage("@MessageResource.ProposalCard_ValidatonVehicleLeave_EmptyProposalDeatail");
                                                                    }else if (json.IsValid == 8) {
                                                                        AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_EmptyTechDesc");
                                                                    }else if (json.IsValid == 9) {
                                                                        AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_NoDetailExists");
                                                                    }else if (json.IsValid == 10) {
                                                                        AlertErrorMessage("@MessageResource.WorkOrderCard_ValidatonVehicleLeave_WaitingPreApproval");
                                                                    }else if (json.IsValid == 11) {
                                                                        AlertErrorMessage("@MessageResource.WorkOrderCard_Warning_VehicleKM");
                                                                    }else if (json.IsValid == 12) {
                                                                        AlertErrorMessage("@MessageResource.WorkOrderCard_Warning_RequiredPartForGuarantee");
                                                                    }else if (json.IsValid == 13) {
                                                                        AlertErrorMessage("@MessageResource.WorkOrderCard_Warning_CouponMaintenanceKmControl");
                                                                    }
                                                                },
                                                                dataType: "JSON"
                                                            });
                                                        }

                                                        function PrintLabels(ProposalDetailId, printAll, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            OpenPrintBarcodeWindow(@Model.ProposalId,printAll, obj);
                                                            @*$.ajax({
            type: "POST",
            url: '@Url.Action("PrintLabels", "ProposalCard")',
            data: { ProposalDetailId: ProposalDetailId, printAll: printAll },
            success: function(json) {
                if (json.Result == 1) {
                    SetSuccessMessage(json.Message);
                    OpenPrintBarcodeWindow(@Model.ProposalId, obj);
                } else {
                    SetErrorMessage(json.Message);
                }
            },
            complete: function() {
                EnableClicks();
            },
            dataType: "JSON"
        });*@
                                                        }

                                                        function OpenMustRemovedPartsWindow(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            var html = '<div id="MustRemovedPartsWindow" style="background-color:#EDF1F4 !important" class="hide"></div>';
                                                            $('#ProposalWrap').append(html);

                                                            $('#MustRemovedPartsWindow').kwnd('@Url.Action("MustRemovedParts", "Proposal_Card")' + '/@Model.ProposalId', '@Html.Raw(MessageResource.WorkOrderCard_Title_MustRemovedParts)',
                                                                {
                                                                    iframe: false,
                                                                    width: 800,
                                                                    height: 400,
                                                                    onClose: function() {
                                                                        $('#MustRemovedPartsWindow').remove();
                                                                    }
                                                                });
                                                            $('#MustRemovedPartsWindow').removeClass("hide");
                                                            OpenWindow($('#MustRemovedPartsWindow'));
                                                        }


                                                        function OpenAssaignTechicianWindow(ProposalDetailId, labourId, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            var title = $(obj).html();
                                                            $('#AssignTechnicianWindow').kwnd('@Url.Action("LabourTechnicianIndex", "LabourTechnician")' + '?ProposalDetailId=' + ProposalDetailId + '&labourId=' + labourId, title,
                                                                {
                                                                    iframe: true,
                                                                    width: 1000,
                                                                    height: 360,
                                                                    onClose: function() {
                                                                        $("#AssignTechnicianWindow").html('');
                                                                        RefreshDetails();
                                                                        EnableClicks();
                                                                    }
                                                                });
                                                            $('#AssignTechnicianWindow').removeClass("hide");
                                                            OpenWindow($('#AssignTechnicianWindow'));
                                                        }

                                                        function OpenPdiPackage(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DisableClicks();
                                                            var title = $(obj).html();
                                                            $('#PdiPackageResultsWindow').kwnd('@Url.Action("OpenPdiPackageResults", "Proposal_Card", new { id = Model.ProposalId })', title,
                                                                {
                                                                    iframe: false,
                                                                    width: 1000,
                                                                    height: 400,
                                                                    onClose: function() {
                                                                        $("#PdiPackageResultsWindow").html('');
                                                                        EnableClicks();
                                                                    }
                                                                });
                                                            $('#PdiPackageResultsWindow').removeClass("hide");
                                                            OpenWindow($('#PdiPackageResultsWindow'));
                                                        }

                                                        function DeleteItem(ProposalDetailId, itemId, type, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DeleteConfirm(function() {
                                                                DisableClicks();
                                                                $.post(
                                                                    "@Url.Action("DeleteDetailItem", new { id = Model.ProposalId })",
                                                                    { ProposalDetailId: ProposalDetailId, itemId: itemId, type: type },
                                                                    function(json) {
                                                                        if (json.Result == false) {
                                                                            AlertErrorMessage(json.Message);
                                                                        } else {
                                                                            AlertSuccessMessage(json.Message);
                                                                            RefreshDetails($('#refresh-details-btn'));
                                                                        }
                                                                        EnableClicks();
                                                                    }, "json");

                                                            });
                                                        }
                                                        function CancelProposal(obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            CustomConfirm2(function() {
                                                                DisableClicks();
                                                                $.post(
                                                                    "@Url.Action("CancelProposal", "Proposal", new { id = Model.ProposalId })",
                                                                    null,
                                                                    function(json) {
                                                                        if (json.Status == 0) {
                                                                            AlertErrorMessage(json.Message);
                                                                        } else {
                                                                            AlertSuccessMessage(json.Message);
                                                                            window.location.reload()
                                                                        }
                                                                        EnableClicks();
                                                                    }, "json");

                                                            }, '@Html.Raw(MessageResource.Global_Display_Warning)', '@Html.Raw(MessageResource.ProposalCard_Display_CancelProposalMessage)', '@MessageResource.Global_Display_Yes',  '@MessageResource.Global_Display_No');
                                                        }

                                                        function GoToProposalInvoice() {
                                                            window.location = "@Url.Action("ProposalInvoiceIndex", "ProposalInvoice", new { id = Model.ProposalId })";
                                                        }

                                                        function DisableClicks() {
                                                            $(".btn, a.k-link, .k-button").not(".k-window-action").addClass("disabled");
                                                            $(".k-link").css({ opacity: "0.7" });
                                                            $(".k-button").attr("disabled", "disabled");
                                                        }

                                                        function PickDetailParts(ProposalDetailId, obj) {
                                                            $(obj).addClass("hide");
                                                            $(obj).next(".ajax-loading").removeClass("hide");
                                                            $.post(
                                                                "@Url.Action("PickDetailParts", new { id = Model.ProposalId })",
                                                                { ProposalDetailId: ProposalDetailId },
                                                                function(json) {
                                                                    if (json.Result == false) {
                                                                        AlertErrorMessage(json.Message);
                                                                    } else {
                                                                        AlertSuccessMessage(json.Message);
                                                                        RefreshDetails($('#refresh-details-btn'));
                                                                    }
                                                                    $(obj).next(".ajax-loading").addClass("hide");
                                                                    $(obj).removeClass("hide");
                                                                }, "json");


                                                        }

                                                        function RemoveMaintItem(maintId, ProposalDetailId, id, type, obj) {
                                                            if ($(obj).hasClass("disabled")) return;
                                                            DeleteConfirm(function() {
                                                                DisableClicks();
                                                                $.post(
                                                                    "@Url.Action("RemoveItem")",
                                                                    { ProposalId: @Model.ProposalId, ProposalDetailId: ProposalDetailId, ItemId: id, Type: type, MaintenanceId: maintId },
                                                                    function(json) {
                                                                        if (json.Result == false) {
                                                                            AlertErrorMessage(json.Message);
                                                                        } else {
                                                                            AlertSuccessMessage(json.Message);
                                                                            RefreshDetails($('#refresh-details-btn'));
                                                                        }
                                                                        EnableClicks();
                                                                    }, "json");

                                                            });
                                                        }


                                                        function SendToWarrantyAppoval(ProposalDetailId, obj) {


                                                            SendToWarrantyConfirm(function() {
                                                                $(obj).addClass("hide");
                                                                $(obj).next(".ajax-loading").removeClass("hide");
                                                                $.post(
                                                                    "@Url.Action("SendToWarrantyApproval")",
                                                                    { ProposalDetailId: ProposalDetailId },
                                                                    function(json) {
                                                                        if (json.Result == false) {
                                                                            AlertErrorMessage(json.Message);
                                                                        } else {
                                                                            AlertSuccessMessage(json.Message);
                                                                            RefreshDetails($('#refresh-details-btn'));
                                                                        }
                                                                        $(obj).next(".ajax-loading").addClass("hide");
                                                                        $(obj).removeClass("hide");
                                                                    }, "json");
                                                            });


                                                        }

                                                        @*function SendToWarrantyPreAppoval(ProposalDetailId, obj) {
                                                    if ($(obj).hasClass("disabled")) return;
                                                    DisableClicks();
                                                    var title = $(obj).html();
                                                    $('#SendToWarrantyWindow').kwnd('@Url.Action("SendToWarrantyPreApproval", "ProposalCard", new { id = Model.ProposalId })' + '?ProposalDetailId=' + ProposalDetailId, '@Html.Raw(MessageResource.WorkOrderCard_Display_SendToPreWarranty)',
                                                        {
                                                            iframe: false,
                                                            width: 800,
                                                            height: 300,
                                                            onClose: function() {
                                                                $("#SendToWarrantyWindow").html('');
                                                                RefreshDetails();
                                                                EnableClicks();
                                                            }
                                                        });
                                                    $('#SendToWarrantyWindow').removeClass("hide");
                                                    OpenWindow($('#SendToWarrantyWindow'));
                                                }*@

                                                        function CreateCampaignRequest(ProposalDetailId, obj) {
                                                            $(obj).addClass("hide");
                                                            $(obj).next(".ajax-loading").removeClass("hide");
                                                            $.post(
                                                                "@Url.Action("CreateCampaignRequest")",
                                                                { ProposalDetailId: ProposalDetailId },
                                                                function(json) {
                                                                    if (json.Result == false) {
                                                                        AlertErrorMessage(json.Message);
                                                                    } else {
                                                                        AlertSuccessMessage(json.Message);
                                                                        RefreshDetails($('#refresh-details-btn'));
                                                                    }
                                                                    $(obj).next(".ajax-loading").addClass("hide");
                                                                    $(obj).removeClass("hide");
                                                                }, "json");
                                                        }

                                                        function CustomConfirm2(func, title, content, textYes, textNo) {
                                                            var confirm = false;
                                                            var kendoWindow = $("<div />").kendoWindow({
                                                                title: title,
                                                                resizable: false,
                                                                modal: true
                                                            });

                                                            var string = '<p class="custom-confirm-message">' + content + '</p>' +
                                                                '<p style="text-align:right">' +
                                                                '<button class="custom-confirm k-button">' + textYes + '</button>' +
                                                                '<button class="custom-cancel k-button">' + textNo + '</button></p>';

                                                            kendoWindow.data("kendoWindow")
                                                                .content(string)
                                                                .center().open();

                                                            kendoWindow
                                                                .find(".custom-confirm, .custom-cancel")
                                                                .click(function() {
                                                                    if ($(this).hasClass("custom-confirm")) {
                                                                        confirm = true;
                                                                        if (func)
                                                                            func();
                                                                    }
                                                                    kendoWindow.data("kendoWindow").close();
                                                                })
                                                                .end();
                                                            return confirm;
                                                        }


                                                        function EnableClicks() {
                                                            $(".btn, a.k-link, .k-button").removeClass("disabled");
                                                            $(".k-link").css({ opacity: "1" });
                                                            $(".k-button").removeAttr("disabled");
                                                            ResetToolTips();
                                                        }

                                                        function RefreshDetails(obj) {
                                                            $(obj).addClass("hide");
                                                            $(obj).next(".ajax-loading").removeClass("hide");
                                                            var wrapper = $('#ProposalDetails');
                                                            $.post(
                                                                "@Html.Raw(Url.Action("GetProposalDetails", new { ProposalId = Model.ProposalId, vehicleId = Model.Vehicle.VehicleId, vehicleLeave = Model.VehicleLeaveDate.HasValue,seq =Model.ProposalSeq }))",

                                                                null,
                                                                function(html) {
                                                                    wrapper.html(html);
                                                                    $.validator.unobtrusive.parse(wrapper);
                                                                    EnableClicks();
                                                                    //stickIt();
                                                                    $(obj).next(".ajax-loading").addClass("hide");
                                                                    $(obj).removeClass("hide");
                                                                }, "html");


                                                        }

                                                        function CancelDetailDeleteConfirm(deleteFunction) {
                                                            var confirm = false;
                                                            var kendoWindow = $("<div />").kendoWindow({
                                                                title: "@MessageResource.Gloabl_Display_DeleteConfirmTitle",
                                                                resizable: false,
                                                                modal: true
                                                            });

                                                            kendoWindow.data("kendoWindow")
                                                                .content($("#campaign-request-delete-confirm-modal").html())
                                                                .center().open();

                                                            kendoWindow
                                                                .find(".delete-confirm, .delete-cancel")
                                                                .click(function() {
                                                                    if ($(this).hasClass("delete-confirm")) {
                                                                        confirm = true;
                                                                        if (deleteFunction)
                                                                            deleteFunction();
                                                                    }
                                                                    kendoWindow.data("kendoWindow").close();
                                                                })
                                                                .end();
                                                            return confirm;
                                                        }
                                                        function SendToWarrantyConfirm(deleteFunction) {
                                                            var kendoWindow = $("<div />").kendoWindow({
                                                                title: "@MessageResource.Global_Display_Warning",
                                                                resizable: false,
                                                                width:450,
                                                                modal: true
                                                            });

                                                            kendoWindow.data("kendoWindow")
                                                                .content($("#SendToWarranty-confirm-modal").html())
                                                                .center().open();

                                                            kendoWindow
                                                                .find(".confirm, .cancel")
                                                                .click(function() {
                                                                    if ($(this).hasClass("confirm")) {
                                                                        confirm = true;
                                                                        if (deleteFunction)
                                                                            deleteFunction();
                                                                    }
                                                                    kendoWindow.data("kendoWindow").close();
                                                                })
                                                                .end();
                                                        }


                                                        function AddHourMaintConfirm(deleteFunction) {
                                                            var kendoWindow = $("<div />").kendoWindow({
                                                                title: "@MessageResource.Global_Display_Warning",
                                                                resizable: false,
                                                                width:450,
                                                                modal: true
                                                            });

                                                            kendoWindow.data("kendoWindow")
                                                                .content($("#AddHourMaint-confirm-modal").html())
                                                                .center().open();

                                                            kendoWindow
                                                                .find(".confirm, .cancel")
                                                                .click(function() {
                                                                    if ($(this).hasClass("confirm")) {
                                                                        confirm = true;
                                                                        if (deleteFunction)
                                                                            deleteFunction();
                                                                    }
                                                                    kendoWindow.data("kendoWindow").close();
                                                                })
                                                                .end();
                                                        }

                                                        var cnt1 = 0;

                                                        function AlertErrorMessage(msg) {
                                                            cnt1++;
                                                            var id = 'alert-div-' + cnt1;
                                                            var kendoWindow = $("<div id='" + id + "'/>").kendoWindow({
                                                                title: "@MessageResource.Global_Display_Warning",
                                                                resizable: false,
                                                                modal: true
                                                            });

                                                            kendoWindow.data("kendoWindow")
                                                                .content($("#alert-modal").html())
                                                                .center().open();
                                                            $(".warning-message", '#' + id).append(msg);
                                                            kendoWindow
                                                                .find(".warning-ok")
                                                                .click(function() {
                                                                    kendoWindow.data("kendoWindow").destroy();
                                                                })
                                                                .end();
                                                        }

                                                        var cnt2 = 0;

                                                        function AlertSuccessMessage(msg) {
                                                            cnt2++;
                                                            var id = 'success-div-' + cnt1;
                                                            var kendoWindow = $("<div id='" + id + "'/>").kendoWindow({
                                                                title: "@MessageResource.Global_Display_Warning",
                                                                resizable: false,
                                                                modal: true
                                                            });

                                                            kendoWindow.data("kendoWindow")
                                                                .content($("#success-modal").html())
                                                                .center().open();
                                                            $(".warning-message", '#' + id).append(msg);
                                                            kendoWindow
                                                                .find(".warning-ok")
                                                                .click(function() {
                                                                    kendoWindow.data("kendoWindow").destroy();
                                                                })
                                                                .end();
                                                        }

                                                        function ResetToolTips() {
                                                            $('.part-tooltip, .bstooltip').each(function(i, e) {
                                                                if ($(e).attr('title') != '')
                                                                    $(e).tooltipster({
                                                                        animation: 'fade',
                                                                        delay: 100,
                                                                        touchDevices: false,
                                                                        fixedWidth: '50px',
                                                                        maxWidth: 400,
                                                                        theme: 'part-theme',
                                                                        trigger: 'hover',
                                                                        contentAsHTML: true
                                                                    });
                                                            });
                                                        }
</script>
                                                    }
<script>
    $(document).ready(function () {
        ResetToolTips();
        //$(".part-tooltip").on( 'mouseenter', function () {
        //    $('.part-tooltip').tooltipster({
        //        animation: 'grow',
        //        delay: 200,
        //        trigger: 'hover',
        //        theme:'part-theme',
        //        contentAsHTML:true
        //    });
        //});
        //$(document).delegate(".bstooltip,.part-tooltip", 'mouseenter', function () {
        //    $('.bstooltip,.part-tooltip').tooltipster({
        //        animation: 'grow',
        //        delay: 200,
        //        trigger: 'hover',
        //        theme:'part-theme',
        //        contentAsHTML:true
        //    });
        //});
        $("#btnVehicleHistory").kendoTooltip({
            content: {
                url: "@Url.Action("GetVehicleHistoryToolTipContent", new { id = Model.Vehicle != null ? Model.Vehicle.VehicleId : 0 })"
            },
            width: 250,
            height: 100,
            position: "top",
        });
    })
</script>
@helper GetPartTdClass(decimal required, decimal reserved, decimal picked, decimal returned)
{
    if (returned > 0)
    {
        @Html.Raw(" warning ")
        return;
    }
    else
    {
        @Html.Raw(" danger ")
        return;
    }
}

@helper GetPartToolTipHtml(decimal required, decimal reserved, decimal picked, decimal returned)
{
    if (returned > 0)
    {
        @Html.Raw("<div class=\"part-detail-tooltip\"> " +
            "<ul>" +
               " <li><span class=\"bold\">" + MessageResource.WorkOrderCard_Display_Stock + "</span>" +
           "</ul>" +
        "</div>")}
    else
    {
        @Html.Raw("<div class=\"part-detail-tooltip\"> " +
            "<ul>" +
               " <li><span class=\"bold\">" + MessageResource.WorkOrderCard_Display_NoStock + "</span>" +
            "</ul>" +
        "</div>")
    }
}


<script id="alert-modal" type="text/x-kendo-template">
    <div class="alert alert-danger">
        <div style="width:500px">
            <p class="warning-message" style="font-weight:bold"></p>
            <p style="text-align:right">
                <button class="warning-ok btn btn-danger">@MessageResource.Global_Display_Ok</button>
            </p>
        </div>
    </div>
</script>

<script id="success-modal" type="text/x-kendo-template">
    <div class="alert alert-success">
        <div style="width:500px">
            <p class="warning-message" style="font-weight:bold"></p>
            <p style="text-align:right">
                <button class="warning-ok btn btn-success">@MessageResource.Global_Display_Ok</button>
            </p>
        </div>
    </div>
</script>
<script id="campaign-request-delete-confirm-modal" type="text/x-kendo-template">
    <p class="delete-message">@MessageResource.WorkOrderCard_Display_CancelCampaignRequestConfirmQuestion</p>
    <p style="text-align:right">
        <button class="delete-confirm k-button">@MessageResource.Global_Display_Yes</button>
        <button class="delete-cancel k-button">@MessageResource.Global_Display_No</button>
    </p>
</script>
<script id="SendToWarranty-confirm-modal" type="text/x-kendo-template">
    <p class="">@MessageResource.WorkOrderCard_Message_SendToWarranty</p>
    <p style="margin-top:6px"><i class="text-info glyphicon glyphicon-info-sign"></i> <em style="font-size:11px">@MessageResource.WorkOrderCard_Message_SendToWarrantyNote</em></p>
    <p style="text-align:right">
        <button class="confirm k-button">@MessageResource.Global_Display_Yes</button>
        <button class="cancel k-button">@MessageResource.Global_Display_No</button>
    </p>
</script>
<script id="AddHourMaint-confirm-modal" type="text/x-kendo-template">
    <p class="">@MessageResource.WorkOrderCard_Message_AddHourMaint</p>
    <p style="text-align:right">
        <button class="confirm k-button">@MessageResource.Global_Display_Yes</button>
        <button class="cancel k-button">@MessageResource.Global_Display_No</button>
    </p>
</script>
<script>
    $("#Matter4").trigger("change");
</script>
<script>
    function GetCountryId() {
        return { countryId: @Model.Customer.CountryId };
    }
    function ShowHideWitholding(e) {
        if ($('#WitholdingStatus').val() == "1") {
            $("#divWitholdingStatus").show();
            $("#WitholdingId").data("kendoComboBox").enable(true);
        }
        else {
            $("#divWitholdingStatus").hide();
            $("#WitholdingId").data("kendoComboBox").enable(false);
        }
    }

    $("#Matter4").change(function () {
        if ($("#Matter4").val() == "müşteri tarafından" || $("#Matter4").val() == "servis tarafından" ) {
            $("#type1").show();
            $("#type2").hide();
        }
        else {
            $("#type2").show();
            $("#type1").hide();
        }
    });
</script>



@if (Model.Vehicle != null)
{
    <script>

        function BodyWorkProcess(obj) {

            if ($(obj).hasClass("disabled")) return;
            DisableClicks();

        }

    </script>

}

@helper GetDiscountTdClass(decimal discountPrice, decimal? dealerPrice, decimal? profitMarginRatio)
{
    if (dealerPrice.GetValueOrDefault(0) > discountPrice)
    {
        @Html.Raw("danger")
        return;
    }
    if (profitMarginRatio.GetValueOrDefault() > 0)
    {
        if ((dealerPrice * (1 + (profitMarginRatio / 100))) < discountPrice)
        {
            @Html.Raw("warning")
        }
    }

}
@helper GetDiscountTdTitle(decimal discountPrice, decimal? dealerPrice, decimal? profitMarginRatio)
{
    if (dealerPrice.GetValueOrDefault(0) > discountPrice)
    {
        @Html.Raw(MessageResource.WorkOrderWard_Message_DiscountLessThanDealerPrice)
        return;
    }
    if (profitMarginRatio.GetValueOrDefault() > 0)
    {
        if ((dealerPrice * (1 + (profitMarginRatio / 100))) < discountPrice)
        {
            @Html.Raw(MessageResource.WorkOrderWard_Message_DiscountLessThanProfitMargin)
        }
    }

}
@helper GetPriceToolTipHtml(ProposalDetailModel detail)
{
    <table>
        @if (detail.Type == "PART")
        {
            <tr>
                <th style="padding-right: 8px">@MessageResource.StockCard_Display_AvgDealerPrice </th>
                <td>: @detail.DealerPrice</td>
            </tr>
        }
        <tr>
            <th style="padding-right: 8px">@MessageResource.WorkOrderCard_Display_WarrantyPrice </th>
            <td>: @detail.WarrantyPrice</td>
        </tr>
    </table>
}

@helper GetLabourTdClass(sbyte id, bool isExternal)
{
    if (isExternal)
    {
        @Html.Raw(" success ")
        return;
    }
    if (id == -1 || id == 0)
    {
        @Html.Raw(" danger ")
        return;
    }
    else if (id == 4)
    {
        @Html.Raw(" success ")
        return;
    }
    else
    {
        @Html.Raw(" warning ")
    }
}
@helper GetLabourTdTitle(ProposalDetailModel detail)
{
    if (detail.LabourWorkStatusId != 4)
    {
        @Html.Raw(detail.LabourWorkStatus)
    }
    else
    {
        <table>
            <tr>
                <th style="padding-right: 8px">@MessageResource.LabourTechnician_Display_UserNameSurname </th>
                <td>: @detail.LabourTechnician</td>
            </tr>
            @if (detail.LabourStartDate != DateTime.MinValue)
            {
                <tr>
                    <th style="padding-right: 8px">@MessageResource.LabourTechnician_Display_StartDate </th>
                    <td>: @detail.LabourStartDate.ToString("dd/MM/yyyy HH:mm")</td>
                </tr>
                <tr>
                    <th style="padding-right: 8px">@MessageResource.LabourTechnician_Display_EndDate </th>
                    <td>
                        : @detail.LabourFinishDate.ToString("dd/MM/yyyy HH:mm")
                    </td>
                </tr>
            }
        </table>
    }
}


