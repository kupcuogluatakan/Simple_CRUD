@{
    Layout = "~/Views/Shared/Popup_Layout.cshtml";
}
@using System.Linq
@using ODMSCommon.Resources
@model ODMSModel.ProposalCard.ProposalCampaignModel
<style>
    a:focus {
        outline: none;
        outline-offset: -2px;
    }
    #campaign-info {
        padding: 5px;
        margin-top: 6px;
        background-color: #ffffff;
        border: 1px solid #dddddd;
        border-radius: 4px;
    }
    #popupContentWrapper {
        height: 450px !important;
    }

    #popupContent {
        width: 97% !important;
    }

    body {
        overflow: hidden;
    }
</style>

<div class="panel panel-success">
    <div class="panel-heading">
        <h5><strong>@MessageResource.WorkOrderCard_Display_AvailableCampaignList</strong></h5>
    </div>
    <div class="panel-body">
        <div id="warning-wrap" class="alert alert-warning" style=" margin-left:6px;display:none;">
            <a class="close"  onclick="$('.alert').fadeOut();">&times;</a> 
            <strong>
            </strong>
        </div>
        <div id="campaign-list" style="height: 120px; overflow-y: auto; ">
  
                                    @*@if (Model.Campaigns.Any(c=>c.IsMust==false))
                                    {
                                        <button class="btn btn-danger" onclick="OpenDenyWindow()">
                                            @MessageResource.WorkOrderCard_Display_CampaignDeny
                                        </button>
                                    }*@
                               
            <table class="table table-striped table-bordered" style=" margin-bottom: 10px;">
                <thead>
                    <tr>
                        <th>@MessageResource.Global_Display_Select</th>
                        <th>@MessageResource.Global_Display_Add</th>
                        <th>@MessageResource.Campaign_Display_CampaignCode</th>
                        <th>@MessageResource.Campaign_Display_CampaignName</th>
                        <th>@MessageResource.Campaign_Display_Is_Must</th>
                        <th>@MessageResource.WorkOrderCard_Display_HasStock</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Campaigns.Any())
                    {
                        foreach (var item in Model.Campaigns)
                        {
                            <tr>
                                <td>
                                    <a class="k-link" onclick="GetCampaignDetails('@item.CampaignCode',this)">
                                        <img class='iconLink' src="@Url.Content("~/Images/select.png")"/></a>
                                </td>
                                <td>
                       
                                    @*<a class="k-link" onclick="AddCampaignToProposal(@Model.ProposalId, '@item.CampaignCode', this); GetCampaignDetails('@item.CampaignCode', this); ">
                                        <img class='iconLink' src="@Url.Content("~/Images/add.png")"/></a>*@
                          
                                </td>
                                
                                <td>@item.CampaignCode</td>
                                <td>@item.CanpaignName</td>
                                <td>@if (item.IsMust)
                                    {
                                        <strong style="color: #5cb85c"> <i class="glyphicon glyphicon-ok"></i></strong>
                                    }
                                    else
                                    {
                                        <strong style="color: #d9534f"> <i class="glyphicon glyphicon-remove"></i></strong>
                                    }

                                </td>
                                <td>@if (item.HasStock)
                                    {
                                        <strong style="color:#5cb85c"> <i class="glyphicon glyphicon-ok"></i></strong>
                                    }
                                    else
                                    {
                                        <strong style="color: #d9534f"> <i class="glyphicon glyphicon-remove"></i></strong>
                                    }

                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="6" class="text-center">@MessageResource.WorkOrderCard_Display_NoCampaignAvailable</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="clearfix">
            
        </div>
        
        <hr />
        <div id="campaign-info" style="height: 250px; overflow-y: auto">
            <div class="k-loading k-loading-image hide"></div>
            <div class="navbar-text"><strong>@MessageResource.WorkOrderCard_Display_CampaignDetails</strong> </div>
            <div class="clearfix"></div>
            <ul class="nav nav-tabs">
                <li class="active"><a href="#labour"  data-toggle="tab">@MessageResource.LabourDuration_Display_Labour</a></li>
                <li><a href="#part" data-toggle="tab">@MessageResource.WorkOrderCard_Display_Part</a></li>
                <li><a href="#document" data-toggle="tab">@MessageResource.CampaignDocument_Display_DocName</a></li>
            </ul>
            <div id="tabWrap" class="tab-content" style="background-color: white; padding:10px;border-right: 1px solid #dddddd;border-left: 1px solid #dddddd;border-bottom: 1px solid #dddddd">

                <div class="tab-pane active" id="labour">
                    
                </div>
                <div class="tab-pane" id="part"> 
                    
                </div>
                <div class="tab-pane" id="document">
                    
                </div>
            </div>
        </div>

    </div>
</div>
  @(Html.Kendo().Window()
          .Name("CampaignDenyWindow")
          .Modal(true).Width(600).Height(340)
          .Events(evt => evt.Close("function(e){$('#CampaignDenyWindow').html(''); $('.k-loading').addClass('hide'); /*console.log('sad')*/}"))
          .Visible(false)
          .Title(string.Format("{0} [{1}]", MessageResource.ProposalCard_PageTitle_Index, MessageResource.WorkOrderCard_Display_CampaignDeny)))
    


<script type="text/javascript">
    var isLabourLoaded, isPartLoaded,isDocumentLoaded;
    function GetCampaignDetails(campaignCode, obj) {
        var $obj = $(obj);
        $("tr.danger", $obj.parents("table:first")).removeClass("info");
        $obj.closest("tr").addClass("danger");
        $('.k-loading').removeClass("hide");
        GetLabourHtml(campaignCode);
        GetPartHtml(campaignCode);
        GetDocumentHtml(campaignCode);
    }

    function GetLabourHtml(campaignCode) {
        isLabourLoaded = false;

        var request = $.ajax({
            url: '@Url.Action("GetCampaignDetail", "Proposal_Card")',
            type: "POST",
            data: { campaignCode: campaignCode, type: "LABOUR" ,id:@Model.ProposalId},
            dataType: "html"
        });
        request.success(function (html) {
            isLabourLoaded = true;
            $('#labour').html(html);
            HideLoading();
        });
    }

    function GetPartHtml(campaignCode) {
        isPartLoaded = false;
        var request = $.ajax({
            url: '@Url.Action("GetCampaignDetail", "Proposal_Card")',
            type: "POST",
            data: { campaignCode: campaignCode, type: "PART" ,id:@Model.ProposalId},
            dataType: "html"
        });
        request.success(function(html) {
            isPartLoaded = true;
            $('#part').html(html);
            HideLoading();
        });

    }

    function GetDocumentHtml(campaignCode) {
        isDocumentLoaded = false;
        var request = $.ajax({
            url: '@Url.Action("GetCampaignDetail", "Proposal_Card")',
            type: "POST",
            data: { campaignCode: campaignCode, type: "DOCUMENT" ,id:@Model.ProposalId},
            dataType: "html"
        });
        request.success(function (html) {
            isDocumentLoaded = true;
            $('#document').html(html);
            HideLoading();
        });
    }

    function HideLoading() {
        if(isLabourLoaded==true && isPartLoaded==true && isDocumentLoaded==true)
            $('.k-loading').addClass("hide");
    }

    function AddCampaignToProposal(ProposalId, campaignCode,obj) {
        mvc.build("@Url.Action("AddCampaign","Proposal_Card")", "", "", {
            ProposalId: ProposalId,
            'Campaigns[0].CampaignCode':campaignCode
        }, false, "json");
        mvc.post(null, function(json) {
            if (json.Result == false) {
                $("#warning-wrap").removeClass("alert-success").removeClass("alert-warning").addClass("alert-danger");
                $("#warning-wrap  strong").html(json.Message);
            } else {
                $("#warning-wrap").removeClass("alert-warning").removeClass("alert-danger").addClass("alert-success");
                $("#warning-wrap  strong").html(json.Message);
                $(obj).parents("tr:first").slideUp("slow");


            }
            $("#warning-wrap").fadeIn();
        },null);
    }

    function OpenDenyWindow(campaignCode) {
        $('#CampaignDenyWindow').html('');
        var windowWidget = $("#CampaignDenyWindow").data("kendoWindow");
        windowWidget.refresh({
            url: "@Url.Action("UpdateCampaignDenyReason")/" + @Model.ProposalId
            }).center();


        windowWidget.open();

    }

</script>